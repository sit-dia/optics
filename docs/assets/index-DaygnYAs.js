(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const u of i.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function s(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(a){if(a.ep)return;a.ep=!0;const i=s(a);fetch(a.href,i)}})();const Ie='12px "Space Grotesk", system-ui, sans-serif';function K(e,t,s,n,a,i={}){const{color:u="#eaeaea",width:l=2,headSize:c=8}=i,S=Math.atan2(a-s,n-t);e.save(),e.strokeStyle=u,e.lineWidth=l,e.beginPath(),e.moveTo(t,s),e.lineTo(n,a),e.stroke(),e.beginPath(),e.moveTo(n,a),e.lineTo(n-c*Math.cos(S-Math.PI/6),a-c*Math.sin(S-Math.PI/6)),e.lineTo(n-c*Math.cos(S+Math.PI/6),a-c*Math.sin(S+Math.PI/6)),e.closePath(),e.fillStyle=u,e.fill(),e.restore()}function Pe(e,t,s,n,a={}){const{color:i="#ffd700",width:u=2,focalLength:l,fMin:c=10,fMax:S=200}=a,E=n/2;let I;if(l!==void 0&&l>0){const C=Math.max(0,Math.min(1,(l-c)/(S-c)));I=n*(.25-C*.21)}else I=n*.12;e.save(),e.fillStyle="rgba(255, 215, 0, 0.08)",e.strokeStyle=i,e.lineWidth=u,e.beginPath(),e.moveTo(t,s-E),e.quadraticCurveTo(t+I,s,t,s+E),e.quadraticCurveTo(t-I,s,t,s-E),e.closePath(),e.fill(),e.stroke(),e.restore()}function me(e,t,s,n,a,i={}){const{color:u="#888888",width:l=1,dash:c=[6,6]}=i;e.save(),e.strokeStyle=u,e.lineWidth=l,e.setLineDash(c),e.beginPath(),e.moveTo(t,s),e.lineTo(n,a),e.stroke(),e.restore()}function ke(e,t,s,n,a=0){const i=n;e.save(),e.translate(t,s),e.rotate(a),e.strokeStyle="#eaeaea",e.lineWidth=1.5,e.fillStyle="rgba(234,234,234,0.05)",e.beginPath(),e.arc(0,0,i,0,Math.PI*2),e.fill(),e.stroke(),e.fillStyle="rgba(234,234,234,0.12)",e.beginPath(),e.moveTo(i*.7,-i*.55),e.quadraticCurveTo(i*1.45,0,i*.7,i*.55),e.arc(0,0,i,Math.asin(.55),-Math.asin(.55),!0),e.closePath(),e.fill(),e.stroke(),e.fillStyle="#eaeaea",e.beginPath(),e.arc(i*.75,0,i*.18,0,Math.PI*2),e.fill(),e.restore()}function Re(e,t,s,n,a){e.save(),e.fillStyle="rgba(179, 157, 219, 0.35)",e.strokeStyle="#b39ddb",e.lineWidth=2,e.fillRect(t,s,n,a),e.strokeRect(t,s,n,a),e.restore()}function Ee(e,t,s={}){const{color:n="#4da6ff",width:a=2,dash:i,glow:u}=s;e.save(),e.strokeStyle=n,e.lineWidth=a,i&&e.setLineDash(i),u&&(e.shadowColor=n,e.shadowBlur=8),e.beginPath(),t.forEach((l,c)=>{c===0?e.moveTo(l.x,l.y):e.lineTo(l.x,l.y)}),e.stroke(),e.restore()}function Ce(e,t,s,n,a,i){e.save(),e.fillStyle="rgba(77,166,255,0.06)",e.strokeStyle="rgba(77,166,255,0.5)",e.lineWidth=1.5,e.beginPath(),e.moveTo(t+8,s-n/2),e.lineTo(t+i,s-a/2),e.lineTo(t+i,s+a/2),e.lineTo(t+8,s+n/2),e.arcTo(t,s+n/2,t,s+n/2-8,8),e.lineTo(t,s-n/2+8),e.arcTo(t,s-n/2,t+8,s-n/2,8),e.closePath(),e.fill(),e.stroke(),e.restore()}function Le(e,t,s,n,a){const u=n*.12,l=n*.1,c=s+a/2;e.save(),e.fillStyle="rgba(233,69,96,0.05)",e.strokeStyle="rgba(233,69,96,0.4)",e.lineWidth=1.5,e.beginPath(),e.moveTo(t+10,s),e.lineTo(t+n-10,s),e.arcTo(t+n,s,t+n,s+10,10),e.quadraticCurveTo(t+n-l,c,t+n,s+a-10),e.arcTo(t+n,s+a,t+n-10,s+a,10),e.lineTo(t+10,s+a),e.arcTo(t,s+a,t,s+a-10,10),e.quadraticCurveTo(t-u,c,t,s+10),e.arcTo(t,s,t+10,s,10),e.closePath(),e.fill(),e.stroke(),e.restore()}function M(e,t,s,n,a={}){const{color:i="#eaeaea",background:u="rgba(0, 0, 0, 0.45)",padding:l=4,font:c=Ie}=a;e.save(),e.font=c;const E=e.measureText(t).width+l*2,I=16+l;e.fillStyle=u,e.fillRect(s-E/2,n-I/2,E,I),e.fillStyle=i,e.textAlign="center",e.textBaseline="middle",e.fillText(t,s,n+1),e.restore()}const m={accent:"#e94560",text:"#eaeaea",rayLeft:"#4da6ff",rayGreen:"#4caf50",rayYellow:"#ffc107",virtualImage:"#a855f7",lens:"#ffd700",axis:"#555555"};function He(e,t){return 1/(1/e-1/t)}function We(e,t){return-e/t}function ze(e){return!Number.isFinite(e)||Math.abs(e)>1e6?"infinity":e>0?"real":"virtual"}class De{container;canvas;ctx;controlsEl;readoutsEl;width=0;height=0;resizeObserver;rafId=null;resizeTimer=null;constructor(t){this.container=t;const s=t.querySelector("[data-canvas]"),n=t.querySelector("[data-controls]"),a=t.querySelector("[data-readouts]");if(!s||!n||!a)throw new Error("Panel container missing required elements");this.controlsEl=n,this.readoutsEl=a,this.canvas=document.createElement("canvas"),this.canvas.setAttribute("aria-label","Optics visualization"),s.appendChild(this.canvas);const i=this.canvas.getContext("2d");if(!i)throw new Error("Canvas context unavailable");this.ctx=i,this.resizeObserver=new ResizeObserver(()=>this.scheduleResize()),this.resizeObserver.observe(s),this.resize()}scheduleResize(){this.resizeTimer!==null&&window.clearTimeout(this.resizeTimer),this.resizeTimer=window.setTimeout(()=>{this.resizeTimer=null,this.resize()},120)}resize(){const t=this.canvas.parentElement;if(!t)return;const s=t.getBoundingClientRect(),n=Math.max(0,Math.floor(s.width)),a=Math.max(0,Math.floor(s.height));if(n===this.width&&a===this.height)return;const i=window.devicePixelRatio||1;this.canvas.width=Math.floor(n*i),this.canvas.height=Math.floor(a*i),this.width=n,this.height=a,this.ctx.setTransform(i,0,0,i,0,0),this.requestDraw()}requestDraw(){this.rafId!==null&&cancelAnimationFrame(this.rafId),this.rafId=requestAnimationFrame(()=>{this.rafId=null,this.render()})}addSlider(t){const s=document.createElement("div");s.className="control-row";const n=document.createElement("label");n.htmlFor=t.id,n.textContent=t.label;const a=document.createElement("div");a.className="value";const i=document.createElement("input");i.id=t.id,i.type="range",i.min=String(t.min),i.max=String(t.max),i.step=String(t.step),i.value=String(t.value);const u=l=>{const c=Number(l);a.textContent=`${c}${t.unit??""}`,t.onChange?.(c),this.requestDraw()};return i.addEventListener("input",()=>u(i.value)),u(i.value),s.appendChild(n),s.appendChild(i),s.appendChild(a),this.controlsEl.appendChild(s),i}addReadout(t){const s=document.createElement("div");s.className="readout",s.dataset.readout=t.id;const n=document.createElement("span");n.textContent=t.label;const a=document.createElement("span");return a.textContent=`--${t.unit??""}`,s.appendChild(n),s.appendChild(a),this.readoutsEl.appendChild(s),a}setReadout(t,s){const n=this.readoutsEl.querySelector(`[data-readout="${t}"] span:last-child`);n&&(n.textContent=s)}clear(){this.ctx.clearRect(0,0,this.width,this.height)}render(){this.clear();const{width:t,height:s}=this;this.ctx.fillStyle="#101424",this.ctx.fillRect(0,0,t,s),this.ctx.fillStyle="#eaeaea",this.ctx.font='14px "Space Grotesk", system-ui, sans-serif',this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("Panel rendering...",t/2,s/2)}dispose(){this.resizeObserver.disconnect(),this.resizeTimer!==null&&(window.clearTimeout(this.resizeTimer),this.resizeTimer=null)}}class Oe extends De{fInput;doInput;constructor(t){super(t),this.fInput=this.addSlider({id:"thin-lens-f",label:"Focal Length (mm)",min:10,max:200,step:1,value:40,unit:"mm"}),this.doInput=this.addSlider({id:"thin-lens-do",label:"Lens-to-Display Distance (mm)",min:5,max:500,step:1,value:100,unit:"mm"}),this.addReadout({id:"thin-lens-di",label:"Image Distance",unit:"mm"}),this.addReadout({id:"thin-lens-m",label:"Magnification",unit:"x"}),this.addReadout({id:"thin-lens-regime",label:"Regime",unit:""})}render(){this.clear();const t=this.ctx;t.fillStyle="#111122",t.fillRect(0,0,this.width,this.height);const s=Number(this.fInput.value),n=Number(this.doInput.value),a=He(s,n),i=Math.abs(n-s)<1,u=i?Number.POSITIVE_INFINITY:a,l=i?"infinity":ze(u),c=We(a,n),S=l==="infinity"?"∞":a.toFixed(0),E=Number.isFinite(c)?c.toFixed(2):"--";this.setReadout("thin-lens-di",S),this.setReadout("thin-lens-m",E);const I=l==="infinity"?"At focal point":n<s?"HMD (virtual image)":"Projector (real image)";this.setReadout("thin-lens-regime",I);const C=40,F=60,H=50,o={x:-n,y:C},p={x:0,y:0},W=[];if(l==="infinity")W.push(o.y),W.push(0),W.push(o.y);else{W.push(o.y),W.push(p.y);const r=(0-o.y)/(-s-o.x),d=o.y+r*(0-o.x);W.push(d)}const pe=Math.max(...W.map(Math.abs)),U=Math.max(pe+12,40),ee=U*2,g=[];if(g.push({x:-n,y:H}),g.push({x:-n,y:-H}),g.push({x:-n,y:C}),g.push({x:0,y:U}),g.push({x:0,y:-U}),g.push({x:-s,y:0}),g.push({x:s,y:0}),g.push({x:F+20,y:30}),g.push({x:F+20,y:-30}),l!=="infinity"){const r=C*c,f=Math.max(-2e3,Math.min(2e3,a)),h=Math.max(-400,Math.min(400,r));g.push({x:f,y:0}),g.push({x:f,y:h})}const L=280;if(l==="infinity")g.push({x:L,y:o.y}),g.push({x:L,y:o.y/n*L*-1});else{const r=-40/s,d=o.y+r*L;g.push({x:L,y:d});const f=(p.y-o.y)/(p.x-o.x),h=p.y+f*L;g.push({x:L,y:h});const A=(0-o.y)/(-s-o.x),R=o.y+A*(0-o.x);g.push({x:L,y:R})}let b=1/0,v=-1/0,T=1/0,w=-1/0;for(const r of g)r.x<b&&(b=r.x),r.x>v&&(v=r.x),r.y<T&&(T=r.y),r.y>w&&(w=r.y);const te=v-b,se=w-T,ne=.12,ae=.18;b-=te*ne,v+=te*ne,T-=se*ae,w+=se*ae;const ie=400,oe=180,re=v-b,le=w-T;if(re<ie){const r=(ie-re)/2;b-=r,v+=r}if(le<oe){const r=(oe-le)/2;T-=r,w+=r}const Q=this.width/this.height;if((v-b)/(w-T)>Q){const d=((v-b)/Q-(w-T))/2;T-=d,w+=d}else{const d=((w-T)*Q-(v-b))/2;b-=d,v+=d}const z=b,D=v,$=T,X=w,j=24,be=(this.width-j*2)/(D-z),Y=(this.height-j*2)/(X-$),y=(r,d)=>({x:j+(r-z)*be,y:this.height-j-(d-$)*Y}),P=D,k=(r,d,f)=>{Ee(t,r.map(h=>y(h.x,h.y)),{color:f??m.rayLeft,dash:d})},ce=y(z,0),de=y(D,0);me(t,ce.x,ce.y,de.x,de.y,{color:m.axis,dash:[6,6]});const V=y(z+(D-z)*.05,X-(X-$)*.08),Z=y(D-(D-z)*.05,X-(X-$)*.08);K(t,V.x,V.y,Z.x,Z.y,{color:"rgba(255,255,255,0.18)",width:1.5,headSize:8}),M(t,"light direction →",(V.x+Z.x)/2,V.y-10,{color:"rgba(255,255,255,0.35)",background:"transparent"});const x=y(0,0);if(n>s&&!i){const r=y(-n-20,0),f=y(0,0).x-r.x,h=H*2*Y+30,R=ee*Y+10;Ce(t,r.x,x.y,h,R,f),M(t,"PROJECTOR",r.x+f/2,x.y-H*Y-28,{color:"#4da6ff",background:"rgba(77,166,255,0.18)"})}else if(n<s){const r=y(-n-20,H+20),d=y(F+30,-70),f=d.x-r.x,h=d.y-r.y;Le(t,r.x,r.y,f,h),M(t,"HMD",(r.x+d.x)/2,r.y-12,{color:"#e94560",background:"rgba(233,69,96,0.18)"})}t.save(),t.strokeStyle="rgba(255, 215, 0, 0.15)",t.lineWidth=1,t.setLineDash([6,6]),t.beginPath(),t.moveTo(x.x,0),t.lineTo(x.x,this.height),t.stroke(),t.restore();const ve=ee*Y;Pe(t,x.x,x.y,ve,{color:m.lens,focalLength:s,fMin:Number(this.fInput.min),fMax:Number(this.fInput.max)});const O=y(-s,0),q=y(s,0),N=10,he='italic 11px "Space Grotesk", system-ui, sans-serif';t.save(),t.strokeStyle=m.lens,t.lineWidth=2,t.beginPath(),t.moveTo(O.x,O.y-N),t.lineTo(O.x,O.y+N),t.stroke(),t.beginPath(),t.moveTo(q.x,q.y-N),t.lineTo(q.x,q.y+N),t.stroke(),t.restore(),M(t,"f",O.x,O.y+N+12,{color:m.lens,font:he,background:"rgba(0,0,0,0.5)"}),M(t,"f′",q.x,q.y+N+12,{color:m.lens,font:he,background:"rgba(0,0,0,0.5)"});const B=y(-n,H),Te=y(-n,-H),ue=6;Re(t,B.x-ue/2,B.y,ue,Te.y-B.y),M(t,"Display",B.x,B.y-16,{background:"rgba(179, 157, 219, 0.25)"});const ye=y(-n,0),fe=y(-n,C);if(K(t,ye.x,ye.y,fe.x,fe.y,{color:m.accent,width:2.5}),l!=="infinity"){const r=C*c,d=a,f=y(d,0),h=y(d,r);l==="virtual"?(me(t,f.x,f.y,h.x,h.y,{color:m.virtualImage,dash:[6,6],width:2}),K(t,f.x,f.y,h.x,h.y,{color:m.virtualImage,width:2,headSize:6})):K(t,f.x,f.y,h.x,h.y,{color:m.rayGreen,width:2.5});const A=l==="virtual"?"Virtual Image":"Real Image",R=y(F,0).x,G=Math.abs(h.x-R)<60,_=G?h.x-50:h.x,xe=G?h.y+16:h.y-16;M(t,A,_,xe,{background:l==="virtual"?"rgba(168, 85, 247, 0.25)":"rgba(76, 175, 80, 0.2)"})}else M(t,"Image at ∞",x.x+90,x.y-40,{background:"rgba(255, 255, 255, 0.08)"});if(l==="infinity")k([{x:o.x,y:o.y},{x:p.x,y:o.y},{x:P,y:o.y}],void 0,m.rayLeft),k([{x:o.x,y:o.y},{x:p.x,y:0},{x:P,y:o.y/n*P*-1}],void 0,m.rayYellow),k([{x:o.x,y:o.y},{x:0,y:o.y},{x:P,y:o.y}],void 0,m.rayGreen);else{const r=-40/s,d={x:P,y:o.y+r*P};k([{x:o.x,y:o.y},{x:0,y:o.y},{x:d.x,y:d.y}],void 0,m.rayLeft);const f=(p.y-o.y)/(p.x-o.x),h={x:P,y:p.y+f*P};k([{x:o.x,y:o.y},{x:p.x,y:p.y},{x:h.x,y:h.y}],void 0,m.rayYellow);const A=(0-o.y)/(-s-o.x),R=o.y+A*(0-o.x),G={x:P,y:R};if(k([{x:o.x,y:o.y},{x:0,y:R},{x:G.x,y:G.y}],void 0,m.rayGreen),l==="virtual"){const _={x:a,y:C*c};k([{x:0,y:o.y},_],[6,6],m.virtualImage),k([{x:0,y:p.y},_],[6,6],m.virtualImage),k([{x:0,y:R},_],[6,6],m.virtualImage)}}const J=y(F,0),we=n<s?Math.PI:0;ke(t,J.x,J.y,14,we),M(t,"Eye",J.x,J.y-26,{color:m.text,background:"rgba(255,255,255,0.08)"});const Me=l==="infinity"?"d_o = f → image at ∞":n<s?"HMD regime: d_o < f → virtual image":"Projector regime: d_o > f → real image";M(t,Me,x.x,x.y+70,{background:n<s?"rgba(233, 69, 96, 0.2)":n>s?"rgba(77,166,255,0.15)":"rgba(255, 255, 255, 0.08)"});const Se=`1/f = 1/d_o + 1/d_i  →  1/${s} = 1/${n} + 1/${S}`;M(t,Se,this.width/2,this.height-16,{color:"rgba(255,255,255,0.6)",background:"rgba(0,0,0,0.5)",font:'11px "Space Grotesk", system-ui, sans-serif'})}}const ge=document.querySelector('[data-panel="thin-lens"]');ge&&new Oe(ge);
