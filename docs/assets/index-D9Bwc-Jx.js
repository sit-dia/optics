(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function o(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=o(s);fetch(s.href,a)}})();const rt='12px "Space Grotesk", system-ui, sans-serif';function oe(e,t,o,i,s,a={}){const{color:l="#eaeaea",width:d=2,headSize:n=8}=a,m=Math.atan2(s-o,i-t);e.save(),e.strokeStyle=l,e.lineWidth=d,e.beginPath(),e.moveTo(t,o),e.lineTo(i,s),e.stroke(),e.beginPath(),e.moveTo(i,s),e.lineTo(i-n*Math.cos(m-Math.PI/6),s-n*Math.sin(m-Math.PI/6)),e.lineTo(i-n*Math.cos(m+Math.PI/6),s-n*Math.sin(m+Math.PI/6)),e.closePath(),e.fillStyle=l,e.fill(),e.restore()}function lt(e,t,o,i,s={}){const{color:a="#ffd700",width:l=2,focalLength:d,fMin:n=10,fMax:m=200}=s,f=i/2;let v;if(d!==void 0&&d>0){const M=Math.max(0,Math.min(1,(d-n)/(m-n)));v=i*(.25-M*.21)}else v=i*.12;e.save(),e.fillStyle="rgba(255, 215, 0, 0.08)",e.strokeStyle=a,e.lineWidth=l,e.beginPath(),e.moveTo(t,o-f),e.quadraticCurveTo(t+v,o,t,o+f),e.quadraticCurveTo(t-v,o,t,o-f),e.closePath(),e.fill(),e.stroke(),e.restore()}function Fe(e,t,o,i,s,a={}){const{color:l="#888888",width:d=1,dash:n=[6,6]}=a;e.save(),e.strokeStyle=l,e.lineWidth=d,e.setLineDash(n),e.beginPath(),e.moveTo(t,o),e.lineTo(i,s),e.stroke(),e.restore()}function dt(e,t,o,i,s=0){const a=i;e.save(),e.translate(t,o),e.rotate(s),e.strokeStyle="#eaeaea",e.lineWidth=1.5,e.fillStyle="rgba(234,234,234,0.05)",e.beginPath(),e.arc(0,0,a,0,Math.PI*2),e.fill(),e.stroke(),e.fillStyle="rgba(234,234,234,0.12)",e.beginPath(),e.moveTo(a*.7,-a*.55),e.quadraticCurveTo(a*1.45,0,a*.7,a*.55),e.arc(0,0,a,Math.asin(.55),-Math.asin(.55),!0),e.closePath(),e.fill(),e.stroke(),e.fillStyle="#eaeaea",e.beginPath(),e.arc(a*.75,0,a*.18,0,Math.PI*2),e.fill(),e.restore()}function ct(e,t,o,i,s){e.save(),e.fillStyle="rgba(179, 157, 219, 0.35)",e.strokeStyle="#b39ddb",e.lineWidth=2,e.fillRect(t,o,i,s),e.strokeRect(t,o,i,s),e.restore()}function ht(e,t,o={}){const{color:i="#4da6ff",width:s=2,dash:a,glow:l}=o;e.save(),e.strokeStyle=i,e.lineWidth=s,a&&e.setLineDash(a),l&&(e.shadowColor=i,e.shadowBlur=8),e.beginPath(),t.forEach((d,n)=>{n===0?e.moveTo(d.x,d.y):e.lineTo(d.x,d.y)}),e.stroke(),e.restore()}function ft(e,t,o,i,s,a){e.save(),e.fillStyle="rgba(77,166,255,0.06)",e.strokeStyle="rgba(77,166,255,0.5)",e.lineWidth=1.5,e.beginPath(),e.moveTo(t+8,o-i/2),e.lineTo(t+a,o-s/2),e.lineTo(t+a,o+s/2),e.lineTo(t+8,o+i/2),e.arcTo(t,o+i/2,t,o+i/2-8,8),e.lineTo(t,o-i/2+8),e.arcTo(t,o-i/2,t+8,o-i/2,8),e.closePath(),e.fill(),e.stroke(),e.restore()}function mt(e,t,o,i,s){const l=i*.12,d=i*.1,n=o+s/2;e.save(),e.fillStyle="rgba(233,69,96,0.05)",e.strokeStyle="rgba(233,69,96,0.4)",e.lineWidth=1.5,e.beginPath(),e.moveTo(t+10,o),e.lineTo(t+i-10,o),e.arcTo(t+i,o,t+i,o+10,10),e.quadraticCurveTo(t+i-d,n,t+i,o+s-10),e.arcTo(t+i,o+s,t+i-10,o+s,10),e.lineTo(t+10,o+s),e.arcTo(t,o+s,t,o+s-10,10),e.quadraticCurveTo(t-l,n,t,o+10),e.arcTo(t,o,t+10,o,10),e.closePath(),e.fill(),e.stroke(),e.restore()}function ie(e,t,o,i,s={}){const a=s.intensity??.18,[l,d,n]=s.color??[255,60,60],m=36;e.save();let f;switch(t){case"left":f=e.createLinearGradient(0,0,m,0),f.addColorStop(0,`rgba(${l}, ${d}, ${n}, ${a})`),f.addColorStop(1,`rgba(${l}, ${d}, ${n}, 0.0)`),e.fillStyle=f,e.fillRect(0,0,m,i);break;case"right":f=e.createLinearGradient(o,0,o-m,0),f.addColorStop(0,`rgba(${l}, ${d}, ${n}, ${a})`),f.addColorStop(1,`rgba(${l}, ${d}, ${n}, 0.0)`),e.fillStyle=f,e.fillRect(o-m,0,m,i);break;case"top":f=e.createLinearGradient(0,0,0,m),f.addColorStop(0,`rgba(${l}, ${d}, ${n}, ${a})`),f.addColorStop(1,`rgba(${l}, ${d}, ${n}, 0.0)`),e.fillStyle=f,e.fillRect(0,0,o,m);break;case"bottom":f=e.createLinearGradient(0,i,0,i-m),f.addColorStop(0,`rgba(${l}, ${d}, ${n}, ${a})`),f.addColorStop(1,`rgba(${l}, ${d}, ${n}, 0.0)`),e.fillStyle=f,e.fillRect(0,i-m,o,m);break}e.restore()}function Ne(e,t,o,i,s,a={}){const{color:l="#ff6b6b",yPos:d}=a,n='11px "Space Grotesk", system-ui, sans-serif',m=d??i*.35;e.save(),e.font=n;const v=e.measureText(s).width+12,M=22;if(t==="left")e.fillStyle="rgba(0, 0, 0, 0.6)",e.fillRect(8,m-M/2,v,M),e.fillStyle=l,e.textAlign="left",e.textBaseline="middle",e.fillText(s,14,m);else{const T=o-8;e.fillStyle="rgba(0, 0, 0, 0.6)",e.fillRect(T-v,m-M/2,v,M),e.fillStyle=l,e.textAlign="right",e.textBaseline="middle",e.fillText(s,T-6,m)}e.restore()}function R(e,t,o,i,s={}){const{color:a="#eaeaea",background:l="rgba(0, 0, 0, 0.45)",padding:d=4,font:n=rt}=s;e.save(),e.font=n;const f=e.measureText(t).width+d*2,v=16+d;e.fillStyle=l,e.fillRect(o-f/2,i-v/2,f,v),e.fillStyle=a,e.textAlign="center",e.textBaseline="middle",e.fillText(t,o,i+1),e.restore()}const y={accent:"#e94560",text:"#eaeaea",rayLeft:"#4da6ff",rayGreen:"#4caf50",rayYellow:"#ffc107",virtualImage:"#a855f7",lens:"#ffd700",axis:"#555555"};function ut(e,t){return 1/(1/e-1/t)}function yt(e,t){return-e/t}function gt(e){return!Number.isFinite(e)||Math.abs(e)>1e6?"infinity":e>0?"real":"virtual"}class pt{container;canvas;ctx;controlsEl;readoutsEl;width=0;height=0;resizeObserver;rafId=null;resizeTimer=null;constructor(t){this.container=t;const o=t.querySelector("[data-canvas]"),i=t.querySelector("[data-controls]"),s=t.querySelector("[data-readouts]");if(!o||!i||!s)throw new Error("Panel container missing required elements");this.controlsEl=i,this.readoutsEl=s,this.canvas=document.createElement("canvas"),this.canvas.setAttribute("aria-label","Optics visualization"),o.appendChild(this.canvas);const a=this.canvas.getContext("2d");if(!a)throw new Error("Canvas context unavailable");this.ctx=a,this.resizeObserver=new ResizeObserver(()=>this.scheduleResize()),this.resizeObserver.observe(o),this.resize()}scheduleResize(){this.resizeTimer!==null&&window.clearTimeout(this.resizeTimer),this.resizeTimer=window.setTimeout(()=>{this.resizeTimer=null,this.resize()},120)}resize(){const t=this.canvas.parentElement;if(!t)return;const o=t.getBoundingClientRect(),i=Math.max(0,Math.floor(o.width)),s=Math.max(0,Math.floor(o.height));if(i===this.width&&s===this.height)return;const a=window.devicePixelRatio||1;this.canvas.width=Math.floor(i*a),this.canvas.height=Math.floor(s*a),this.width=i,this.height=s,this.ctx.setTransform(a,0,0,a,0,0),this.requestDraw()}requestDraw(){this.rafId!==null&&cancelAnimationFrame(this.rafId),this.rafId=requestAnimationFrame(()=>{this.rafId=null,this.render()})}addSlider(t){const o=document.createElement("div");o.className="control-row";const i=document.createElement("label");i.htmlFor=t.id,i.textContent=t.label;const s=document.createElement("div");s.className="value";const a=document.createElement("input");a.id=t.id,a.type="range",a.min=String(t.min),a.max=String(t.max),a.step=String(t.step),a.value=String(t.value);const l=d=>{const n=Number(d);s.textContent=`${n}${t.unit??""}`,t.onChange?.(n),this.requestDraw()};return a.addEventListener("input",()=>l(a.value)),l(a.value),o.appendChild(i),o.appendChild(a),o.appendChild(s),this.controlsEl.appendChild(o),a}addReadout(t){const o=document.createElement("div");o.className="readout",o.dataset.readout=t.id;const i=document.createElement("span");i.textContent=t.label;const s=document.createElement("span");return s.textContent=`--${t.unit??""}`,o.appendChild(i),o.appendChild(s),this.readoutsEl.appendChild(o),s}setReadout(t,o){const i=this.readoutsEl.querySelector(`[data-readout="${t}"] span:last-child`);i&&(i.textContent=o)}clear(){this.ctx.clearRect(0,0,this.width,this.height)}render(){this.clear();const{width:t,height:o}=this;this.ctx.fillStyle="#101424",this.ctx.fillRect(0,0,t,o),this.ctx.fillStyle="#eaeaea",this.ctx.font='14px "Space Grotesk", system-ui, sans-serif',this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("Panel rendering...",t/2,o/2)}dispose(){this.resizeObserver.disconnect(),this.resizeTimer!==null&&(window.clearTimeout(this.resizeTimer),this.resizeTimer=null)}}class bt{placed=[];displacements=[];place(t,o,i,s){const a={x:t-i/2,y:o-s/2};let l=a.x,d=a.y,n=!1;const m=[[0,0],[0,-s-2],[0,s+2],[-i-4,0],[i+4,0],[0,-s*2-4],[0,s*2+4],[-i-4,-s-2],[i+4,-s-2],[-i*2-8,0],[i*2+8,0],[0,-s*3-6],[0,s*3+6]];for(const[M,T]of m){const L=a.x+M,z=a.y+T;let c=!1;for(const p of this.placed)if(L<p.x+p.w&&L+i>p.x&&z<p.y+p.h&&z+s>p.y){c=!0;break}if(!c){l=L,d=z,n=M!==0||T!==0;break}}this.placed.push({x:l,y:d,w:i,h:s});const f=l+i/2,v=d+s/2;return n&&this.displacements.push({origX:t,origY:o,finalX:f,finalY:v}),{x:f,y:v}}drawLeaderLines(t){t.save(),t.strokeStyle="rgba(255, 255, 255, 0.2)",t.lineWidth=1,t.setLineDash([3,3]);for(const o of this.displacements)Math.hypot(o.finalX-o.origX,o.finalY-o.origY)>8&&(t.beginPath(),t.moveTo(o.origX,o.origY),t.lineTo(o.finalX,o.finalY),t.stroke(),t.fillStyle="rgba(255, 255, 255, 0.3)",t.beginPath(),t.arc(o.origX,o.origY,2,0,Math.PI*2),t.fill());t.restore()}}class vt extends pt{fInput;doInput;constructor(t){super(t),this.fInput=this.addSlider({id:"thin-lens-f",label:"Focal Length (mm)",min:10,max:200,step:1,value:40,unit:"mm"}),this.doInput=this.addSlider({id:"thin-lens-do",label:"Lens-to-Display Distance (mm)",min:5,max:500,step:1,value:100,unit:"mm"}),this.addReadout({id:"thin-lens-di",label:"Image Distance",unit:"mm"}),this.addReadout({id:"thin-lens-m",label:"Magnification",unit:"x"}),this.addReadout({id:"thin-lens-regime",label:"Regime",unit:""})}render(){this.clear();const t=this.ctx;t.fillStyle="#111122",t.fillRect(0,0,this.width,this.height);const o=Number(this.fInput.value),i=Number(this.doInput.value),s=ut(o,i),a=Math.max(3,o*.05),l=Math.abs(i-o)<a,d=l?Number.POSITIVE_INFINITY:s,n=l?"infinity":gt(d),m=yt(s,i),f=n==="infinity"?"∞":s.toFixed(0),v=Number.isFinite(m)?m.toFixed(2):"--";this.setReadout("thin-lens-di",f),this.setReadout("thin-lens-m",v);const M=n==="infinity"?"At focal point":i<o?"HMD (virtual image)":"Projector (real image)";this.setReadout("thin-lens-regime",M);const T=40,L=50,z=i<o?Math.max(80,o*.6):60,c={x:-i,y:T},p={x:0,y:0},ce=T*5;let O=c.y;if(n!=="infinity"){const r=-o-c.x;if(Math.abs(r)>.01){const h=(0-c.y)/r;O=c.y+h*(0-c.x),O=Math.max(-ce,Math.min(ce,O))}}const X=[];n==="infinity"?(X.push(c.y),X.push(0),X.push(c.y)):(X.push(c.y),X.push(p.y),X.push(O));const je=Math.max(...X.map(Math.abs)),J=Math.min(Math.max(je+12,40),80),he=J*2,fe=6,_e=Math.max(-fe,Math.min(fe,m)),me=T*_e,Ve=-i-40,Je=Math.max(z+40,o+20);let Ke=Math.min(Ve,-o-10),Ue=Math.max(Je,o+10);const ue=Math.max(L+20,J+10,T+20,80);let k=Ke,C=Ue,I=-ue,E=ue;const ye=C-k,ge=E-I,pe=.08,be=.12;k-=ye*pe,C+=ye*pe,I-=ge*be,E+=ge*be;const ve=300,Se=180,Te=C-k,we=E-I;if(Te<ve){const r=(ve-Te)/2;k-=r,C+=r}if(we<Se){const r=(Se-we)/2;I-=r,E+=r}const se=this.width/this.height;if((C-k)/(E-I)>se){const h=((C-k)/se-(E-I))/2;I-=h,E+=h}else{const h=((E-I)*se-(C-k))/2;k-=h,C+=h}const G=k,q=C,K=I,B=E,U=24,Qe=(this.width-U*2)/(q-G),j=(this.height-U*2)/(B-K),u=(r,h)=>({x:U+(r-G)*Qe,y:this.height-U-(h-K)*j}),$=q,W=(r,h,b)=>{ht(t,r.map(g=>u(g.x,g.y)),{color:b??y.rayLeft,dash:h})},H=new bt,D=(r,h)=>{t.save(),t.font=h??'12px "Space Grotesk", system-ui, sans-serif';const b=t.measureText(r);return t.restore(),{w:b.width+8,h:20}},Me=u(G,0),Le=u(q,0);Fe(t,Me.x,Me.y,Le.x,Le.y,{color:y.axis,dash:[6,6]});const Q=u(G+(q-G)*.05,B-(B-K)*.08),ae=u(q-(q-G)*.05,B-(B-K)*.08);oe(t,Q.x,Q.y,ae.x,ae.y,{color:"rgba(255,255,255,0.18)",width:1.5,headSize:8}),R(t,"light direction →",(Q.x+ae.x)/2,Q.y-10,{color:"rgba(255,255,255,0.35)",background:"transparent"});const w=u(0,0);if(i>o&&!l){const r=u(-i-20,0),b=u(0,0).x-r.x,g=L*2*j+30,P=he*j+10;ft(t,r.x,w.y,g,P,b)}else if(i<o){const r=-i-15,h=z+20,b=Math.max(L,J)+10,g=u(r,b),S=u(h,-b);let P=S.x-g.x,x=S.y-g.y;const Y=120,V=80;let te=g.x,Ae=g.y;if(P<Y){const de=(Y-P)/2;te-=de,P=Y}if(x<V){const de=(V-x)/2;Ae-=de,x=V}mt(t,te,Ae,P,x)}t.save(),t.strokeStyle="rgba(255, 215, 0, 0.15)",t.lineWidth=1,t.setLineDash([6,6]),t.beginPath(),t.moveTo(w.x,0),t.lineTo(w.x,this.height),t.stroke(),t.restore();const Ze=he*j,et=this.height*.8,tt=Math.min(Ze,et);lt(t,w.x,w.y,tt,{color:y.lens,focalLength:o,fMin:Number(this.fInput.min),fMax:Number(this.fInput.max)});const A=u(-o,0),F=u(o,0),N=10,Z='italic 11px "Space Grotesk", system-ui, sans-serif';t.save(),t.strokeStyle=y.lens,t.lineWidth=2,t.beginPath(),t.moveTo(A.x,A.y-N),t.lineTo(A.x,A.y+N),t.stroke(),t.beginPath(),t.moveTo(F.x,F.y-N),t.lineTo(F.x,F.y+N),t.stroke(),t.restore();const Pe=D("f",Z),Re=H.place(A.x,A.y+N+12,Pe.w,Pe.h);R(t,"f",Re.x,Re.y,{color:y.lens,font:Z,background:"rgba(0,0,0,0.5)"});const ke=D("f′",Z),Ce=H.place(F.x,F.y+N+12,ke.w,ke.h);R(t,"f′",Ce.x,Ce.y,{color:y.lens,font:Z,background:"rgba(0,0,0,0.5)"});const _=u(-i,L),ot=u(-i,-L),Ie=6;ct(t,_.x-Ie/2,_.y,Ie,ot.y-_.y);const Ee=D("Display"),$e=H.place(_.x,_.y-16,Ee.w,Ee.h);R(t,"Display",$e.x,$e.y,{background:"rgba(179, 157, 219, 0.25)"});const We=u(-i,0),He=u(-i,T);oe(t,We.x,We.y,He.x,He.y,{color:y.accent,width:2.5});const xe=n==="virtual"&&s<k,Ye=n==="real"&&s>C,ne=xe||Ye,ze=me,it=n!=="infinity"&&!ne&&ze>E,st=n!=="infinity"&&!ne&&ze<I;if(n!=="infinity"){if(!ne){const r=u(s,0),h=u(s,me);n==="virtual"?(Fe(t,r.x,r.y,h.x,h.y,{color:y.virtualImage,dash:[6,6],width:2}),oe(t,r.x,r.y,h.x,h.y,{color:y.virtualImage,width:2,headSize:6})):oe(t,r.x,r.y,h.x,h.y,{color:y.rayGreen,width:2.5});const b=n==="virtual"?"Virtual Image":"Real Image",g=D(b),S=H.place(h.x,h.y-16,g.w,g.h);R(t,b,S.x,S.y,{background:n==="virtual"?"rgba(168, 85, 247, 0.25)":"rgba(76, 175, 80, 0.2)"})}}else R(t,"Image at ∞",w.x+90,w.y-40,{background:"rgba(255, 255, 255, 0.08)"});if(n==="infinity")W([{x:c.x,y:c.y},{x:p.x,y:c.y},{x:$,y:c.y}],void 0,y.rayLeft),W([{x:c.x,y:c.y},{x:p.x,y:0},{x:$,y:c.y/i*$*-1}],void 0,y.rayYellow),W([{x:c.x,y:c.y},{x:0,y:c.y},{x:$,y:c.y}],void 0,y.rayGreen);else{const r=-40/o,h={x:$,y:c.y+r*$};W([{x:c.x,y:c.y},{x:0,y:c.y},{x:h.x,y:h.y}],void 0,y.rayLeft);const b=(p.y-c.y)/(p.x-c.x),g={x:$,y:p.y+b*$};W([{x:c.x,y:c.y},{x:p.x,y:p.y},{x:g.x,y:g.y}],void 0,y.rayYellow);const S={x:$,y:O};if(W([{x:c.x,y:c.y},{x:0,y:O},{x:S.x,y:S.y}],void 0,y.rayGreen),n==="virtual"){const P=-40/o,x=(p.y-c.y)/(p.x-c.x),Y=G,V=c.y+P*Y;W([{x:0,y:c.y},{x:Y,y:V}],[6,6],y.virtualImage);const te=p.y+x*Y;W([{x:0,y:p.y},{x:Y,y:te}],[6,6],y.virtualImage),W([{x:0,y:O},{x:Y,y:O}],[6,6],y.virtualImage)}}const ee=u(z,0),at=i<o?Math.PI:0;dt(t,ee.x,ee.y,14,at);const Oe=D("Eye"),De=H.place(ee.x,ee.y-26,Oe.w,Oe.h);if(R(t,"Eye",De.x,De.y,{color:y.text,background:"rgba(255,255,255,0.08)"}),i>o&&!l){const r=u(-i-20,0),b=u(0,0).x-r.x,g=D("PROJECTOR"),S=H.place(r.x+b/2,w.y-L*j-28,g.w,g.h);R(t,"PROJECTOR",S.x,S.y,{color:"#4da6ff",background:"rgba(77,166,255,0.18)"})}else if(i<o){const r=-i-15,h=z+20,b=Math.max(L,J)+10,g=u(r,b),S=u(h,-b),P=D("HMD"),x=H.place((g.x+S.x)/2,g.y-12,P.w,P.h);R(t,"HMD",x.x,x.y,{color:"#e94560",background:"rgba(233,69,96,0.18)"})}const Xe=n==="infinity"?"d_o = f → image at ∞":i<o?"HMD regime: d_o < f → virtual image":"Projector regime: d_o > f → real image",Ge=D(Xe),qe=H.place(w.x,w.y+70,Ge.w,Ge.h);R(t,Xe,qe.x,qe.y,{background:i<o?"rgba(233, 69, 96, 0.2)":i>o?"rgba(77,166,255,0.15)":"rgba(255, 255, 255, 0.08)"});const re=[168,85,247],le=[76,175,80];if(n!=="infinity"){if(xe){ie(t,"left",this.width,this.height,{color:re});const r=Math.abs(s).toFixed(0);Ne(t,"left",this.width,this.height,"← Virtual Image "+r+"mm",{color:y.virtualImage,yPos:w.y-20})}if(Ye){ie(t,"right",this.width,this.height,{color:le});const r=s.toFixed(0);Ne(t,"right",this.width,this.height,"Real Image "+r+"mm →",{color:y.rayGreen,yPos:w.y-20})}if(it){const r=i<o?re:le;ie(t,"top",this.width,this.height,{color:r})}if(st){const r=i<o?re:le;ie(t,"bottom",this.width,this.height,{color:r})}}H.drawLeaderLines(t);const nt=`1/f = 1/d_o + 1/d_i  →  1/${o} = 1/${i} + 1/${f}`;R(t,nt,this.width/2,this.height-16,{color:"rgba(255,255,255,0.6)",background:"rgba(0,0,0,0.5)",font:'11px "Space Grotesk", system-ui, sans-serif'})}}const Be=document.querySelector('[data-panel="thin-lens"]');Be&&new vt(Be);
