(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&a(d)}).observe(document,{childList:!0,subtree:!0});function i(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(s){if(s.ep)return;s.ep=!0;const o=i(s);fetch(s.href,o)}})();const se='12px "Space Grotesk", system-ui, sans-serif';function q(e,t,i,a,s,o={}){const{color:d="#eaeaea",width:n=2,headSize:l=8}=o,T=Math.atan2(s-i,a-t);e.save(),e.strokeStyle=d,e.lineWidth=n,e.beginPath(),e.moveTo(t,i),e.lineTo(a,s),e.stroke(),e.beginPath(),e.moveTo(a,s),e.lineTo(a-l*Math.cos(T-Math.PI/6),s-l*Math.sin(T-Math.PI/6)),e.lineTo(a-l*Math.cos(T+Math.PI/6),s-l*Math.sin(T+Math.PI/6)),e.closePath(),e.fillStyle=d,e.fill(),e.restore()}function oe(e,t,i,a,s={}){const{color:o="#ffd700",width:d=2}=s,n=a/2,l=a*.12;e.save(),e.fillStyle="rgba(255, 215, 0, 0.08)",e.strokeStyle=o,e.lineWidth=d,e.beginPath(),e.moveTo(t,i-n),e.quadraticCurveTo(t+l,i,t,i+n),e.quadraticCurveTo(t-l,i,t,i-n),e.closePath(),e.fill(),e.stroke(),e.restore()}function Q(e,t,i,a,s,o={}){const{color:d="#888888",width:n=1,dash:l=[6,6]}=o;e.save(),e.strokeStyle=d,e.lineWidth=n,e.setLineDash(l),e.beginPath(),e.moveTo(t,i),e.lineTo(a,s),e.stroke(),e.restore()}function ne(e,t,i,a,s=0){const o=a;e.save(),e.translate(t,i),e.rotate(s),e.strokeStyle="#eaeaea",e.lineWidth=1.5,e.fillStyle="rgba(234,234,234,0.05)",e.beginPath(),e.arc(0,0,o,0,Math.PI*2),e.fill(),e.stroke(),e.fillStyle="rgba(234,234,234,0.12)",e.beginPath(),e.moveTo(o*.7,-o*.55),e.quadraticCurveTo(o*1.45,0,o*.7,o*.55),e.arc(0,0,o,Math.asin(.55),-Math.asin(.55),!0),e.closePath(),e.fill(),e.stroke(),e.fillStyle="#eaeaea",e.beginPath(),e.arc(o*.75,0,o*.18,0,Math.PI*2),e.fill(),e.restore()}function re(e,t,i,a,s){e.save(),e.fillStyle="rgba(179, 157, 219, 0.35)",e.strokeStyle="#b39ddb",e.lineWidth=2,e.fillRect(t,i,a,s),e.strokeRect(t,i,a,s),e.restore()}function le(e,t,i={}){const{color:a="#4da6ff",width:s=2,dash:o,glow:d}=i;e.save(),e.strokeStyle=a,e.lineWidth=s,o&&e.setLineDash(o),d&&(e.shadowColor=a,e.shadowBlur=8),e.beginPath(),t.forEach((n,l)=>{l===0?e.moveTo(n.x,n.y):e.lineTo(n.x,n.y)}),e.stroke(),e.restore()}function de(e,t,i,a,s,o){e.save(),e.fillStyle="rgba(77,166,255,0.06)",e.strokeStyle="rgba(77,166,255,0.5)",e.lineWidth=1.5,e.beginPath(),e.moveTo(t+8,i-a/2),e.lineTo(t+o,i-s/2),e.lineTo(t+o,i+s/2),e.lineTo(t+8,i+a/2),e.arcTo(t,i+a/2,t,i+a/2-8,8),e.lineTo(t,i-a/2+8),e.arcTo(t,i-a/2,t+8,i-a/2,8),e.closePath(),e.fill(),e.stroke(),e.restore()}function ce(e,t,i,a,s){const d=a*.12,n=a*.1,l=i+s/2;e.save(),e.fillStyle="rgba(233,69,96,0.05)",e.strokeStyle="rgba(233,69,96,0.4)",e.lineWidth=1.5,e.beginPath(),e.moveTo(t+10,i),e.lineTo(t+a-10,i),e.arcTo(t+a,i,t+a,i+10,10),e.quadraticCurveTo(t+a-n,l,t+a,i+s-10),e.arcTo(t+a,i+s,t+a-10,i+s,10),e.lineTo(t+10,i+s),e.arcTo(t,i+s,t,i+s-10,10),e.quadraticCurveTo(t-d,l,t,i+10),e.arcTo(t,i,t+10,i,10),e.closePath(),e.fill(),e.stroke(),e.restore()}function g(e,t,i,a,s={}){const{color:o="#eaeaea",background:d="rgba(0, 0, 0, 0.45)",padding:n=4,font:l=se}=s;e.save(),e.font=l;const E=e.measureText(t).width+n*2,M=16+n;e.fillStyle=d,e.fillRect(i-E/2,a-M/2,E,M),e.fillStyle=o,e.textAlign="center",e.textBaseline="middle",e.fillText(t,i,a+1),e.restore()}const c={accent:"#e94560",text:"#eaeaea",rayLeft:"#4da6ff",rayGreen:"#4caf50",rayYellow:"#ffc107",virtualImage:"#a855f7",lens:"#ffd700",axis:"#555555"};function he(e,t){return 1/(1/e-1/t)}function ue(e,t){return-e/t}function ye(e){return!Number.isFinite(e)||Math.abs(e)>1e6?"infinity":e>0?"real":"virtual"}class fe{container;canvas;ctx;controlsEl;readoutsEl;width=0;height=0;resizeObserver;rafId=null;resizeTimer=null;constructor(t){this.container=t;const i=t.querySelector("[data-canvas]"),a=t.querySelector("[data-controls]"),s=t.querySelector("[data-readouts]");if(!i||!a||!s)throw new Error("Panel container missing required elements");this.controlsEl=a,this.readoutsEl=s,this.canvas=document.createElement("canvas"),this.canvas.setAttribute("aria-label","Optics visualization"),i.appendChild(this.canvas);const o=this.canvas.getContext("2d");if(!o)throw new Error("Canvas context unavailable");this.ctx=o,this.resizeObserver=new ResizeObserver(()=>this.scheduleResize()),this.resizeObserver.observe(i),this.resize()}scheduleResize(){this.resizeTimer!==null&&window.clearTimeout(this.resizeTimer),this.resizeTimer=window.setTimeout(()=>{this.resizeTimer=null,this.resize()},120)}resize(){const t=this.canvas.parentElement;if(!t)return;const i=t.getBoundingClientRect(),a=Math.max(0,Math.floor(i.width)),s=Math.max(0,Math.floor(i.height));if(a===this.width&&s===this.height)return;const o=window.devicePixelRatio||1;this.canvas.width=Math.floor(a*o),this.canvas.height=Math.floor(s*o),this.width=a,this.height=s,this.ctx.setTransform(o,0,0,o,0,0),this.requestDraw()}requestDraw(){this.rafId!==null&&cancelAnimationFrame(this.rafId),this.rafId=requestAnimationFrame(()=>{this.rafId=null,this.render()})}addSlider(t){const i=document.createElement("div");i.className="control-row";const a=document.createElement("label");a.htmlFor=t.id,a.textContent=t.label;const s=document.createElement("div");s.className="value";const o=document.createElement("input");o.id=t.id,o.type="range",o.min=String(t.min),o.max=String(t.max),o.step=String(t.step),o.value=String(t.value);const d=n=>{const l=Number(n);s.textContent=`${l}${t.unit??""}`,t.onChange?.(l),this.requestDraw()};return o.addEventListener("input",()=>d(o.value)),d(o.value),i.appendChild(a),i.appendChild(o),i.appendChild(s),this.controlsEl.appendChild(i),o}addReadout(t){const i=document.createElement("div");i.className="readout",i.dataset.readout=t.id;const a=document.createElement("span");a.textContent=t.label;const s=document.createElement("span");return s.textContent=`--${t.unit??""}`,i.appendChild(a),i.appendChild(s),this.readoutsEl.appendChild(i),s}setReadout(t,i){const a=this.readoutsEl.querySelector(`[data-readout="${t}"] span:last-child`);a&&(a.textContent=i)}clear(){this.ctx.clearRect(0,0,this.width,this.height)}render(){this.clear();const{width:t,height:i}=this;this.ctx.fillStyle="#101424",this.ctx.fillRect(0,0,t,i),this.ctx.fillStyle="#eaeaea",this.ctx.font='14px "Space Grotesk", system-ui, sans-serif',this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("Panel rendering...",t/2,i/2)}dispose(){this.resizeObserver.disconnect(),this.resizeTimer!==null&&(window.clearTimeout(this.resizeTimer),this.resizeTimer=null)}}class me extends fe{fInput;doInput;constructor(t){super(t),this.fInput=this.addSlider({id:"thin-lens-f",label:"Focal Length (mm)",min:10,max:200,step:1,value:40,unit:"mm"}),this.doInput=this.addSlider({id:"thin-lens-do",label:"Lens-to-Display Distance (mm)",min:5,max:500,step:1,value:100,unit:"mm"}),this.addReadout({id:"thin-lens-di",label:"Image Distance",unit:"mm"}),this.addReadout({id:"thin-lens-m",label:"Magnification",unit:"x"}),this.addReadout({id:"thin-lens-regime",label:"Regime",unit:""})}render(){this.clear();const t=this.ctx;t.fillStyle="#111122",t.fillRect(0,0,this.width,this.height);const i=Number(this.fInput.value),a=Number(this.doInput.value),s=he(i,a),o=Math.abs(a-i)<1,d=o?Number.POSITIVE_INFINITY:s,n=o?"infinity":ye(d),l=ue(s,a),T=n==="infinity"?"∞":s.toFixed(0),E=Number.isFinite(l)?l.toFixed(2):"--";this.setReadout("thin-lens-di",T),this.setReadout("thin-lens-m",E);const M=n==="infinity"?"At focal point":a<i?"HMD (virtual image)":"Projector (real image)";this.setReadout("thin-lens-regime",M);const C=24,z=-280,L=280,G=-120,N=120,x=(this.width-C*2)/(L-z),H=(this.height-C*2)/(N-G),h=(u,m)=>({x:C+(u-z)*x,y:this.height-C-(m-G)*H}),v=(u,m,f)=>{le(t,u.map(y=>h(y.x,y.y)),{color:f??c.rayLeft,dash:m})},_=h(z,0),$=h(L,0);Q(t,_.x,_.y,$.x,$.y,{color:c.axis,dash:[6,6]});const D=h(z+20,N-14),F=h(L-20,N-14);q(t,D.x,D.y,F.x,F.y,{color:"rgba(255,255,255,0.18)",width:1.5,headSize:8}),g(t,"light direction →",(D.x+F.x)/2,D.y-10,{color:"rgba(255,255,255,0.35)",background:"transparent"});const b=h(0,0),j=60,R=50;if(a>i&&!o){const u=h(-a-20,0),f=h(0,0).x-u.x,y=R*2*H+30;de(t,u.x,b.y,y,150,f),g(t,"PROJECTOR",u.x+f/2,b.y-R*H-28,{color:"#4da6ff",background:"rgba(77,166,255,0.18)"})}else if(a<i){const u=h(-a-20,R+20),m=h(j+30,-70),f=m.x-u.x,y=m.y-u.y;ce(t,u.x,u.y,f,y),g(t,"HMD",(u.x+m.x)/2,u.y-12,{color:"#e94560",background:"rgba(233,69,96,0.18)"})}t.save(),t.strokeStyle="rgba(255, 215, 0, 0.15)",t.lineWidth=1,t.setLineDash([6,6]),t.beginPath(),t.moveTo(b.x,0),t.lineTo(b.x,this.height),t.stroke(),t.restore(),oe(t,b.x,b.y,140,{color:c.lens});const S=h(-i,0),k=h(i,0),P=10,Y='italic 11px "Space Grotesk", system-ui, sans-serif';t.save(),t.strokeStyle=c.lens,t.lineWidth=2,t.beginPath(),t.moveTo(S.x,S.y-P),t.lineTo(S.x,S.y+P),t.stroke(),t.beginPath(),t.moveTo(k.x,k.y-P),t.lineTo(k.x,k.y+P),t.stroke(),t.restore(),g(t,"f",S.x,S.y-P-10,{color:c.lens,font:Y,background:"rgba(0,0,0,0.5)"}),g(t,"f′",k.x,k.y-P-10,{color:c.lens,font:Y,background:"rgba(0,0,0,0.5)"});const I=h(-a,R),ee=h(-a,-R),X=6;re(t,I.x-X/2,I.y,X,ee.y-I.y),g(t,"Display",I.x,I.y-14,{background:"rgba(179, 157, 219, 0.25)"});const O=40,V=h(-a,0),J=h(-a,O);q(t,V.x,V.y,J.x,J.y,{color:c.accent,width:2.5});const w={x:0,y:0},r={x:-a,y:O},p=L;if(n!=="infinity"){const u=O*l,m=s,f=h(m,0),y=h(m,u);n==="virtual"?(Q(t,f.x,f.y,y.x,y.y,{color:c.virtualImage,dash:[6,6],width:2}),q(t,f.x,f.y,y.x,y.y,{color:c.virtualImage,width:2,headSize:6})):q(t,f.x,f.y,y.x,y.y,{color:c.rayGreen,width:2.5}),g(t,n==="virtual"?"Virtual Image":"Real Image",y.x,y.y-16,{background:n==="virtual"?"rgba(168, 85, 247, 0.25)":"rgba(76, 175, 80, 0.2)"})}else g(t,"Image at ∞",b.x+90,b.y-40,{background:"rgba(255, 255, 255, 0.08)"});if(n==="infinity")v([{x:r.x,y:r.y},{x:w.x,y:r.y},{x:p,y:r.y}],void 0,c.rayLeft),v([{x:r.x,y:r.y},{x:w.x,y:0},{x:p,y:r.y/a*p*-1}],void 0,c.rayYellow),v([{x:r.x,y:r.y},{x:0,y:r.y},{x:p,y:r.y}],void 0,c.rayGreen);else{const u=-40/i,m={x:p,y:r.y+u*p};v([{x:r.x,y:r.y},{x:0,y:r.y},{x:m.x,y:m.y}],void 0,c.rayLeft);const f=(w.y-r.y)/(w.x-r.x),y={x:p,y:w.y+f*p};v([{x:r.x,y:r.y},{x:w.x,y:w.y},{x:y.x,y:y.y}],void 0,c.rayYellow);const K=(0-r.y)/(-i-r.x),A=r.y+K*(0-r.x),U={x:p,y:A};if(v([{x:r.x,y:r.y},{x:0,y:A},{x:U.x,y:U.y}],void 0,c.rayGreen),n==="virtual"){const B={x:s,y:O*l};v([{x:0,y:r.y},B],[6,6],c.virtualImage),v([{x:0,y:w.y},B],[6,6],c.virtualImage),v([{x:0,y:A},B],[6,6],c.virtualImage)}}const W=h(j,0),te=a<i?Math.PI:0;ne(t,W.x,W.y,14,te),g(t,"Eye",W.x,W.y-22,{color:c.text,background:"rgba(255,255,255,0.08)"});const ie=n==="infinity"?"d_o = f → image at ∞":a<i?"HMD regime: d_o < f → virtual image":"Projector regime: d_o > f → real image";g(t,ie,b.x,b.y+90,{background:a<i?"rgba(233, 69, 96, 0.2)":a>i?"rgba(77,166,255,0.15)":"rgba(255, 255, 255, 0.08)"});const ae=`1/f = 1/d_o + 1/d_i  →  1/${i} = 1/${a} + 1/${T}`;g(t,ae,this.width/2,this.height-16,{color:"rgba(255,255,255,0.6)",background:"rgba(0,0,0,0.5)",font:'11px "Space Grotesk", system-ui, sans-serif'})}}const Z=document.querySelector('[data-panel="thin-lens"]');Z&&new me(Z);
