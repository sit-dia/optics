(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function a(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=a(s);fetch(s.href,o)}})();const oe='12px "Space Grotesk", system-ui, sans-serif';function A(e,t,a,i,s,o={}){const{color:d="#eaeaea",width:n=2,headSize:l=8}=o,T=Math.atan2(s-a,i-t);e.save(),e.strokeStyle=d,e.lineWidth=n,e.beginPath(),e.moveTo(t,a),e.lineTo(i,s),e.stroke(),e.beginPath(),e.moveTo(i,s),e.lineTo(i-l*Math.cos(T-Math.PI/6),s-l*Math.sin(T-Math.PI/6)),e.lineTo(i-l*Math.cos(T+Math.PI/6),s-l*Math.sin(T+Math.PI/6)),e.closePath(),e.fillStyle=d,e.fill(),e.restore()}function ne(e,t,a,i,s={}){const{color:o="#ffd700",width:d=2}=s,n=i/2,l=i*.12;e.save(),e.fillStyle="rgba(255, 215, 0, 0.08)",e.strokeStyle=o,e.lineWidth=d,e.beginPath(),e.moveTo(t,a-n),e.quadraticCurveTo(t+l,a,t,a+n),e.quadraticCurveTo(t-l,a,t,a-n),e.closePath(),e.fill(),e.stroke(),e.restore()}function U(e,t,a,i,s,o={}){const{color:d="#888888",width:n=1,dash:l=[6,6]}=o;e.save(),e.strokeStyle=d,e.lineWidth=n,e.setLineDash(l),e.beginPath(),e.moveTo(t,a),e.lineTo(i,s),e.stroke(),e.restore()}function re(e,t,a,i,s=0){const o=i;e.save(),e.translate(t,a),e.rotate(s),e.strokeStyle="#eaeaea",e.lineWidth=1.5,e.fillStyle="rgba(234,234,234,0.05)",e.beginPath(),e.arc(0,0,o,0,Math.PI*2),e.fill(),e.stroke(),e.fillStyle="rgba(234,234,234,0.12)",e.beginPath(),e.moveTo(o*.7,-o*.55),e.quadraticCurveTo(o*1.45,0,o*.7,o*.55),e.arc(0,0,o,Math.asin(.55),-Math.asin(.55),!0),e.closePath(),e.fill(),e.stroke(),e.fillStyle="#eaeaea",e.beginPath(),e.arc(o*.75,0,o*.18,0,Math.PI*2),e.fill(),e.restore()}function le(e,t,a,i,s){e.save(),e.fillStyle="rgba(179, 157, 219, 0.35)",e.strokeStyle="#b39ddb",e.lineWidth=2,e.fillRect(t,a,i,s),e.strokeRect(t,a,i,s),e.restore()}function de(e,t,a={}){const{color:i="#4da6ff",width:s=2,dash:o,glow:d}=a;e.save(),e.strokeStyle=i,e.lineWidth=s,o&&e.setLineDash(o),d&&(e.shadowColor=i,e.shadowBlur=8),e.beginPath(),t.forEach((n,l)=>{l===0?e.moveTo(n.x,n.y):e.lineTo(n.x,n.y)}),e.stroke(),e.restore()}function ce(e,t,a,i,s,o){e.save(),e.fillStyle="rgba(77,166,255,0.06)",e.strokeStyle="rgba(77,166,255,0.5)",e.lineWidth=1.5,e.beginPath(),e.moveTo(t+8,a-i/2),e.lineTo(t+o,a-s/2),e.lineTo(t+o,a+s/2),e.lineTo(t+8,a+i/2),e.arcTo(t,a+i/2,t,a+i/2-8,8),e.lineTo(t,a-i/2+8),e.arcTo(t,a-i/2,t+8,a-i/2,8),e.closePath(),e.fill(),e.stroke(),e.restore()}function he(e,t,a,i,s){const d=i*.12,n=i*.1,l=a+s/2;e.save(),e.fillStyle="rgba(233,69,96,0.05)",e.strokeStyle="rgba(233,69,96,0.4)",e.lineWidth=1.5,e.beginPath(),e.moveTo(t+10,a),e.lineTo(t+i-10,a),e.arcTo(t+i,a,t+i,a+10,10),e.quadraticCurveTo(t+i-n,l,t+i,a+s-10),e.arcTo(t+i,a+s,t+i-10,a+s,10),e.lineTo(t+10,a+s),e.arcTo(t,a+s,t,a+s-10,10),e.quadraticCurveTo(t-d,l,t,a+10),e.arcTo(t,a,t+10,a,10),e.closePath(),e.fill(),e.stroke(),e.restore()}function g(e,t,a,i,s={}){const{color:o="#eaeaea",background:d="rgba(0, 0, 0, 0.45)",padding:n=4,font:l=oe}=s;e.save(),e.font=l;const L=e.measureText(t).width+n*2,z=16+n;e.fillStyle=d,e.fillRect(a-L/2,i-z/2,L,z),e.fillStyle=o,e.textAlign="center",e.textBaseline="middle",e.fillText(t,a,i+1),e.restore()}const u={accent:"#e94560",text:"#eaeaea",rayLeft:"#4da6ff",rayGreen:"#4caf50",rayYellow:"#ffc107",virtualImage:"#a855f7",lens:"#ffd700",axis:"#555555"};function ue(e,t){return 1/(1/e-1/t)}function ye(e,t){return-e/t}function me(e){return!Number.isFinite(e)||Math.abs(e)>1e6?"infinity":e>0?"real":"virtual"}class fe{container;canvas;ctx;controlsEl;readoutsEl;width=0;height=0;resizeObserver;rafId=null;resizeTimer=null;constructor(t){this.container=t;const a=t.querySelector("[data-canvas]"),i=t.querySelector("[data-controls]"),s=t.querySelector("[data-readouts]");if(!a||!i||!s)throw new Error("Panel container missing required elements");this.controlsEl=i,this.readoutsEl=s,this.canvas=document.createElement("canvas"),this.canvas.setAttribute("aria-label","Optics visualization"),a.appendChild(this.canvas);const o=this.canvas.getContext("2d");if(!o)throw new Error("Canvas context unavailable");this.ctx=o,this.resizeObserver=new ResizeObserver(()=>this.scheduleResize()),this.resizeObserver.observe(a),this.resize()}scheduleResize(){this.resizeTimer!==null&&window.clearTimeout(this.resizeTimer),this.resizeTimer=window.setTimeout(()=>{this.resizeTimer=null,this.resize()},120)}resize(){const t=this.canvas.parentElement;if(!t)return;const a=t.getBoundingClientRect(),i=Math.max(0,Math.floor(a.width)),s=Math.max(0,Math.floor(a.height));if(i===this.width&&s===this.height)return;const o=window.devicePixelRatio||1;this.canvas.width=Math.floor(i*o),this.canvas.height=Math.floor(s*o),this.width=i,this.height=s,this.ctx.setTransform(o,0,0,o,0,0),this.requestDraw()}requestDraw(){this.rafId!==null&&cancelAnimationFrame(this.rafId),this.rafId=requestAnimationFrame(()=>{this.rafId=null,this.render()})}addSlider(t){const a=document.createElement("div");a.className="control-row";const i=document.createElement("label");i.htmlFor=t.id,i.textContent=t.label;const s=document.createElement("div");s.className="value";const o=document.createElement("input");o.id=t.id,o.type="range",o.min=String(t.min),o.max=String(t.max),o.step=String(t.step),o.value=String(t.value);const d=n=>{const l=Number(n);s.textContent=`${l}${t.unit??""}`,t.onChange?.(l),this.requestDraw()};return o.addEventListener("input",()=>d(o.value)),d(o.value),a.appendChild(i),a.appendChild(o),a.appendChild(s),this.controlsEl.appendChild(a),o}addReadout(t){const a=document.createElement("div");a.className="readout",a.dataset.readout=t.id;const i=document.createElement("span");i.textContent=t.label;const s=document.createElement("span");return s.textContent=`--${t.unit??""}`,a.appendChild(i),a.appendChild(s),this.readoutsEl.appendChild(a),s}setReadout(t,a){const i=this.readoutsEl.querySelector(`[data-readout="${t}"] span:last-child`);i&&(i.textContent=a)}clear(){this.ctx.clearRect(0,0,this.width,this.height)}render(){this.clear();const{width:t,height:a}=this;this.ctx.fillStyle="#101424",this.ctx.fillRect(0,0,t,a),this.ctx.fillStyle="#eaeaea",this.ctx.font='14px "Space Grotesk", system-ui, sans-serif',this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("Panel rendering...",t/2,a/2)}dispose(){this.resizeObserver.disconnect(),this.resizeTimer!==null&&(window.clearTimeout(this.resizeTimer),this.resizeTimer=null)}}class ge extends fe{fInput;doInput;constructor(t){super(t),this.fInput=this.addSlider({id:"thin-lens-f",label:"Focal Length (mm)",min:10,max:200,step:1,value:40,unit:"mm"}),this.doInput=this.addSlider({id:"thin-lens-do",label:"Lens-to-Display Distance (mm)",min:5,max:500,step:1,value:100,unit:"mm"}),this.addReadout({id:"thin-lens-di",label:"Image Distance",unit:"mm"}),this.addReadout({id:"thin-lens-m",label:"Magnification",unit:"x"}),this.addReadout({id:"thin-lens-regime",label:"Regime",unit:""})}render(){this.clear();const t=this.ctx;t.fillStyle="#111122",t.fillRect(0,0,this.width,this.height);const a=Number(this.fInput.value),i=Number(this.doInput.value),s=ue(a,i),o=Math.abs(i-a)<1,d=o?Number.POSITIVE_INFINITY:s,n=o?"infinity":me(d),l=ye(s,i),T=n==="infinity"?"∞":s.toFixed(0),L=Number.isFinite(l)?l.toFixed(2):"--";this.setReadout("thin-lens-di",T),this.setReadout("thin-lens-m",L);const z=n==="infinity"?"At focal point":i<a?"HMD (virtual image)":"Projector (real image)";this.setReadout("thin-lens-regime",z);const D=24,O=-280,W=280,j=-120,B=120,Z=(this.width-D*2)/(W-O),G=(this.height-D*2)/(B-j),h=(y,f)=>({x:D+(y-O)*Z,y:this.height-D-(f-j)*G}),v=(y,f,m)=>{de(t,y.map(c=>h(c.x,c.y)),{color:m??u.rayLeft,dash:f})},X=h(O,0),Y=h(W,0);U(t,X.x,X.y,Y.x,Y.y,{color:u.axis,dash:[6,6]});const q=h(O+20,B-14),_=h(W-20,B-14);A(t,q.x,q.y,_.x,_.y,{color:"rgba(255,255,255,0.18)",width:1.5,headSize:8}),g(t,"light direction →",(q.x+_.x)/2,q.y-10,{color:"rgba(255,255,255,0.35)",background:"transparent"});const b=h(0,0),$=60,R=50;if(i>a&&!o){const y=h(-i-20,0),m=h(0,0).x-y.x,c=R*2*G+30;ce(t,y.x,b.y,c,150,m),g(t,"PROJECTOR",y.x+m/2,b.y-R*G-28,{color:"#4da6ff",background:"rgba(77,166,255,0.18)"})}else if(i<a){const y=h(-i-20,R+20),f=h($+30,-70),m=f.x-y.x,c=f.y-y.y;he(t,y.x,y.y,m,c),g(t,"HMD",(y.x+f.x)/2,y.y-12,{color:"#e94560",background:"rgba(233,69,96,0.18)"})}t.save(),t.strokeStyle="rgba(255, 215, 0, 0.15)",t.lineWidth=1,t.setLineDash([6,6]),t.beginPath(),t.moveTo(b.x,0),t.lineTo(b.x,this.height),t.stroke(),t.restore(),ne(t,b.x,b.y,140,{color:u.lens});const S=h(-a,0),k=h(a,0),P=10,V='italic 11px "Space Grotesk", system-ui, sans-serif';t.save(),t.strokeStyle=u.lens,t.lineWidth=2,t.beginPath(),t.moveTo(S.x,S.y-P),t.lineTo(S.x,S.y+P),t.stroke(),t.beginPath(),t.moveTo(k.x,k.y-P),t.lineTo(k.x,k.y+P),t.stroke(),t.restore(),g(t,"f",S.x,S.y+P+12,{color:u.lens,font:V,background:"rgba(0,0,0,0.5)"}),g(t,"f′",k.x,k.y+P+12,{color:u.lens,font:V,background:"rgba(0,0,0,0.5)"});const I=h(-i,R),ee=h(-i,-R),x=6;le(t,I.x-x/2,I.y,x,ee.y-I.y),g(t,"Display",I.x,I.y-16,{background:"rgba(179, 157, 219, 0.25)"});const N=40,J=h(-i,0),K=h(-i,N);A(t,J.x,J.y,K.x,K.y,{color:u.accent,width:2.5});const w={x:0,y:0},r={x:-i,y:N},p=W;if(n!=="infinity"){const y=N*l,f=s,m=h(f,0),c=h(f,y);n==="virtual"?(U(t,m.x,m.y,c.x,c.y,{color:u.virtualImage,dash:[6,6],width:2}),A(t,m.x,m.y,c.x,c.y,{color:u.virtualImage,width:2,headSize:6})):A(t,m.x,m.y,c.x,c.y,{color:u.rayGreen,width:2.5});const F=n==="virtual"?"Virtual Image":"Real Image",E=h($,0).x,M=Math.abs(c.x-E)<60,C=M?c.x-50:c.x,se=M?c.y+16:c.y-16;g(t,F,C,se,{background:n==="virtual"?"rgba(168, 85, 247, 0.25)":"rgba(76, 175, 80, 0.2)"})}else g(t,"Image at ∞",b.x+90,b.y-40,{background:"rgba(255, 255, 255, 0.08)"});if(n==="infinity")v([{x:r.x,y:r.y},{x:w.x,y:r.y},{x:p,y:r.y}],void 0,u.rayLeft),v([{x:r.x,y:r.y},{x:w.x,y:0},{x:p,y:r.y/i*p*-1}],void 0,u.rayYellow),v([{x:r.x,y:r.y},{x:0,y:r.y},{x:p,y:r.y}],void 0,u.rayGreen);else{const y=-40/a,f={x:p,y:r.y+y*p};v([{x:r.x,y:r.y},{x:0,y:r.y},{x:f.x,y:f.y}],void 0,u.rayLeft);const m=(w.y-r.y)/(w.x-r.x),c={x:p,y:w.y+m*p};v([{x:r.x,y:r.y},{x:w.x,y:w.y},{x:c.x,y:c.y}],void 0,u.rayYellow);const F=(0-r.y)/(-a-r.x),E=r.y+F*(0-r.x),M={x:p,y:E};if(v([{x:r.x,y:r.y},{x:0,y:E},{x:M.x,y:M.y}],void 0,u.rayGreen),n==="virtual"){const C={x:s,y:N*l};v([{x:0,y:r.y},C],[6,6],u.virtualImage),v([{x:0,y:w.y},C],[6,6],u.virtualImage),v([{x:0,y:E},C],[6,6],u.virtualImage)}}const H=h($,0),te=i<a?Math.PI:0;re(t,H.x,H.y,14,te),g(t,"Eye",H.x,H.y-26,{color:u.text,background:"rgba(255,255,255,0.08)"});const ae=n==="infinity"?"d_o = f → image at ∞":i<a?"HMD regime: d_o < f → virtual image":"Projector regime: d_o > f → real image";g(t,ae,b.x,b.y+70,{background:i<a?"rgba(233, 69, 96, 0.2)":i>a?"rgba(77,166,255,0.15)":"rgba(255, 255, 255, 0.08)"});const ie=`1/f = 1/d_o + 1/d_i  →  1/${a} = 1/${i} + 1/${T}`;g(t,ie,this.width/2,this.height-16,{color:"rgba(255,255,255,0.6)",background:"rgba(0,0,0,0.5)",font:'11px "Space Grotesk", system-ui, sans-serif'})}}const Q=document.querySelector('[data-panel="thin-lens"]');Q&&new ge(Q);
