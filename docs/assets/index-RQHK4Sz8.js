(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function o(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=o(s);fetch(s.href,n)}})();const ft='12px "Space Grotesk", system-ui, sans-serif';function re(e,t,o,i,s,n={}){const{color:l="#eaeaea",width:r=2,headSize:a=8}=n,d=Math.atan2(s-o,i-t);e.save(),e.strokeStyle=l,e.lineWidth=r,e.beginPath(),e.moveTo(t,o),e.lineTo(i,s),e.stroke(),e.beginPath(),e.moveTo(i,s),e.lineTo(i-a*Math.cos(d-Math.PI/6),s-a*Math.sin(d-Math.PI/6)),e.lineTo(i-a*Math.cos(d+Math.PI/6),s-a*Math.sin(d+Math.PI/6)),e.closePath(),e.fillStyle=l,e.fill(),e.restore()}function ut(e,t,o,i,s={}){const{color:n="#ffd700",width:l=2,focalLength:r,fMin:a=10,fMax:d=200}=s,u=i/2;let g;if(r!==void 0&&r>0){const w=Math.max(0,Math.min(1,(r-a)/(d-a)));g=i*(.25-w*.21)}else g=i*.12;e.save(),e.fillStyle="rgba(255, 215, 0, 0.08)",e.strokeStyle=n,e.lineWidth=l,e.beginPath(),e.moveTo(t,o-u),e.quadraticCurveTo(t+g,o,t,o+u),e.quadraticCurveTo(t-g,o,t,o-u),e.closePath(),e.fill(),e.stroke(),e.restore()}function qe(e,t,o,i,s,n={}){const{color:l="#888888",width:r=1,dash:a=[6,6]}=n;e.save(),e.strokeStyle=l,e.lineWidth=r,e.setLineDash(a),e.beginPath(),e.moveTo(t,o),e.lineTo(i,s),e.stroke(),e.restore()}function mt(e,t,o,i,s=0){const n=i;e.save(),e.translate(t,o),e.rotate(s),e.fillStyle="rgba(240, 240, 245, 0.12)",e.strokeStyle="rgba(234, 234, 234, 0.7)",e.lineWidth=1.8,e.beginPath(),e.moveTo(-n*.95,0),e.quadraticCurveTo(0,-n*.85,n*1.1,0),e.quadraticCurveTo(0,n*.75,-n*.95,0),e.closePath(),e.fill(),e.stroke(),e.fillStyle="rgba(255, 255, 255, 0.15)",e.beginPath(),e.moveTo(-n*.8,0),e.quadraticCurveTo(0,-n*.65,n*.95,0),e.quadraticCurveTo(0,n*.55,-n*.8,0),e.closePath(),e.fill();const l=n*.45,r=n*.38;e.fillStyle="rgba(100, 160, 220, 0.35)",e.strokeStyle="rgba(120, 180, 240, 0.5)",e.lineWidth=1.2,e.beginPath(),e.arc(l,0,r,0,Math.PI*2),e.fill(),e.stroke(),e.fillStyle="#181828",e.beginPath(),e.arc(l,0,r*.52,0,Math.PI*2),e.fill(),e.fillStyle="rgba(255, 255, 255, 0.45)",e.beginPath(),e.arc(l-r*.18,-r*.22,r*.16,0,Math.PI*2),e.fill(),e.strokeStyle="rgba(200, 220, 240, 0.35)",e.lineWidth=1,e.beginPath(),e.arc(n*.7,0,n*.42,-.65,.65),e.stroke(),e.restore()}function yt(e,t,o,i,s){e.save(),e.fillStyle="rgba(179, 157, 219, 0.35)",e.strokeStyle="#b39ddb",e.lineWidth=2,e.fillRect(t,o,i,s),e.strokeRect(t,o,i,s),e.restore()}function pt(e,t,o={}){const{color:i="#4da6ff",width:s=2,dash:n,glow:l}=o;e.save(),e.strokeStyle=i,e.lineWidth=s,n&&e.setLineDash(n),l&&(e.shadowColor=i,e.shadowBlur=8),e.beginPath(),t.forEach((r,a)=>{a===0?e.moveTo(r.x,r.y):e.lineTo(r.x,r.y)}),e.stroke(),e.restore()}function gt(e,t,o,i,s,n){e.save(),e.fillStyle="rgba(77,166,255,0.06)",e.strokeStyle="rgba(77,166,255,0.5)",e.lineWidth=1.5,e.beginPath(),e.moveTo(t+8,o-i/2),e.lineTo(t+n,o-s/2),e.lineTo(t+n,o+s/2),e.lineTo(t+8,o+i/2),e.arcTo(t,o+i/2,t,o+i/2-8,8),e.lineTo(t,o-i/2+8),e.arcTo(t,o-i/2,t+8,o-i/2,8),e.closePath(),e.fill(),e.stroke(),e.restore()}function bt(e,t,o,i,s){const l=i*.12,r=i*.1,a=o+s/2;e.save(),e.fillStyle="rgba(233,69,96,0.05)",e.strokeStyle="rgba(233,69,96,0.4)",e.lineWidth=1.5,e.beginPath(),e.moveTo(t+10,o),e.lineTo(t+i-10,o),e.arcTo(t+i,o,t+i,o+10,10),e.quadraticCurveTo(t+i-r,a,t+i,o+s-10),e.arcTo(t+i,o+s,t+i-10,o+s,10),e.lineTo(t+10,o+s),e.arcTo(t,o+s,t,o+s-10,10),e.quadraticCurveTo(t-l,a,t,o+10),e.arcTo(t,o,t+10,o,10),e.closePath(),e.fill(),e.stroke(),e.restore()}function le(e,t,o,i,s={}){const n=s.intensity??.18,[l,r,a]=s.color??[255,60,60],d=36;e.save();let u;switch(t){case"left":u=e.createLinearGradient(0,0,d,0),u.addColorStop(0,`rgba(${l}, ${r}, ${a}, ${n})`),u.addColorStop(1,`rgba(${l}, ${r}, ${a}, 0.0)`),e.fillStyle=u,e.fillRect(0,0,d,i);break;case"right":u=e.createLinearGradient(o,0,o-d,0),u.addColorStop(0,`rgba(${l}, ${r}, ${a}, ${n})`),u.addColorStop(1,`rgba(${l}, ${r}, ${a}, 0.0)`),e.fillStyle=u,e.fillRect(o-d,0,d,i);break;case"top":u=e.createLinearGradient(0,0,0,d),u.addColorStop(0,`rgba(${l}, ${r}, ${a}, ${n})`),u.addColorStop(1,`rgba(${l}, ${r}, ${a}, 0.0)`),e.fillStyle=u,e.fillRect(0,0,o,d);break;case"bottom":u=e.createLinearGradient(0,i,0,i-d),u.addColorStop(0,`rgba(${l}, ${r}, ${a}, ${n})`),u.addColorStop(1,`rgba(${l}, ${r}, ${a}, 0.0)`),e.fillStyle=u,e.fillRect(0,i-d,o,d);break}e.restore()}function Ne(e,t,o,i,s,n={}){const{color:l="#ff6b6b",yPos:r}=n,a='11px "Space Grotesk", system-ui, sans-serif',d=r??i*.35;e.save(),e.font=a;const g=e.measureText(s).width+12,w=22;if(t==="left")e.fillStyle="rgba(0, 0, 0, 0.6)",e.fillRect(8,d-w/2,g,w),e.fillStyle=l,e.textAlign="left",e.textBaseline="middle",e.fillText(s,14,d);else{const S=o-8;e.fillStyle="rgba(0, 0, 0, 0.6)",e.fillRect(S-g,d-w/2,g,w),e.fillStyle=l,e.textAlign="right",e.textBaseline="middle",e.fillText(s,S-6,d)}e.restore()}function X(e,t,o,i,s={}){const{color:n="#eaeaea",background:l="rgba(0, 0, 0, 0.45)",padding:r=4,font:a=ft}=s;e.save(),e.font=a;const u=e.measureText(t).width+r*2,g=16+r;e.fillStyle=l,e.fillRect(o-u/2,i-g/2,u,g),e.fillStyle=n,e.textAlign="center",e.textBaseline="middle",e.fillText(t,o,i+1),e.restore()}function Be(e,t,o,i,s={}){const{color:n="#eaeaea",background:l="rgba(0, 0, 0, 0.45)",padding:r=4}=s,a='12px "Space Grotesk", system-ui, sans-serif',d='italic 13px "Times New Roman", Georgia, serif',u='italic 10px "Times New Roman", Georgia, serif',g=3;let w=0;const S=[];for(const m of t){if(e.save(),m.type==="math"){e.font=d;let T=e.measureText(m.base).width;m.sub&&(e.font=u,T+=e.measureText(m.sub).width),T+=g*2,S.push({w:T,seg:m}),w+=T}else{e.font=a;const T=e.measureText(m.text).width;S.push({w:T,seg:m}),w+=T}e.restore()}const M=w+r*2+4,P=18+r;e.save(),e.fillStyle=l,e.fillRect(o-M/2,i-P/2,M,P);let c=o-w/2;for(const{w:m,seg:T}of S){if(T.type==="math"){const E=c+g;e.font=d,e.fillStyle=n,e.textAlign="left",e.textBaseline="middle";const $=e.measureText(T.base).width;e.fillText(T.base,E,i),T.sub&&(e.font=u,e.fillText(T.sub,E+$,i+4))}else e.font=a,e.fillStyle=n,e.textAlign="left",e.textBaseline="middle",e.fillText(T.text,c,i+1);c+=m}return e.restore(),{width:M,height:P}}const p={accent:"#e94560",text:"#eaeaea",rayLeft:"#4da6ff",rayGreen:"#4caf50",rayYellow:"#ffc107",virtualImage:"#a855f7",lens:"#ffd700",axis:"#555555"};function vt(e,t){return 1/(1/e-1/t)}function Tt(e,t){return-e/t}function wt(e){return!Number.isFinite(e)||Math.abs(e)>1e6?"infinity":e>0?"real":"virtual"}class St{container;canvas;ctx;controlsEl;readoutsEl;width=0;height=0;resizeObserver;rafId=null;resizeTimer=null;constructor(t){this.container=t;const o=t.querySelector("[data-canvas]"),i=t.querySelector("[data-controls]"),s=t.querySelector("[data-readouts]");if(!o||!i||!s)throw new Error("Panel container missing required elements");this.controlsEl=i,this.readoutsEl=s,this.canvas=document.createElement("canvas"),this.canvas.setAttribute("aria-label","Optics visualization"),o.appendChild(this.canvas);const n=this.canvas.getContext("2d");if(!n)throw new Error("Canvas context unavailable");this.ctx=n,this.resizeObserver=new ResizeObserver(()=>this.scheduleResize()),this.resizeObserver.observe(o),this.resize()}scheduleResize(){this.resizeTimer!==null&&window.clearTimeout(this.resizeTimer),this.resizeTimer=window.setTimeout(()=>{this.resizeTimer=null,this.resize()},120)}resize(){const t=this.canvas.parentElement;if(!t)return;const o=t.getBoundingClientRect(),i=Math.max(0,Math.floor(o.width)),s=Math.max(0,Math.floor(o.height));if(i===this.width&&s===this.height)return;const n=window.devicePixelRatio||1;this.canvas.width=Math.floor(i*n),this.canvas.height=Math.floor(s*n),this.width=i,this.height=s,this.ctx.setTransform(n,0,0,n,0,0),this.requestDraw()}requestDraw(){this.rafId!==null&&cancelAnimationFrame(this.rafId),this.rafId=requestAnimationFrame(()=>{this.rafId=null,this.render()})}addSlider(t){const o=document.createElement("div");o.className="control-row";const i=document.createElement("label");i.htmlFor=t.id,i.textContent=t.label;const s=document.createElement("div");s.className="value";const n=document.createElement("input");n.id=t.id,n.type="range",n.min=String(t.min),n.max=String(t.max),n.step=String(t.step),n.value=String(t.value);const l=r=>{const a=Number(r);s.textContent=`${a}${t.unit??""}`,t.onChange?.(a),this.requestDraw()};return n.addEventListener("input",()=>l(n.value)),l(n.value),o.appendChild(i),o.appendChild(n),o.appendChild(s),this.controlsEl.appendChild(o),n}addReadout(t){const o=document.createElement("div");o.className="readout",o.dataset.readout=t.id;const i=document.createElement("span");i.textContent=t.label;const s=document.createElement("span");return s.textContent=`--${t.unit??""}`,o.appendChild(i),o.appendChild(s),this.readoutsEl.appendChild(o),s}setReadout(t,o){const i=this.readoutsEl.querySelector(`[data-readout="${t}"] span:last-child`);i&&(i.textContent=o)}clear(){this.ctx.clearRect(0,0,this.width,this.height)}render(){this.clear();const{width:t,height:o}=this;this.ctx.fillStyle="#101424",this.ctx.fillRect(0,0,t,o),this.ctx.fillStyle="#eaeaea",this.ctx.font='14px "Space Grotesk", system-ui, sans-serif',this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("Panel rendering...",t/2,o/2)}dispose(){this.resizeObserver.disconnect(),this.resizeTimer!==null&&(window.clearTimeout(this.resizeTimer),this.resizeTimer=null)}}class Mt{placed=[];displacements=[];place(t,o,i,s){const n={x:t-i/2,y:o-s/2};let l=n.x,r=n.y,a=!1;const d=[[0,0],[0,-s-2],[0,s+2],[-i-4,0],[i+4,0],[0,-s*2-4],[0,s*2+4],[-i-4,-s-2],[i+4,-s-2],[-i*2-8,0],[i*2+8,0],[0,-s*3-6],[0,s*3+6]];for(const[w,S]of d){const M=n.x+w,P=n.y+S;let c=!1;for(const m of this.placed)if(M<m.x+m.w&&M+i>m.x&&P<m.y+m.h&&P+s>m.y){c=!0;break}if(!c){l=M,r=P,a=w!==0||S!==0;break}}this.placed.push({x:l,y:r,w:i,h:s});const u=l+i/2,g=r+s/2;return a&&this.displacements.push({origX:t,origY:o,finalX:u,finalY:g}),{x:u,y:g}}drawLeaderLines(t){t.save(),t.strokeStyle="rgba(255, 255, 255, 0.2)",t.lineWidth=1,t.setLineDash([3,3]);for(const o of this.displacements)Math.hypot(o.finalX-o.origX,o.finalY-o.origY)>8&&(t.beginPath(),t.moveTo(o.origX,o.origY),t.lineTo(o.finalX,o.finalY),t.stroke(),t.fillStyle="rgba(255, 255, 255, 0.3)",t.beginPath(),t.arc(o.origX,o.origY,2,0,Math.PI*2),t.fill());t.restore()}}class Rt extends St{fInput;doInput;rayHitZones=[];tooltipEl=null;tooltipTimeout=null;constructor(t){super(t),this.fInput=this.addSlider({id:"thin-lens-f",label:"Focal length f (mm)",min:10,max:200,step:1,value:40,unit:"mm"}),this.doInput=this.addSlider({id:"thin-lens-do",label:"Object distance dₒ (mm)",min:5,max:500,step:1,value:100,unit:"mm"}),this.addReadout({id:"thin-lens-di",label:"Image distance dᵢ",unit:"mm"}),this.addReadout({id:"thin-lens-m",label:"Magnification M",unit:"x"}),this.addReadout({id:"thin-lens-regime",label:"Regime",unit:""}),this.tooltipEl=document.getElementById("ray-tooltip"),this.initTooltipListeners()}initTooltipListeners(){const t=this.canvas;t.addEventListener("pointermove",o=>{this.handlePointerAt(o.clientX,o.clientY)}),t.addEventListener("pointerleave",()=>{this.hideTooltip()}),t.addEventListener("touchstart",o=>{if(o.touches.length>0){const i=o.touches[0];this.handlePointerAt(i.clientX,i.clientY)}},{passive:!0}),t.addEventListener("touchend",()=>{this.tooltipTimeout!==null&&window.clearTimeout(this.tooltipTimeout),this.tooltipTimeout=window.setTimeout(()=>this.hideTooltip(),1200)},{passive:!0})}handlePointerAt(t,o){const i=this.canvas.getBoundingClientRect(),s=t-i.left,n=o-i.top,l=10;let r=-1;for(let a=0;a<this.rayHitZones.length;a++){const d=this.rayHitZones[a];for(const[u,g]of d.segments)if(Pt(s,n,u.x,u.y,g.x,g.y)<l){r=a;break}if(r>=0)break}r>=0?this.showTooltip(r,t,o):this.hideTooltip()}showTooltip(t,o,i){if(!this.tooltipEl)return;const s=this.rayHitZones[t];if(!s)return;this.tooltipTimeout!==null&&(window.clearTimeout(this.tooltipTimeout),this.tooltipTimeout=null),this.tooltipEl.innerHTML=`<div class="tooltip-title"><span class="tooltip-swatch" style="background:${s.color}"></span>${s.title}</div><div>${s.description}</div>`,this.tooltipEl.setAttribute("aria-hidden","false");const n=14;let l=o+n,r=i+n;const a=this.tooltipEl.offsetWidth||200,d=this.tooltipEl.offsetHeight||60;l+a>window.innerWidth-8&&(l=o-a-n),r+d>window.innerHeight-8&&(r=i-d-n),l<4&&(l=4),r<4&&(r=4),this.tooltipEl.style.left=l+"px",this.tooltipEl.style.top=r+"px"}hideTooltip(){this.tooltipEl&&this.tooltipEl.setAttribute("aria-hidden","true")}render(){this.clear();const t=this.ctx;t.fillStyle="#111122",t.fillRect(0,0,this.width,this.height);const o=Number(this.fInput.value),i=Number(this.doInput.value),s=vt(o,i),n=Math.max(3,o*.05),l=Math.abs(i-o)<n,r=l?Number.POSITIVE_INFINITY:s,a=l?"infinity":wt(r),d=Tt(s,i),u=a==="infinity"?"∞":s.toFixed(0),g=Number.isFinite(d)?d.toFixed(2):"--";this.setReadout("thin-lens-di",u),this.setReadout("thin-lens-m",g);const w=a==="infinity"?"At focal point":i<o?"HMD (virtual image)":"Projector (real image)";this.setReadout("thin-lens-regime",w);const S=40,M=50,P=i<o?Math.max(80,o*.6):60,c={x:-i,y:S},m={x:0,y:0},T=S*5;let E=c.y;if(a!=="infinity"){const h=-o-c.x;if(Math.abs(h)>.01){const f=(0-c.y)/h;E=c.y+f*(0-c.x),E=Math.max(-T,Math.min(T,E))}}const $=[];a==="infinity"?($.push(c.y),$.push(0),$.push(c.y)):($.push(c.y),$.push(m.y),$.push(E));const Ze=Math.max(...$.map(Math.abs)),Q=Math.min(Math.max(Ze+12,40),80),me=Q*2,ye=6,Ve=Math.max(-ye,Math.min(ye,d)),pe=S*Ve,_e=-i-40,Je=Math.max(P+40,o+20);let Ue=Math.min(_e,-o-10),Ke=Math.max(Je,o+10);const ge=Math.max(M+20,Q+10,S+20,80);let C=Ue,I=Ke,H=-ge,x=ge;const be=I-C,ve=x-H,Te=.08,we=.12;C-=be*Te,I+=be*Te,H-=ve*we,x+=ve*we;const Se=300,Me=180,Re=I-C,Pe=x-H;if(Re<Se){const h=(Se-Re)/2;C-=h,I+=h}if(Pe<Me){const h=(Me-Pe)/2;H-=h,x+=h}const he=this.width/this.height;if((I-C)/(x-H)>he){const f=((I-C)/he-(x-H))/2;H-=f,x+=f}else{const f=((x-H)*he-(I-C))/2;C-=f,I+=f}const D=C,N=I,ee=H,J=x,te=24,Qe=(this.width-te*2)/(N-D),U=(this.height-te*2)/(J-ee),y=(h,f)=>({x:te+(h-D)*Qe,y:this.height-te-(f-ee)*U}),Y=N,z=(h,f,b)=>{pt(t,h.map(v=>y(v.x,v.y)),{color:b??p.rayLeft,dash:f})},O=new Mt,F=(h,f)=>{t.save(),t.font=f??'12px "Space Grotesk", system-ui, sans-serif';const b=t.measureText(h);return t.restore(),{w:b.width+8,h:20}},Le=y(D,0),ke=y(N,0);qe(t,Le.x,Le.y,ke.x,ke.y,{color:p.axis,dash:[6,6]});const Ee=.04,oe=y(D+(N-D)*.05,J-(J-ee)*Ee),de=y(N-(N-D)*.05,J-(J-ee)*Ee);re(t,oe.x,oe.y,de.x,de.y,{color:"rgba(255,255,255,0.18)",width:1.5,headSize:8}),X(t,"Light direction →",(oe.x+de.x)/2,oe.y-10,{color:"rgba(255,255,255,0.35)",background:"transparent"});const L=y(0,0);if(i>o&&!l){const h=y(-i-20,0),b=y(0,0).x-h.x,v=M*2*U+30,k=me*U+10;gt(t,h.x,L.y,v,k,b)}else if(i<o){const h=-i-15,f=P+20,b=Math.max(M,Q)+10,v=y(h,b),R=y(f,-b);let k=R.x-v.x,W=R.y-v.y;const V=120,q=80;let ne=v.x,ae=v.y;if(k<V){const A=(V-k)/2;ne-=A,k=V}if(W<q){const A=(q-W)/2;ae-=A,W=q}bt(t,ne,ae,k,W)}t.save(),t.strokeStyle="rgba(255, 215, 0, 0.15)",t.lineWidth=1,t.setLineDash([6,6]),t.beginPath(),t.moveTo(L.x,0),t.lineTo(L.x,this.height),t.stroke(),t.restore();const et=me*U,tt=this.height*.8,ot=Math.min(et,tt);ut(t,L.x,L.y,ot,{color:p.lens,focalLength:o,fMin:Number(this.fInput.min),fMax:Number(this.fInput.max)});const B=y(-o,0),j=y(o,0),Z=10,ie='italic 12px "Times New Roman", Georgia, serif';t.save(),t.strokeStyle=p.lens,t.lineWidth=2,t.beginPath(),t.moveTo(B.x,B.y-Z),t.lineTo(B.x,B.y+Z),t.stroke(),t.beginPath(),t.moveTo(j.x,j.y-Z),t.lineTo(j.x,j.y+Z),t.stroke(),t.restore();const Ce=F("f",ie),Ie=O.place(B.x,B.y+Z+12,Ce.w,Ce.h);X(t,"f",Ie.x,Ie.y,{color:p.lens,font:ie,background:"rgba(0,0,0,0.5)"});const He=F("f′",ie),xe=O.place(j.x,j.y+Z+12,He.w,He.h);X(t,"f′",xe.x,xe.y,{color:p.lens,font:ie,background:"rgba(0,0,0,0.5)"});const K=y(-i,M),it=y(-i,-M),We=6;yt(t,K.x-We/2,K.y,We,it.y-K.y);const $e=F("Display"),Ye=O.place(K.x,K.y-16,$e.w,$e.h);X(t,"Display",Ye.x,Ye.y,{background:"rgba(179, 157, 219, 0.25)"});const ze=y(-i,0),Oe=y(-i,S);re(t,ze.x,ze.y,Oe.x,Oe.y,{color:p.accent,width:2.5});const Ae=a==="virtual"&&s<C,Xe=a==="real"&&s>I,ce=Ae||Xe,Fe=pe,st=a!=="infinity"&&!ce&&Fe>x,nt=a!=="infinity"&&!ce&&Fe<H;if(a!=="infinity"){if(!ce){const h=y(s,0),f=y(s,pe);a==="virtual"?(qe(t,h.x,h.y,f.x,f.y,{color:p.virtualImage,dash:[6,6],width:2}),re(t,h.x,h.y,f.x,f.y,{color:p.virtualImage,width:2,headSize:6})):re(t,h.x,h.y,f.x,f.y,{color:p.rayGreen,width:2.5});const b=a==="virtual"?"Virtual Image":"Real Image",v=F(b),R=O.place(f.x,f.y-16,v.w,v.h);X(t,b,R.x,R.y,{background:a==="virtual"?"rgba(168, 85, 247, 0.25)":"rgba(76, 175, 80, 0.2)"})}}else{const h=F("Image at ∞"),f=O.place(L.x+90,L.y-40,h.w,h.h);X(t,"Image at ∞",f.x,f.y,{background:"rgba(255, 255, 255, 0.08)"})}const G=[];if(a==="infinity"){const h=[{x:c.x,y:c.y},{x:m.x,y:c.y},{x:Y,y:c.y}];z(h,void 0,p.rayLeft),G.push({segments:_(h,y),title:"Ray 1: Parallel Ray",description:"Travels parallel to the optical axis from the object tip to the lens, then refracts through the back focal point.",color:p.rayLeft});const f=[{x:c.x,y:c.y},{x:m.x,y:0},{x:Y,y:c.y/i*Y*-1}];z(f,void 0,p.rayYellow),G.push({segments:_(f,y),title:"Ray 2: Central Ray",description:"Passes straight through the center of the lens without bending, since the lens is thin.",color:p.rayYellow});const b=[{x:c.x,y:c.y},{x:0,y:c.y},{x:Y,y:c.y}];z(b,void 0,p.rayGreen),G.push({segments:_(b,y),title:"Ray 3: Focal Ray",description:"Aimed toward the front focal point before the lens; after refraction, exits parallel to the axis.",color:p.rayGreen})}else{const h=-40/o,f={x:Y,y:c.y+h*Y},b=[{x:c.x,y:c.y},{x:0,y:c.y},{x:f.x,y:f.y}];z(b,void 0,p.rayLeft),G.push({segments:_(b,y),title:"Ray 1: Parallel Ray",description:"Travels parallel to the optical axis, then refracts through the back focal point (f′). Used to locate where the image forms.",color:p.rayLeft});const v=(m.y-c.y)/(m.x-c.x),R={x:Y,y:m.y+v*Y},k=[{x:c.x,y:c.y},{x:m.x,y:m.y},{x:R.x,y:R.y}];z(k,void 0,p.rayYellow),G.push({segments:_(k,y),title:"Ray 2: Central Ray",description:"Passes through the lens center undeviated. In a thin lens, the two refractions cancel out so this ray continues in a straight line.",color:p.rayYellow});const W={x:Y,y:E},V=[{x:c.x,y:c.y},{x:0,y:E},{x:W.x,y:W.y}];if(z(V,void 0,p.rayGreen),G.push({segments:_(V,y),title:"Ray 3: Focal Ray",description:"Passes through (or aims toward) the front focal point (f), then exits the lens parallel to the optical axis.",color:p.rayGreen}),a==="virtual"){const q="rgba(168, 85, 247, 0.35)",ne=-40/o,ae=(m.y-c.y)/(m.x-c.x),A=D,dt=c.y+ne*A;z([{x:0,y:c.y},{x:A,y:dt}],[6,6],q);const ct=m.y+ae*A;z([{x:0,y:m.y},{x:A,y:ct}],[6,6],q),z([{x:0,y:E},{x:A,y:E}],[6,6],q)}}this.rayHitZones=G;const se=y(P,0),at=i<o?Math.PI:0;mt(t,se.x,se.y,22,at);const De=F("Eye"),Ge=O.place(se.x,se.y-26,De.w,De.h);if(X(t,"Eye",Ge.x,Ge.y,{color:p.text,background:"rgba(255,255,255,0.08)"}),i>o&&!l){const h=y(-i-20,0),b=y(0,0).x-h.x,v=F("PROJECTOR"),R=O.place(h.x+b/2,L.y-M*U-28,v.w,v.h);X(t,"PROJECTOR",R.x,R.y,{color:"#4da6ff",background:"rgba(77,166,255,0.18)"})}else if(i<o){const h=-i-15,f=P+20,b=Math.max(M,Q)+10,v=y(h,b),R=y(f,-b),k=F("HMD"),W=O.place((v.x+R.x)/2,v.y-12,k.w,k.h);X(t,"HMD",W.x,W.y,{color:"#e94560",background:"rgba(233,69,96,0.18)"})}const rt=a==="infinity"?[{type:"math",base:"d",sub:"o"},{type:"text",text:" = ",base:""},{type:"math",base:"f"},{type:"text",text:"  →  image at ∞",base:""}]:i<o?[{type:"text",text:"HMD:  ",base:""},{type:"math",base:"d",sub:"o"},{type:"text",text:" < ",base:""},{type:"math",base:"f"},{type:"text",text:"  →  virtual image",base:""}]:[{type:"text",text:"Projector:  ",base:""},{type:"math",base:"d",sub:"o"},{type:"text",text:" > ",base:""},{type:"math",base:"f"},{type:"text",text:"  →  real image",base:""}],lt=i<o?"rgba(233, 69, 96, 0.2)":i>o?"rgba(77,166,255,0.15)":"rgba(255, 255, 255, 0.08)";Be(t,rt,L.x,L.y+70,{background:lt});const fe=[168,85,247],ue=[76,175,80];if(a!=="infinity"){if(Ae){le(t,"left",this.width,this.height,{color:fe});const h=Math.abs(s).toFixed(0);Ne(t,"left",this.width,this.height,"← Virtual Image "+h+"mm",{color:p.virtualImage,yPos:L.y-20})}if(Xe){le(t,"right",this.width,this.height,{color:ue});const h=s.toFixed(0);Ne(t,"right",this.width,this.height,"Real Image "+h+"mm →",{color:p.rayGreen,yPos:L.y-20})}if(st){const h=i<o?fe:ue;le(t,"top",this.width,this.height,{color:h})}if(nt){const h=i<o?fe:ue;le(t,"bottom",this.width,this.height,{color:h})}}O.drawLeaderLines(t);const ht=[{type:"text",text:"1/",base:""},{type:"math",base:"f"},{type:"text",text:" = 1/",base:""},{type:"math",base:"d",sub:"o"},{type:"text",text:" + 1/",base:""},{type:"math",base:"d",sub:"i"},{type:"text",text:`   →   1/${o} = 1/${i} + 1/${u}`,base:""}];Be(t,ht,this.width/2,this.height-16,{color:"rgba(255,255,255,0.6)",background:"rgba(0,0,0,0.5)"})}}function _(e,t){const o=[];for(let i=0;i<e.length-1;i++)o.push([t(e[i].x,e[i].y),t(e[i+1].x,e[i+1].y)]);return o}function Pt(e,t,o,i,s,n){const l=s-o,r=n-i,a=l*l+r*r;if(a===0)return Math.hypot(e-o,t-i);let d=((e-o)*l+(t-i)*r)/a;return d=Math.max(0,Math.min(1,d)),Math.hypot(e-(o+d*l),t-(i+d*r))}const je=document.querySelector('[data-panel="thin-lens"]');je&&new Rt(je);
