(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&s(d)}).observe(document,{childList:!0,subtree:!0});function a(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(n){if(n.ep)return;n.ep=!0;const o=a(n);fetch(n.href,o)}})();const Ye='12px "Space Grotesk", system-ui, sans-serif';function ee(e,t,a,s,n,o={}){const{color:d="#eaeaea",width:r=2,headSize:h=8}=o,v=Math.atan2(n-a,s-t);e.save(),e.strokeStyle=d,e.lineWidth=r,e.beginPath(),e.moveTo(t,a),e.lineTo(s,n),e.stroke(),e.beginPath(),e.moveTo(s,n),e.lineTo(s-h*Math.cos(v-Math.PI/6),n-h*Math.sin(v-Math.PI/6)),e.lineTo(s-h*Math.cos(v+Math.PI/6),n-h*Math.sin(v+Math.PI/6)),e.closePath(),e.fillStyle=d,e.fill(),e.restore()}function Ge(e,t,a,s,n={}){const{color:o="#ffd700",width:d=2,focalLength:r,fMin:h=10,fMax:v=200}=n,w=s/2;let b;if(r!==void 0&&r>0){const S=Math.max(0,Math.min(1,(r-h)/(v-h)));b=s*(.25-S*.21)}else b=s*.12;e.save(),e.fillStyle="rgba(255, 215, 0, 0.08)",e.strokeStyle=o,e.lineWidth=d,e.beginPath(),e.moveTo(t,a-w),e.quadraticCurveTo(t+b,a,t,a+w),e.quadraticCurveTo(t-b,a,t,a-w),e.closePath(),e.fill(),e.stroke(),e.restore()}function He(e,t,a,s,n,o={}){const{color:d="#888888",width:r=1,dash:h=[6,6]}=o;e.save(),e.strokeStyle=d,e.lineWidth=r,e.setLineDash(h),e.beginPath(),e.moveTo(t,a),e.lineTo(s,n),e.stroke(),e.restore()}function je(e,t,a,s,n=0){const o=s;e.save(),e.translate(t,a),e.rotate(n),e.strokeStyle="#eaeaea",e.lineWidth=1.5,e.fillStyle="rgba(234,234,234,0.05)",e.beginPath(),e.arc(0,0,o,0,Math.PI*2),e.fill(),e.stroke(),e.fillStyle="rgba(234,234,234,0.12)",e.beginPath(),e.moveTo(o*.7,-o*.55),e.quadraticCurveTo(o*1.45,0,o*.7,o*.55),e.arc(0,0,o,Math.asin(.55),-Math.asin(.55),!0),e.closePath(),e.fill(),e.stroke(),e.fillStyle="#eaeaea",e.beginPath(),e.arc(o*.75,0,o*.18,0,Math.PI*2),e.fill(),e.restore()}function Be(e,t,a,s,n){e.save(),e.fillStyle="rgba(179, 157, 219, 0.35)",e.strokeStyle="#b39ddb",e.lineWidth=2,e.fillRect(t,a,s,n),e.strokeRect(t,a,s,n),e.restore()}function _e(e,t,a={}){const{color:s="#4da6ff",width:n=2,dash:o,glow:d}=a;e.save(),e.strokeStyle=s,e.lineWidth=n,o&&e.setLineDash(o),d&&(e.shadowColor=s,e.shadowBlur=8),e.beginPath(),t.forEach((r,h)=>{h===0?e.moveTo(r.x,r.y):e.lineTo(r.x,r.y)}),e.stroke(),e.restore()}function $e(e,t,a,s,n,o){e.save(),e.fillStyle="rgba(77,166,255,0.06)",e.strokeStyle="rgba(77,166,255,0.5)",e.lineWidth=1.5,e.beginPath(),e.moveTo(t+8,a-s/2),e.lineTo(t+o,a-n/2),e.lineTo(t+o,a+n/2),e.lineTo(t+8,a+s/2),e.arcTo(t,a+s/2,t,a+s/2-8,8),e.lineTo(t,a-s/2+8),e.arcTo(t,a-s/2,t+8,a-s/2,8),e.closePath(),e.fill(),e.stroke(),e.restore()}function Ve(e,t,a,s,n){const d=s*.12,r=s*.1,h=a+n/2;e.save(),e.fillStyle="rgba(233,69,96,0.05)",e.strokeStyle="rgba(233,69,96,0.4)",e.lineWidth=1.5,e.beginPath(),e.moveTo(t+10,a),e.lineTo(t+s-10,a),e.arcTo(t+s,a,t+s,a+10,10),e.quadraticCurveTo(t+s-r,h,t+s,a+n-10),e.arcTo(t+s,a+n,t+s-10,a+n,10),e.lineTo(t+10,a+n),e.arcTo(t,a+n,t,a+n-10,10),e.quadraticCurveTo(t-d,h,t,a+10),e.arcTo(t,a,t+10,a,10),e.closePath(),e.fill(),e.stroke(),e.restore()}function M(e,t,a,s,n={}){const{color:o="#eaeaea",background:d="rgba(0, 0, 0, 0.45)",padding:r=4,font:h=Ye}=n;e.save(),e.font=h;const w=e.measureText(t).width+r*2,b=16+r;e.fillStyle=d,e.fillRect(a-w/2,s-b/2,w,b),e.fillStyle=o,e.textAlign="center",e.textBaseline="middle",e.fillText(t,a,s+1),e.restore()}const y={accent:"#e94560",text:"#eaeaea",rayLeft:"#4da6ff",rayGreen:"#4caf50",rayYellow:"#ffc107",virtualImage:"#a855f7",lens:"#ffd700",axis:"#555555"};function Je(e,t){return 1/(1/e-1/t)}function Ke(e,t){return-e/t}function Ue(e){return!Number.isFinite(e)||Math.abs(e)>1e6?"infinity":e>0?"real":"virtual"}class Qe{container;canvas;ctx;controlsEl;readoutsEl;width=0;height=0;resizeObserver;rafId=null;resizeTimer=null;constructor(t){this.container=t;const a=t.querySelector("[data-canvas]"),s=t.querySelector("[data-controls]"),n=t.querySelector("[data-readouts]");if(!a||!s||!n)throw new Error("Panel container missing required elements");this.controlsEl=s,this.readoutsEl=n,this.canvas=document.createElement("canvas"),this.canvas.setAttribute("aria-label","Optics visualization"),a.appendChild(this.canvas);const o=this.canvas.getContext("2d");if(!o)throw new Error("Canvas context unavailable");this.ctx=o,this.resizeObserver=new ResizeObserver(()=>this.scheduleResize()),this.resizeObserver.observe(a),this.resize()}scheduleResize(){this.resizeTimer!==null&&window.clearTimeout(this.resizeTimer),this.resizeTimer=window.setTimeout(()=>{this.resizeTimer=null,this.resize()},120)}resize(){const t=this.canvas.parentElement;if(!t)return;const a=t.getBoundingClientRect(),s=Math.max(0,Math.floor(a.width)),n=Math.max(0,Math.floor(a.height));if(s===this.width&&n===this.height)return;const o=window.devicePixelRatio||1;this.canvas.width=Math.floor(s*o),this.canvas.height=Math.floor(n*o),this.width=s,this.height=n,this.ctx.setTransform(o,0,0,o,0,0),this.requestDraw()}requestDraw(){this.rafId!==null&&cancelAnimationFrame(this.rafId),this.rafId=requestAnimationFrame(()=>{this.rafId=null,this.render()})}addSlider(t){const a=document.createElement("div");a.className="control-row";const s=document.createElement("label");s.htmlFor=t.id,s.textContent=t.label;const n=document.createElement("div");n.className="value";const o=document.createElement("input");o.id=t.id,o.type="range",o.min=String(t.min),o.max=String(t.max),o.step=String(t.step),o.value=String(t.value);const d=r=>{const h=Number(r);n.textContent=`${h}${t.unit??""}`,t.onChange?.(h),this.requestDraw()};return o.addEventListener("input",()=>d(o.value)),d(o.value),a.appendChild(s),a.appendChild(o),a.appendChild(n),this.controlsEl.appendChild(a),o}addReadout(t){const a=document.createElement("div");a.className="readout",a.dataset.readout=t.id;const s=document.createElement("span");s.textContent=t.label;const n=document.createElement("span");return n.textContent=`--${t.unit??""}`,a.appendChild(s),a.appendChild(n),this.readoutsEl.appendChild(a),n}setReadout(t,a){const s=this.readoutsEl.querySelector(`[data-readout="${t}"] span:last-child`);s&&(s.textContent=a)}clear(){this.ctx.clearRect(0,0,this.width,this.height)}render(){this.clear();const{width:t,height:a}=this;this.ctx.fillStyle="#101424",this.ctx.fillRect(0,0,t,a),this.ctx.fillStyle="#eaeaea",this.ctx.font='14px "Space Grotesk", system-ui, sans-serif',this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("Panel rendering...",t/2,a/2)}dispose(){this.resizeObserver.disconnect(),this.resizeTimer!==null&&(window.clearTimeout(this.resizeTimer),this.resizeTimer=null)}}class Ze{placed=[];place(t,a,s,n){const o={x:t-s/2,y:a-n/2};let d=o.x,r=o.y;const h=[[0,0],[0,-n-2],[0,n+2],[-s-4,0],[s+4,0],[0,-n*2-4],[0,n*2+4],[-s-4,-n-2],[s+4,-n-2]];for(const[v,w]of h){const b=o.x+v,S=o.y+w;let P=!1;for(const T of this.placed)if(b<T.x+T.w&&b+s>T.x&&S<T.y+T.h&&S+n>T.y){P=!0;break}if(!P){d=b,r=S;break}}return this.placed.push({x:d,y:r,w:s,h:n}),{x:d+s/2,y:r+n/2}}}class et extends Qe{fInput;doInput;constructor(t){super(t),this.fInput=this.addSlider({id:"thin-lens-f",label:"Focal Length (mm)",min:10,max:200,step:1,value:40,unit:"mm"}),this.doInput=this.addSlider({id:"thin-lens-do",label:"Lens-to-Display Distance (mm)",min:5,max:500,step:1,value:100,unit:"mm"}),this.addReadout({id:"thin-lens-di",label:"Image Distance",unit:"mm"}),this.addReadout({id:"thin-lens-m",label:"Magnification",unit:"x"}),this.addReadout({id:"thin-lens-regime",label:"Regime",unit:""})}render(){this.clear();const t=this.ctx;t.fillStyle="#111122",t.fillRect(0,0,this.width,this.height);const a=Number(this.fInput.value),s=Number(this.doInput.value),n=Je(a,s),o=Math.abs(s-a)<3,d=o?Number.POSITIVE_INFINITY:n,r=o?"infinity":Ue(d),h=Ke(n,s),v=r==="infinity"?"∞":n.toFixed(0),w=Number.isFinite(h)?h.toFixed(2):"--";this.setReadout("thin-lens-di",v),this.setReadout("thin-lens-m",w);const b=r==="infinity"?"At focal point":s<a?"HMD (virtual image)":"Projector (real image)";this.setReadout("thin-lens-regime",b);const S=40,P=50,T=s<a?Math.max(80,a*.8):60,l={x:-s,y:S},R={x:0,y:0},X=[];if(r==="infinity")X.push(l.y),X.push(0),X.push(l.y);else{X.push(l.y),X.push(R.y);const i=(0-l.y)/(-a-l.x),c=l.y+i*(0-l.x);X.push(c)}const We=Math.max(...X.map(Math.abs)),ne=Math.min(Math.max(We+12,40),120),oe=ne*2,ze=-s-30;let j=T+30,B=ze;if(r!=="infinity"){const i=n,c=Math.max(s*5,400);i>0&&i<c&&(j=Math.max(j,i+30)),i<0&&i>-c&&(B=Math.min(B,i-30))}B=Math.min(B,-a-10),j=Math.max(j,a+10);const ie=Math.max(P+20,ne+10,80);let L=B,k=j,I=-ie,E=ie;const re=k-L,le=E-I,ce=.08,de=.12;L-=re*ce,k+=re*ce,I-=le*de,E+=le*de;const he=300,ue=180,me=k-L,fe=E-I;if(me<he){const i=(he-me)/2;L-=i,k+=i}if(fe<ue){const i=(ue-fe)/2;I-=i,E+=i}const te=this.width/this.height;if((k-L)/(E-I)>te){const c=((k-L)/te-(E-I))/2;I-=c,E+=c}else{const c=((E-I)*te-(k-L))/2;L-=c,k+=c}const q=L,N=k,J=I,_=E,K=24,De=(this.width-K*2)/(N-q),$=(this.height-K*2)/(_-J),u=(i,c)=>({x:K+(i-q)*De,y:this.height-K-(c-J)*$}),H=N,C=(i,c,m)=>{_e(t,i.map(f=>u(f.x,f.y)),{color:m??y.rayLeft,dash:c})},W=new Ze,z=(i,c)=>{t.save(),t.font=c??'12px "Space Grotesk", system-ui, sans-serif';const m=t.measureText(i);return t.restore(),{w:m.width+8,h:20}},ye=u(q,0),ge=u(N,0);He(t,ye.x,ye.y,ge.x,ge.y,{color:y.axis,dash:[6,6]});const U=u(q+(N-q)*.05,_-(_-J)*.08),ae=u(N-(N-q)*.05,_-(_-J)*.08);ee(t,U.x,U.y,ae.x,ae.y,{color:"rgba(255,255,255,0.18)",width:1.5,headSize:8}),M(t,"light direction →",(U.x+ae.x)/2,U.y-10,{color:"rgba(255,255,255,0.35)",background:"transparent"});const x=u(0,0);if(s>a&&!o){const i=u(-s-20,0),m=u(0,0).x-i.x,f=P*2*$+30,g=oe*$+10;$e(t,i.x,x.y,f,g,m)}else if(s<a){const i=u(-s-20,P+20),c=u(T+30,-70);let m=c.x-i.x,f=c.y-i.y;const p=120,g=80;let D=i.x,A=i.y;if(m<p){const O=(p-m)/2;D-=O,m=p}if(f<g){const O=(g-f)/2;A-=O,f=g}Ve(t,D,A,m,f)}t.save(),t.strokeStyle="rgba(255, 215, 0, 0.15)",t.lineWidth=1,t.setLineDash([6,6]),t.beginPath(),t.moveTo(x.x,0),t.lineTo(x.x,this.height),t.stroke(),t.restore();const Oe=oe*$,Xe=this.height*.8,qe=Math.min(Oe,Xe);Ge(t,x.x,x.y,qe,{color:y.lens,focalLength:a,fMin:Number(this.fInput.min),fMax:Number(this.fInput.max)});const F=u(-a,0),Y=u(a,0),G=10,Q='italic 11px "Space Grotesk", system-ui, sans-serif';t.save(),t.strokeStyle=y.lens,t.lineWidth=2,t.beginPath(),t.moveTo(F.x,F.y-G),t.lineTo(F.x,F.y+G),t.stroke(),t.beginPath(),t.moveTo(Y.x,Y.y-G),t.lineTo(Y.x,Y.y+G),t.stroke(),t.restore();const pe=z("f",Q),be=W.place(F.x,F.y+G+12,pe.w,pe.h);M(t,"f",be.x,be.y,{color:y.lens,font:Q,background:"rgba(0,0,0,0.5)"});const ve=z("f′",Q),Te=W.place(Y.x,Y.y+G+12,ve.w,ve.h);M(t,"f′",Te.x,Te.y,{color:y.lens,font:Q,background:"rgba(0,0,0,0.5)"});const V=u(-s,P),Ne=u(-s,-P),Me=6;Be(t,V.x-Me/2,V.y,Me,Ne.y-V.y);const we=z("Display"),Se=W.place(V.x,V.y-16,we.w,we.h);M(t,"Display",Se.x,Se.y,{background:"rgba(179, 157, 219, 0.25)"});const Pe=u(-s,0),xe=u(-s,S);if(ee(t,Pe.x,Pe.y,xe.x,xe.y,{color:y.accent,width:2.5}),r!=="infinity"){const i=S*h,m=Math.max(q,Math.min(N,n)),f=Math.max(-300,Math.min(300,i)),p=u(m,0),g=u(m,f);r==="virtual"?(He(t,p.x,p.y,g.x,g.y,{color:y.virtualImage,dash:[6,6],width:2}),ee(t,p.x,p.y,g.x,g.y,{color:y.virtualImage,width:2,headSize:6})):ee(t,p.x,p.y,g.x,g.y,{color:y.rayGreen,width:2.5});const D=r==="virtual"?"Virtual Image":"Real Image",A=z(D),O=W.place(g.x,g.y-16,A.w,A.h);M(t,D,O.x,O.y,{background:r==="virtual"?"rgba(168, 85, 247, 0.25)":"rgba(76, 175, 80, 0.2)"})}else M(t,"Image at ∞",x.x+90,x.y-40,{background:"rgba(255, 255, 255, 0.08)"});if(r==="infinity")C([{x:l.x,y:l.y},{x:R.x,y:l.y},{x:H,y:l.y}],void 0,y.rayLeft),C([{x:l.x,y:l.y},{x:R.x,y:0},{x:H,y:l.y/s*H*-1}],void 0,y.rayYellow),C([{x:l.x,y:l.y},{x:0,y:l.y},{x:H,y:l.y}],void 0,y.rayGreen);else{const i=-40/a,c={x:H,y:l.y+i*H};C([{x:l.x,y:l.y},{x:0,y:l.y},{x:c.x,y:c.y}],void 0,y.rayLeft);const m=(R.y-l.y)/(R.x-l.x),f={x:H,y:R.y+m*H};C([{x:l.x,y:l.y},{x:R.x,y:R.y},{x:f.x,y:f.y}],void 0,y.rayYellow);const p=(0-l.y)/(-a-l.x),g=l.y+p*(0-l.x),D={x:H,y:g};if(C([{x:l.x,y:l.y},{x:0,y:g},{x:D.x,y:D.y}],void 0,y.rayGreen),r==="virtual"){const A=Math.max(-2e3,Math.min(2e3,n)),O=Math.max(-20,Math.min(20,h)),se={x:A,y:S*O};C([{x:0,y:l.y},se],[6,6],y.virtualImage),C([{x:0,y:R.y},se],[6,6],y.virtualImage),C([{x:0,y:g},se],[6,6],y.virtualImage)}}const Z=u(T,0),Ae=s<a?Math.PI:0;je(t,Z.x,Z.y,14,Ae);const Re=z("Eye"),Le=W.place(Z.x,Z.y-26,Re.w,Re.h);if(M(t,"Eye",Le.x,Le.y,{color:y.text,background:"rgba(255,255,255,0.08)"}),s>a&&!o){const i=u(-s-20,0),m=u(0,0).x-i.x,f=z("PROJECTOR"),p=W.place(i.x+m/2,x.y-P*$-28,f.w,f.h);M(t,"PROJECTOR",p.x,p.y,{color:"#4da6ff",background:"rgba(77,166,255,0.18)"})}else if(s<a){const i=u(-s-20,P+20),c=u(T+30,-70),m=z("HMD"),f=W.place((i.x+c.x)/2,i.y-12,m.w,m.h);M(t,"HMD",f.x,f.y,{color:"#e94560",background:"rgba(233,69,96,0.18)"})}const ke=r==="infinity"?"d_o = f → image at ∞":s<a?"HMD regime: d_o < f → virtual image":"Projector regime: d_o > f → real image",Ie=z(ke),Ee=W.place(x.x,x.y+70,Ie.w,Ie.h);M(t,ke,Ee.x,Ee.y,{background:s<a?"rgba(233, 69, 96, 0.2)":s>a?"rgba(77,166,255,0.15)":"rgba(255, 255, 255, 0.08)"});const Fe=`1/f = 1/d_o + 1/d_i  →  1/${a} = 1/${s} + 1/${v}`;M(t,Fe,this.width/2,this.height-16,{color:"rgba(255,255,255,0.6)",background:"rgba(0,0,0,0.5)",font:'11px "Space Grotesk", system-ui, sans-serif'})}}const Ce=document.querySelector('[data-panel="thin-lens"]');Ce&&new et(Ce);
