(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function s(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(o){if(o.ep)return;o.ep=!0;const a=s(o);fetch(o.href,a)}})();const at='12px "Space Grotesk", system-ui, sans-serif';function se(e,t,s,i,o,a={}){const{color:r="#eaeaea",width:n=2,headSize:l=8}=a,y=Math.atan2(o-s,i-t);e.save(),e.strokeStyle=r,e.lineWidth=n,e.beginPath(),e.moveTo(t,s),e.lineTo(i,o),e.stroke(),e.beginPath(),e.moveTo(i,o),e.lineTo(i-l*Math.cos(y-Math.PI/6),o-l*Math.sin(y-Math.PI/6)),e.lineTo(i-l*Math.cos(y+Math.PI/6),o-l*Math.sin(y+Math.PI/6)),e.closePath(),e.fillStyle=r,e.fill(),e.restore()}function nt(e,t,s,i,o={}){const{color:a="#ffd700",width:r=2,focalLength:n,fMin:l=10,fMax:y=200}=o,S=i/2;let p;if(n!==void 0&&n>0){const T=Math.max(0,Math.min(1,(n-l)/(y-l)));p=i*(.25-T*.21)}else p=i*.12;e.save(),e.fillStyle="rgba(255, 215, 0, 0.08)",e.strokeStyle=a,e.lineWidth=r,e.beginPath(),e.moveTo(t,s-S),e.quadraticCurveTo(t+p,s,t,s+S),e.quadraticCurveTo(t-p,s,t,s-S),e.closePath(),e.fill(),e.stroke(),e.restore()}function Ne(e,t,s,i,o,a={}){const{color:r="#888888",width:n=1,dash:l=[6,6]}=a;e.save(),e.strokeStyle=r,e.lineWidth=n,e.setLineDash(l),e.beginPath(),e.moveTo(t,s),e.lineTo(i,o),e.stroke(),e.restore()}function rt(e,t,s,i,o=0){const a=i;e.save(),e.translate(t,s),e.rotate(o),e.strokeStyle="#eaeaea",e.lineWidth=1.5,e.fillStyle="rgba(234,234,234,0.05)",e.beginPath(),e.arc(0,0,a,0,Math.PI*2),e.fill(),e.stroke(),e.fillStyle="rgba(234,234,234,0.12)",e.beginPath(),e.moveTo(a*.7,-a*.55),e.quadraticCurveTo(a*1.45,0,a*.7,a*.55),e.arc(0,0,a,Math.asin(.55),-Math.asin(.55),!0),e.closePath(),e.fill(),e.stroke(),e.fillStyle="#eaeaea",e.beginPath(),e.arc(a*.75,0,a*.18,0,Math.PI*2),e.fill(),e.restore()}function lt(e,t,s,i,o){e.save(),e.fillStyle="rgba(179, 157, 219, 0.35)",e.strokeStyle="#b39ddb",e.lineWidth=2,e.fillRect(t,s,i,o),e.strokeRect(t,s,i,o),e.restore()}function dt(e,t,s={}){const{color:i="#4da6ff",width:o=2,dash:a,glow:r}=s;e.save(),e.strokeStyle=i,e.lineWidth=o,a&&e.setLineDash(a),r&&(e.shadowColor=i,e.shadowBlur=8),e.beginPath(),t.forEach((n,l)=>{l===0?e.moveTo(n.x,n.y):e.lineTo(n.x,n.y)}),e.stroke(),e.restore()}function ct(e,t,s,i,o,a){e.save(),e.fillStyle="rgba(77,166,255,0.06)",e.strokeStyle="rgba(77,166,255,0.5)",e.lineWidth=1.5,e.beginPath(),e.moveTo(t+8,s-i/2),e.lineTo(t+a,s-o/2),e.lineTo(t+a,s+o/2),e.lineTo(t+8,s+i/2),e.arcTo(t,s+i/2,t,s+i/2-8,8),e.lineTo(t,s-i/2+8),e.arcTo(t,s-i/2,t+8,s-i/2,8),e.closePath(),e.fill(),e.stroke(),e.restore()}function ht(e,t,s,i,o){const r=i*.12,n=i*.1,l=s+o/2;e.save(),e.fillStyle="rgba(233,69,96,0.05)",e.strokeStyle="rgba(233,69,96,0.4)",e.lineWidth=1.5,e.beginPath(),e.moveTo(t+10,s),e.lineTo(t+i-10,s),e.arcTo(t+i,s,t+i,s+10,10),e.quadraticCurveTo(t+i-n,l,t+i,s+o-10),e.arcTo(t+i,s+o,t+i-10,s+o,10),e.lineTo(t+10,s+o),e.arcTo(t,s+o,t,s+o-10,10),e.quadraticCurveTo(t-r,l,t,s+10),e.arcTo(t,s,t+10,s,10),e.closePath(),e.fill(),e.stroke(),e.restore()}function ie(e,t,s,i,o={}){const a=o.intensity??.4,r=36;e.save();let n;switch(t){case"left":n=e.createLinearGradient(0,0,r,0),n.addColorStop(0,`rgba(255, 60, 60, ${a})`),n.addColorStop(1,"rgba(255, 60, 60, 0.0)"),e.fillStyle=n,e.fillRect(0,0,r,i);break;case"right":n=e.createLinearGradient(s,0,s-r,0),n.addColorStop(0,`rgba(255, 60, 60, ${a})`),n.addColorStop(1,"rgba(255, 60, 60, 0.0)"),e.fillStyle=n,e.fillRect(s-r,0,r,i);break;case"top":n=e.createLinearGradient(0,0,0,r),n.addColorStop(0,`rgba(255, 60, 60, ${a})`),n.addColorStop(1,"rgba(255, 60, 60, 0.0)"),e.fillStyle=n,e.fillRect(0,0,s,r);break;case"bottom":n=e.createLinearGradient(0,i,0,i-r),n.addColorStop(0,`rgba(255, 60, 60, ${a})`),n.addColorStop(1,"rgba(255, 60, 60, 0.0)"),e.fillStyle=n,e.fillRect(0,i-r,s,r);break}e.restore()}function Ge(e,t,s,i,o,a={}){const{color:r="#ff6b6b",yPos:n}=a,l='11px "Space Grotesk", system-ui, sans-serif',y=n??i*.35;e.save(),e.font=l;const p=e.measureText(o).width+12,T=22;if(t==="left")e.fillStyle="rgba(0, 0, 0, 0.6)",e.fillRect(8,y-T/2,p,T),e.fillStyle=r,e.textAlign="left",e.textBaseline="middle",e.fillText(o,14,y);else{const w=s-8;e.fillStyle="rgba(0, 0, 0, 0.6)",e.fillRect(w-p,y-T/2,p,T),e.fillStyle=r,e.textAlign="right",e.textBaseline="middle",e.fillText(o,w-6,y)}e.restore()}function P(e,t,s,i,o={}){const{color:a="#eaeaea",background:r="rgba(0, 0, 0, 0.45)",padding:n=4,font:l=at}=o;e.save(),e.font=l;const S=e.measureText(t).width+n*2,p=16+n;e.fillStyle=r,e.fillRect(s-S/2,i-p/2,S,p),e.fillStyle=a,e.textAlign="center",e.textBaseline="middle",e.fillText(t,s,i+1),e.restore()}const m={accent:"#e94560",text:"#eaeaea",rayLeft:"#4da6ff",rayGreen:"#4caf50",rayYellow:"#ffc107",virtualImage:"#a855f7",lens:"#ffd700",axis:"#555555"};function ft(e,t){return 1/(1/e-1/t)}function mt(e,t){return-e/t}function ut(e){return!Number.isFinite(e)||Math.abs(e)>1e6?"infinity":e>0?"real":"virtual"}class yt{container;canvas;ctx;controlsEl;readoutsEl;width=0;height=0;resizeObserver;rafId=null;resizeTimer=null;constructor(t){this.container=t;const s=t.querySelector("[data-canvas]"),i=t.querySelector("[data-controls]"),o=t.querySelector("[data-readouts]");if(!s||!i||!o)throw new Error("Panel container missing required elements");this.controlsEl=i,this.readoutsEl=o,this.canvas=document.createElement("canvas"),this.canvas.setAttribute("aria-label","Optics visualization"),s.appendChild(this.canvas);const a=this.canvas.getContext("2d");if(!a)throw new Error("Canvas context unavailable");this.ctx=a,this.resizeObserver=new ResizeObserver(()=>this.scheduleResize()),this.resizeObserver.observe(s),this.resize()}scheduleResize(){this.resizeTimer!==null&&window.clearTimeout(this.resizeTimer),this.resizeTimer=window.setTimeout(()=>{this.resizeTimer=null,this.resize()},120)}resize(){const t=this.canvas.parentElement;if(!t)return;const s=t.getBoundingClientRect(),i=Math.max(0,Math.floor(s.width)),o=Math.max(0,Math.floor(s.height));if(i===this.width&&o===this.height)return;const a=window.devicePixelRatio||1;this.canvas.width=Math.floor(i*a),this.canvas.height=Math.floor(o*a),this.width=i,this.height=o,this.ctx.setTransform(a,0,0,a,0,0),this.requestDraw()}requestDraw(){this.rafId!==null&&cancelAnimationFrame(this.rafId),this.rafId=requestAnimationFrame(()=>{this.rafId=null,this.render()})}addSlider(t){const s=document.createElement("div");s.className="control-row";const i=document.createElement("label");i.htmlFor=t.id,i.textContent=t.label;const o=document.createElement("div");o.className="value";const a=document.createElement("input");a.id=t.id,a.type="range",a.min=String(t.min),a.max=String(t.max),a.step=String(t.step),a.value=String(t.value);const r=n=>{const l=Number(n);o.textContent=`${l}${t.unit??""}`,t.onChange?.(l),this.requestDraw()};return a.addEventListener("input",()=>r(a.value)),r(a.value),s.appendChild(i),s.appendChild(a),s.appendChild(o),this.controlsEl.appendChild(s),a}addReadout(t){const s=document.createElement("div");s.className="readout",s.dataset.readout=t.id;const i=document.createElement("span");i.textContent=t.label;const o=document.createElement("span");return o.textContent=`--${t.unit??""}`,s.appendChild(i),s.appendChild(o),this.readoutsEl.appendChild(s),o}setReadout(t,s){const i=this.readoutsEl.querySelector(`[data-readout="${t}"] span:last-child`);i&&(i.textContent=s)}clear(){this.ctx.clearRect(0,0,this.width,this.height)}render(){this.clear();const{width:t,height:s}=this;this.ctx.fillStyle="#101424",this.ctx.fillRect(0,0,t,s),this.ctx.fillStyle="#eaeaea",this.ctx.font='14px "Space Grotesk", system-ui, sans-serif',this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("Panel rendering...",t/2,s/2)}dispose(){this.resizeObserver.disconnect(),this.resizeTimer!==null&&(window.clearTimeout(this.resizeTimer),this.resizeTimer=null)}}class gt{placed=[];place(t,s,i,o){const a={x:t-i/2,y:s-o/2};let r=a.x,n=a.y;const l=[[0,0],[0,-o-2],[0,o+2],[-i-4,0],[i+4,0],[0,-o*2-4],[0,o*2+4],[-i-4,-o-2],[i+4,-o-2]];for(const[y,S]of l){const p=a.x+y,T=a.y+S;let w=!1;for(const b of this.placed)if(p<b.x+b.w&&p+i>b.x&&T<b.y+b.h&&T+o>b.y){w=!0;break}if(!w){r=p,n=T;break}}return this.placed.push({x:r,y:n,w:i,h:o}),{x:r+i/2,y:n+o/2}}}class pt extends yt{fInput;doInput;constructor(t){super(t),this.fInput=this.addSlider({id:"thin-lens-f",label:"Focal Length (mm)",min:10,max:200,step:1,value:40,unit:"mm"}),this.doInput=this.addSlider({id:"thin-lens-do",label:"Lens-to-Display Distance (mm)",min:5,max:500,step:1,value:100,unit:"mm"}),this.addReadout({id:"thin-lens-di",label:"Image Distance",unit:"mm"}),this.addReadout({id:"thin-lens-m",label:"Magnification",unit:"x"}),this.addReadout({id:"thin-lens-regime",label:"Regime",unit:""})}render(){this.clear();const t=this.ctx;t.fillStyle="#111122",t.fillRect(0,0,this.width,this.height);const s=Number(this.fInput.value),i=Number(this.doInput.value),o=ft(s,i),a=Math.max(3,s*.05),r=Math.abs(i-s)<a,n=r?Number.POSITIVE_INFINITY:o,l=r?"infinity":ut(n),y=mt(o,i),S=l==="infinity"?"∞":o.toFixed(0),p=Number.isFinite(y)?y.toFixed(2):"--";this.setReadout("thin-lens-di",S),this.setReadout("thin-lens-m",p);const T=l==="infinity"?"At focal point":i<s?"HMD (virtual image)":"Projector (real image)";this.setReadout("thin-lens-regime",T);const w=40,b=50,V=i<s?Math.max(80,s*.6):60,c={x:-i,y:w},M={x:0,y:0},le=w*5;let O=c.y;if(l!=="infinity"){const d=-s-c.x;if(Math.abs(d)>.01){const h=(0-c.y)/d;O=c.y+h*(0-c.x),O=Math.max(-le,Math.min(le,O))}}const q=[];l==="infinity"?(q.push(c.y),q.push(0),q.push(c.y)):(q.push(c.y),q.push(M.y),q.push(O));const Be=Math.max(...q.map(Math.abs)),J=Math.min(Math.max(Be+12,40),80),de=J*2,ce=6,$e=Math.max(-ce,Math.min(ce,y)),he=w*$e,je=-i-40,_e=Math.max(V+40,s+20);let Ve=Math.min(je,-s-10),Je=Math.max(_e,s+10);const fe=Math.max(b+20,J+10,w+20,80);let k=Ve,I=Je,x=-fe,C=fe;const me=I-k,ue=C-x,ye=.08,ge=.12;k-=me*ye,I+=me*ye,x-=ue*ge,C+=ue*ge;const pe=300,be=180,ve=I-k,Se=C-x;if(ve<pe){const d=(pe-ve)/2;k-=d,I+=d}if(Se<be){const d=(be-Se)/2;x-=d,C+=d}const oe=this.width/this.height;if((I-k)/(C-x)>oe){const h=((I-k)/oe-(C-x))/2;x-=h,C+=h}else{const h=((C-x)*oe-(I-k))/2;k-=h,I+=h}const A=k,F=I,K=x,B=C,U=24,Ke=(this.width-U*2)/(F-A),$=(this.height-U*2)/(B-K),f=(d,h)=>({x:U+(d-A)*Ke,y:this.height-U-(h-K)*$}),E=F,W=(d,h,g)=>{dt(t,d.map(u=>f(u.x,u.y)),{color:g??m.rayLeft,dash:h})},D=new gt,Y=(d,h)=>{t.save(),t.font=h??'12px "Space Grotesk", system-ui, sans-serif';const g=t.measureText(d);return t.restore(),{w:g.width+8,h:20}},Te=f(A,0),we=f(F,0);Ne(t,Te.x,Te.y,we.x,we.y,{color:m.axis,dash:[6,6]});const Q=f(A+(F-A)*.05,B-(B-K)*.08),ae=f(F-(F-A)*.05,B-(B-K)*.08);se(t,Q.x,Q.y,ae.x,ae.y,{color:"rgba(255,255,255,0.18)",width:1.5,headSize:8}),P(t,"light direction →",(Q.x+ae.x)/2,Q.y-10,{color:"rgba(255,255,255,0.35)",background:"transparent"});const L=f(0,0);if(i>s&&!r){const d=f(-i-20,0),g=f(0,0).x-d.x,u=b*2*$+30,R=de*$+10;ct(t,d.x,L.y,u,R,g)}else if(i<s){const d=-i-15,h=V+20,g=Math.max(b,J)+10,u=f(d,g),v=f(h,-g);let R=v.x-u.x,H=v.y-u.y;const z=120,_=80;let te=u.x,Fe=u.y;if(R<z){const re=(z-R)/2;te-=re,R=z}if(H<_){const re=(_-H)/2;Fe-=re,H=_}ht(t,te,Fe,R,H)}t.save(),t.strokeStyle="rgba(255, 215, 0, 0.15)",t.lineWidth=1,t.setLineDash([6,6]),t.beginPath(),t.moveTo(L.x,0),t.lineTo(L.x,this.height),t.stroke(),t.restore();const Ue=de*$,Qe=this.height*.8,Ze=Math.min(Ue,Qe);nt(t,L.x,L.y,Ze,{color:m.lens,focalLength:s,fMin:Number(this.fInput.min),fMax:Number(this.fInput.max)});const N=f(-s,0),G=f(s,0),X=10,Z='italic 11px "Space Grotesk", system-ui, sans-serif';t.save(),t.strokeStyle=m.lens,t.lineWidth=2,t.beginPath(),t.moveTo(N.x,N.y-X),t.lineTo(N.x,N.y+X),t.stroke(),t.beginPath(),t.moveTo(G.x,G.y-X),t.lineTo(G.x,G.y+X),t.stroke(),t.restore();const Me=Y("f",Z),Le=D.place(N.x,N.y+X+12,Me.w,Me.h);P(t,"f",Le.x,Le.y,{color:m.lens,font:Z,background:"rgba(0,0,0,0.5)"});const Re=Y("f′",Z),Pe=D.place(G.x,G.y+X+12,Re.w,Re.h);P(t,"f′",Pe.x,Pe.y,{color:m.lens,font:Z,background:"rgba(0,0,0,0.5)"});const j=f(-i,b),et=f(-i,-b),ke=6;lt(t,j.x-ke/2,j.y,ke,et.y-j.y);const Ie=Y("Display"),xe=D.place(j.x,j.y-16,Ie.w,Ie.h);P(t,"Display",xe.x,xe.y,{background:"rgba(179, 157, 219, 0.25)"});const Ce=f(-i,0),Ee=f(-i,w);se(t,Ce.x,Ce.y,Ee.x,Ee.y,{color:m.accent,width:2.5});const We=l==="virtual"&&o<k,He=l==="real"&&o>I,ne=We||He,ze=he,tt=l!=="infinity"&&!ne&&ze>C,st=l!=="infinity"&&!ne&&ze<x;if(l!=="infinity"){if(!ne){const d=f(o,0),h=f(o,he);l==="virtual"?(Ne(t,d.x,d.y,h.x,h.y,{color:m.virtualImage,dash:[6,6],width:2}),se(t,d.x,d.y,h.x,h.y,{color:m.virtualImage,width:2,headSize:6})):se(t,d.x,d.y,h.x,h.y,{color:m.rayGreen,width:2.5});const g=l==="virtual"?"Virtual Image":"Real Image",u=Y(g),v=D.place(h.x,h.y-16,u.w,u.h);P(t,g,v.x,v.y,{background:l==="virtual"?"rgba(168, 85, 247, 0.25)":"rgba(76, 175, 80, 0.2)"})}}else P(t,"Image at ∞",L.x+90,L.y-40,{background:"rgba(255, 255, 255, 0.08)"});if(l==="infinity")W([{x:c.x,y:c.y},{x:M.x,y:c.y},{x:E,y:c.y}],void 0,m.rayLeft),W([{x:c.x,y:c.y},{x:M.x,y:0},{x:E,y:c.y/i*E*-1}],void 0,m.rayYellow),W([{x:c.x,y:c.y},{x:0,y:c.y},{x:E,y:c.y}],void 0,m.rayGreen);else{const d=-40/s,h={x:E,y:c.y+d*E};W([{x:c.x,y:c.y},{x:0,y:c.y},{x:h.x,y:h.y}],void 0,m.rayLeft);const g=(M.y-c.y)/(M.x-c.x),u={x:E,y:M.y+g*E};W([{x:c.x,y:c.y},{x:M.x,y:M.y},{x:u.x,y:u.y}],void 0,m.rayYellow);const v={x:E,y:O};if(W([{x:c.x,y:c.y},{x:0,y:O},{x:v.x,y:v.y}],void 0,m.rayGreen),l==="virtual"){const R=-40/s,H=(M.y-c.y)/(M.x-c.x),z=A,_=c.y+R*z;W([{x:0,y:c.y},{x:z,y:_}],[6,6],m.virtualImage);const te=M.y+H*z;W([{x:0,y:M.y},{x:z,y:te}],[6,6],m.virtualImage),W([{x:0,y:O},{x:z,y:O}],[6,6],m.virtualImage)}}const ee=f(V,0),it=i<s?Math.PI:0;rt(t,ee.x,ee.y,14,it);const Oe=Y("Eye"),De=D.place(ee.x,ee.y-26,Oe.w,Oe.h);if(P(t,"Eye",De.x,De.y,{color:m.text,background:"rgba(255,255,255,0.08)"}),i>s&&!r){const d=f(-i-20,0),g=f(0,0).x-d.x,u=Y("PROJECTOR"),v=D.place(d.x+g/2,L.y-b*$-28,u.w,u.h);P(t,"PROJECTOR",v.x,v.y,{color:"#4da6ff",background:"rgba(77,166,255,0.18)"})}else if(i<s){const d=-i-15,h=V+20,g=Math.max(b,J)+10,u=f(d,g),v=f(h,-g),R=Y("HMD"),H=D.place((u.x+v.x)/2,u.y-12,R.w,R.h);P(t,"HMD",H.x,H.y,{color:"#e94560",background:"rgba(233,69,96,0.18)"})}const Ye=l==="infinity"?"d_o = f → image at ∞":i<s?"HMD regime: d_o < f → virtual image":"Projector regime: d_o > f → real image",qe=Y(Ye),Ae=D.place(L.x,L.y+70,qe.w,qe.h);if(P(t,Ye,Ae.x,Ae.y,{background:i<s?"rgba(233, 69, 96, 0.2)":i>s?"rgba(77,166,255,0.15)":"rgba(255, 255, 255, 0.08)"}),l!=="infinity"){if(We){ie(t,"left",this.width,this.height);const d=Math.abs(o).toFixed(0);Ge(t,"left",this.width,this.height,"← Virtual Image "+d+"mm",{color:m.virtualImage,yPos:L.y-20})}if(He){ie(t,"right",this.width,this.height);const d=o.toFixed(0);Ge(t,"right",this.width,this.height,"Real Image "+d+"mm →",{color:m.rayGreen,yPos:L.y-20})}tt&&ie(t,"top",this.width,this.height),st&&ie(t,"bottom",this.width,this.height)}const ot=`1/f = 1/d_o + 1/d_i  →  1/${s} = 1/${i} + 1/${S}`;P(t,ot,this.width/2,this.height-16,{color:"rgba(255,255,255,0.6)",background:"rgba(0,0,0,0.5)",font:'11px "Space Grotesk", system-ui, sans-serif'})}}const Xe=document.querySelector('[data-panel="thin-lens"]');Xe&&new pt(Xe);
