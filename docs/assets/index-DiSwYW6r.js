(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function o(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=o(s);fetch(s.href,n)}})();const ht='12px "Space Grotesk", system-ui, sans-serif';function ae(e,t,o,i,s,n={}){const{color:r="#eaeaea",width:l=2,headSize:a=8}=n,h=Math.atan2(s-o,i-t);e.save(),e.strokeStyle=r,e.lineWidth=l,e.beginPath(),e.moveTo(t,o),e.lineTo(i,s),e.stroke(),e.beginPath(),e.moveTo(i,s),e.lineTo(i-a*Math.cos(h-Math.PI/6),s-a*Math.sin(h-Math.PI/6)),e.lineTo(i-a*Math.cos(h+Math.PI/6),s-a*Math.sin(h+Math.PI/6)),e.closePath(),e.fillStyle=r,e.fill(),e.restore()}function dt(e,t,o,i,s={}){const{color:n="#ffd700",width:r=2,focalLength:l,fMin:a=10,fMax:h=200}=s,u=i/2;let b;if(l!==void 0&&l>0){const L=Math.max(0,Math.min(1,(l-a)/(h-a)));b=i*(.25-L*.21)}else b=i*.12;e.save(),e.fillStyle="rgba(255, 215, 0, 0.08)",e.strokeStyle=n,e.lineWidth=r,e.beginPath(),e.moveTo(t,o-u),e.quadraticCurveTo(t+b,o,t,o+u),e.quadraticCurveTo(t-b,o,t,o-u),e.closePath(),e.fill(),e.stroke(),e.restore()}function Be(e,t,o,i,s,n={}){const{color:r="#888888",width:l=1,dash:a=[6,6]}=n;e.save(),e.strokeStyle=r,e.lineWidth=l,e.setLineDash(a),e.beginPath(),e.moveTo(t,o),e.lineTo(i,s),e.stroke(),e.restore()}function ft(e,t,o,i,s=0){const n=i;e.save(),e.translate(t,o),e.rotate(s),e.strokeStyle="#eaeaea",e.lineWidth=1.5,e.fillStyle="rgba(234,234,234,0.05)",e.beginPath(),e.arc(0,0,n,0,Math.PI*2),e.fill(),e.stroke(),e.fillStyle="rgba(234,234,234,0.12)",e.beginPath(),e.moveTo(n*.7,-n*.55),e.quadraticCurveTo(n*1.45,0,n*.7,n*.55),e.arc(0,0,n,Math.asin(.55),-Math.asin(.55),!0),e.closePath(),e.fill(),e.stroke(),e.fillStyle="#eaeaea",e.beginPath(),e.arc(n*.75,0,n*.18,0,Math.PI*2),e.fill(),e.restore()}function ut(e,t,o,i,s){e.save(),e.fillStyle="rgba(179, 157, 219, 0.35)",e.strokeStyle="#b39ddb",e.lineWidth=2,e.fillRect(t,o,i,s),e.strokeRect(t,o,i,s),e.restore()}function mt(e,t,o={}){const{color:i="#4da6ff",width:s=2,dash:n,glow:r}=o;e.save(),e.strokeStyle=i,e.lineWidth=s,n&&e.setLineDash(n),r&&(e.shadowColor=i,e.shadowBlur=8),e.beginPath(),t.forEach((l,a)=>{a===0?e.moveTo(l.x,l.y):e.lineTo(l.x,l.y)}),e.stroke(),e.restore()}function yt(e,t,o,i,s,n){e.save(),e.fillStyle="rgba(77,166,255,0.06)",e.strokeStyle="rgba(77,166,255,0.5)",e.lineWidth=1.5,e.beginPath(),e.moveTo(t+8,o-i/2),e.lineTo(t+n,o-s/2),e.lineTo(t+n,o+s/2),e.lineTo(t+8,o+i/2),e.arcTo(t,o+i/2,t,o+i/2-8,8),e.lineTo(t,o-i/2+8),e.arcTo(t,o-i/2,t+8,o-i/2,8),e.closePath(),e.fill(),e.stroke(),e.restore()}function pt(e,t,o,i,s){const r=i*.12,l=i*.1,a=o+s/2;e.save(),e.fillStyle="rgba(233,69,96,0.05)",e.strokeStyle="rgba(233,69,96,0.4)",e.lineWidth=1.5,e.beginPath(),e.moveTo(t+10,o),e.lineTo(t+i-10,o),e.arcTo(t+i,o,t+i,o+10,10),e.quadraticCurveTo(t+i-l,a,t+i,o+s-10),e.arcTo(t+i,o+s,t+i-10,o+s,10),e.lineTo(t+10,o+s),e.arcTo(t,o+s,t,o+s-10,10),e.quadraticCurveTo(t-r,a,t,o+10),e.arcTo(t,o,t+10,o,10),e.closePath(),e.fill(),e.stroke(),e.restore()}function re(e,t,o,i,s={}){const n=s.intensity??.18,[r,l,a]=s.color??[255,60,60],h=36;e.save();let u;switch(t){case"left":u=e.createLinearGradient(0,0,h,0),u.addColorStop(0,`rgba(${r}, ${l}, ${a}, ${n})`),u.addColorStop(1,`rgba(${r}, ${l}, ${a}, 0.0)`),e.fillStyle=u,e.fillRect(0,0,h,i);break;case"right":u=e.createLinearGradient(o,0,o-h,0),u.addColorStop(0,`rgba(${r}, ${l}, ${a}, ${n})`),u.addColorStop(1,`rgba(${r}, ${l}, ${a}, 0.0)`),e.fillStyle=u,e.fillRect(o-h,0,h,i);break;case"top":u=e.createLinearGradient(0,0,0,h),u.addColorStop(0,`rgba(${r}, ${l}, ${a}, ${n})`),u.addColorStop(1,`rgba(${r}, ${l}, ${a}, 0.0)`),e.fillStyle=u,e.fillRect(0,0,o,h);break;case"bottom":u=e.createLinearGradient(0,i,0,i-h),u.addColorStop(0,`rgba(${r}, ${l}, ${a}, ${n})`),u.addColorStop(1,`rgba(${r}, ${l}, ${a}, 0.0)`),e.fillStyle=u,e.fillRect(0,i-h,o,h);break}e.restore()}function je(e,t,o,i,s,n={}){const{color:r="#ff6b6b",yPos:l}=n,a='11px "Space Grotesk", system-ui, sans-serif',h=l??i*.35;e.save(),e.font=a;const b=e.measureText(s).width+12,L=22;if(t==="left")e.fillStyle="rgba(0, 0, 0, 0.6)",e.fillRect(8,h-L/2,b,L),e.fillStyle=r,e.textAlign="left",e.textBaseline="middle",e.fillText(s,14,h);else{const w=o-8;e.fillStyle="rgba(0, 0, 0, 0.6)",e.fillRect(w-b,h-L/2,b,L),e.fillStyle=r,e.textAlign="right",e.textBaseline="middle",e.fillText(s,w-6,h)}e.restore()}function P(e,t,o,i,s={}){const{color:n="#eaeaea",background:r="rgba(0, 0, 0, 0.45)",padding:l=4,font:a=ht}=s;e.save(),e.font=a;const u=e.measureText(t).width+l*2,b=16+l;e.fillStyle=r,e.fillRect(o-u/2,i-b/2,u,b),e.fillStyle=n,e.textAlign="center",e.textBaseline="middle",e.fillText(t,o,i+1),e.restore()}const y={accent:"#e94560",text:"#eaeaea",rayLeft:"#4da6ff",rayGreen:"#4caf50",rayYellow:"#ffc107",virtualImage:"#a855f7",lens:"#ffd700",axis:"#555555"};function gt(e,t){return 1/(1/e-1/t)}function bt(e,t){return-e/t}function vt(e){return!Number.isFinite(e)||Math.abs(e)>1e6?"infinity":e>0?"real":"virtual"}class Tt{container;canvas;ctx;controlsEl;readoutsEl;width=0;height=0;resizeObserver;rafId=null;resizeTimer=null;constructor(t){this.container=t;const o=t.querySelector("[data-canvas]"),i=t.querySelector("[data-controls]"),s=t.querySelector("[data-readouts]");if(!o||!i||!s)throw new Error("Panel container missing required elements");this.controlsEl=i,this.readoutsEl=s,this.canvas=document.createElement("canvas"),this.canvas.setAttribute("aria-label","Optics visualization"),o.appendChild(this.canvas);const n=this.canvas.getContext("2d");if(!n)throw new Error("Canvas context unavailable");this.ctx=n,this.resizeObserver=new ResizeObserver(()=>this.scheduleResize()),this.resizeObserver.observe(o),this.resize()}scheduleResize(){this.resizeTimer!==null&&window.clearTimeout(this.resizeTimer),this.resizeTimer=window.setTimeout(()=>{this.resizeTimer=null,this.resize()},120)}resize(){const t=this.canvas.parentElement;if(!t)return;const o=t.getBoundingClientRect(),i=Math.max(0,Math.floor(o.width)),s=Math.max(0,Math.floor(o.height));if(i===this.width&&s===this.height)return;const n=window.devicePixelRatio||1;this.canvas.width=Math.floor(i*n),this.canvas.height=Math.floor(s*n),this.width=i,this.height=s,this.ctx.setTransform(n,0,0,n,0,0),this.requestDraw()}requestDraw(){this.rafId!==null&&cancelAnimationFrame(this.rafId),this.rafId=requestAnimationFrame(()=>{this.rafId=null,this.render()})}addSlider(t){const o=document.createElement("div");o.className="control-row";const i=document.createElement("label");i.htmlFor=t.id,i.textContent=t.label;const s=document.createElement("div");s.className="value";const n=document.createElement("input");n.id=t.id,n.type="range",n.min=String(t.min),n.max=String(t.max),n.step=String(t.step),n.value=String(t.value);const r=l=>{const a=Number(l);s.textContent=`${a}${t.unit??""}`,t.onChange?.(a),this.requestDraw()};return n.addEventListener("input",()=>r(n.value)),r(n.value),o.appendChild(i),o.appendChild(n),o.appendChild(s),this.controlsEl.appendChild(o),n}addReadout(t){const o=document.createElement("div");o.className="readout",o.dataset.readout=t.id;const i=document.createElement("span");i.textContent=t.label;const s=document.createElement("span");return s.textContent=`--${t.unit??""}`,o.appendChild(i),o.appendChild(s),this.readoutsEl.appendChild(o),s}setReadout(t,o){const i=this.readoutsEl.querySelector(`[data-readout="${t}"] span:last-child`);i&&(i.textContent=o)}clear(){this.ctx.clearRect(0,0,this.width,this.height)}render(){this.clear();const{width:t,height:o}=this;this.ctx.fillStyle="#101424",this.ctx.fillRect(0,0,t,o),this.ctx.fillStyle="#eaeaea",this.ctx.font='14px "Space Grotesk", system-ui, sans-serif',this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("Panel rendering...",t/2,o/2)}dispose(){this.resizeObserver.disconnect(),this.resizeTimer!==null&&(window.clearTimeout(this.resizeTimer),this.resizeTimer=null)}}class wt{placed=[];displacements=[];place(t,o,i,s){const n={x:t-i/2,y:o-s/2};let r=n.x,l=n.y,a=!1;const h=[[0,0],[0,-s-2],[0,s+2],[-i-4,0],[i+4,0],[0,-s*2-4],[0,s*2+4],[-i-4,-s-2],[i+4,-s-2],[-i*2-8,0],[i*2+8,0],[0,-s*3-6],[0,s*3+6]];for(const[L,w]of h){const R=n.x+L,Y=n.y+w;let d=!1;for(const v of this.placed)if(R<v.x+v.w&&R+i>v.x&&Y<v.y+v.h&&Y+s>v.y){d=!0;break}if(!d){r=R,l=Y,a=L!==0||w!==0;break}}this.placed.push({x:r,y:l,w:i,h:s});const u=r+i/2,b=l+s/2;return a&&this.displacements.push({origX:t,origY:o,finalX:u,finalY:b}),{x:u,y:b}}drawLeaderLines(t){t.save(),t.strokeStyle="rgba(255, 255, 255, 0.2)",t.lineWidth=1,t.setLineDash([3,3]);for(const o of this.displacements)Math.hypot(o.finalX-o.origX,o.finalY-o.origY)>8&&(t.beginPath(),t.moveTo(o.origX,o.origY),t.lineTo(o.finalX,o.finalY),t.stroke(),t.fillStyle="rgba(255, 255, 255, 0.3)",t.beginPath(),t.arc(o.origX,o.origY,2,0,Math.PI*2),t.fill());t.restore()}}class St extends Tt{fInput;doInput;rayHitZones=[];tooltipEl=null;tooltipTimeout=null;constructor(t){super(t),this.fInput=this.addSlider({id:"thin-lens-f",label:"Focal Length (mm)",min:10,max:200,step:1,value:40,unit:"mm"}),this.doInput=this.addSlider({id:"thin-lens-do",label:"Lens-to-Display Distance (mm)",min:5,max:500,step:1,value:100,unit:"mm"}),this.addReadout({id:"thin-lens-di",label:"Image Distance",unit:"mm"}),this.addReadout({id:"thin-lens-m",label:"Magnification",unit:"x"}),this.addReadout({id:"thin-lens-regime",label:"Regime",unit:""}),this.tooltipEl=document.getElementById("ray-tooltip"),this.initTooltipListeners()}initTooltipListeners(){const t=this.canvas;t.addEventListener("pointermove",o=>{this.handlePointerAt(o.clientX,o.clientY)}),t.addEventListener("pointerleave",()=>{this.hideTooltip()}),t.addEventListener("touchstart",o=>{if(o.touches.length>0){const i=o.touches[0];this.handlePointerAt(i.clientX,i.clientY)}},{passive:!0}),t.addEventListener("touchend",()=>{this.tooltipTimeout!==null&&window.clearTimeout(this.tooltipTimeout),this.tooltipTimeout=window.setTimeout(()=>this.hideTooltip(),1200)},{passive:!0})}handlePointerAt(t,o){const i=this.canvas.getBoundingClientRect(),s=t-i.left,n=o-i.top,r=10;let l=-1;for(let a=0;a<this.rayHitZones.length;a++){const h=this.rayHitZones[a];for(const[u,b]of h.segments)if(Mt(s,n,u.x,u.y,b.x,b.y)<r){l=a;break}if(l>=0)break}l>=0?this.showTooltip(l,t,o):this.hideTooltip()}showTooltip(t,o,i){if(!this.tooltipEl)return;const s=this.rayHitZones[t];if(!s)return;this.tooltipTimeout!==null&&(window.clearTimeout(this.tooltipTimeout),this.tooltipTimeout=null),this.tooltipEl.innerHTML=`<div class="tooltip-title"><span class="tooltip-swatch" style="background:${s.color}"></span>${s.title}</div><div>${s.description}</div>`,this.tooltipEl.setAttribute("aria-hidden","false");const n=14;let r=o+n,l=i+n;const a=this.tooltipEl.offsetWidth||200,h=this.tooltipEl.offsetHeight||60;r+a>window.innerWidth-8&&(r=o-a-n),l+h>window.innerHeight-8&&(l=i-h-n),r<4&&(r=4),l<4&&(l=4),this.tooltipEl.style.left=r+"px",this.tooltipEl.style.top=l+"px"}hideTooltip(){this.tooltipEl&&this.tooltipEl.setAttribute("aria-hidden","true")}render(){this.clear();const t=this.ctx;t.fillStyle="#111122",t.fillRect(0,0,this.width,this.height);const o=Number(this.fInput.value),i=Number(this.doInput.value),s=gt(o,i),n=Math.max(3,o*.05),r=Math.abs(i-o)<n,l=r?Number.POSITIVE_INFINITY:s,a=r?"infinity":vt(l),h=bt(s,i),u=a==="infinity"?"∞":s.toFixed(0),b=Number.isFinite(h)?h.toFixed(2):"--";this.setReadout("thin-lens-di",u),this.setReadout("thin-lens-m",b);const L=a==="infinity"?"At focal point":i<o?"HMD (virtual image)":"Projector (real image)";this.setReadout("thin-lens-regime",L);const w=40,R=50,Y=i<o?Math.max(80,o*.6):60,d={x:-i,y:w},v={x:0,y:0},ue=w*5;let z=d.y;if(a!=="infinity"){const c=-o-d.x;if(Math.abs(c)>.01){const f=(0-d.y)/c;z=d.y+f*(0-d.x),z=Math.max(-ue,Math.min(ue,z))}}const A=[];a==="infinity"?(A.push(d.y),A.push(0),A.push(d.y)):(A.push(d.y),A.push(v.y),A.push(z));const Ze=Math.max(...A.map(Math.abs)),Q=Math.min(Math.max(Ze+12,40),80),me=Q*2,ye=6,Ve=Math.max(-ye,Math.min(ye,h)),pe=w*Ve,Je=-i-40,Ue=Math.max(Y+40,o+20);let Ke=Math.min(Je,-o-10),Qe=Math.max(Ue,o+10);const ge=Math.max(R+20,Q+10,w+20,80);let k=Ke,E=Qe,I=-ge,C=ge;const be=E-k,ve=C-I,Te=.08,we=.12;k-=be*Te,E+=be*Te,I-=ve*we,C+=ve*we;const Se=300,Me=180,Le=E-k,Re=C-I;if(Le<Se){const c=(Se-Le)/2;k-=c,E+=c}if(Re<Me){const c=(Me-Re)/2;I-=c,C+=c}const le=this.width/this.height;if((E-k)/(C-I)>le){const f=((E-k)/le-(C-I))/2;I-=f,C+=f}else{const f=((C-I)*le-(E-k))/2;k-=f,E+=f}const X=k,F=E,ee=I,Z=C,te=24,et=(this.width-te*2)/(F-X),V=(this.height-te*2)/(Z-ee),m=(c,f)=>({x:te+(c-X)*et,y:this.height-te-(f-ee)*V}),H=F,$=(c,f,p)=>{mt(t,c.map(g=>m(g.x,g.y)),{color:p??y.rayLeft,dash:f})},W=new wt,O=(c,f)=>{t.save(),t.font=f??'12px "Space Grotesk", system-ui, sans-serif';const p=t.measureText(c);return t.restore(),{w:p.width+8,h:20}},Pe=m(X,0),ke=m(F,0);Be(t,Pe.x,Pe.y,ke.x,ke.y,{color:y.axis,dash:[6,6]});const oe=m(X+(F-X)*.05,Z-(Z-ee)*.08),ce=m(F-(F-X)*.05,Z-(Z-ee)*.08);ae(t,oe.x,oe.y,ce.x,ce.y,{color:"rgba(255,255,255,0.18)",width:1.5,headSize:8}),P(t,"light direction →",(oe.x+ce.x)/2,oe.y-10,{color:"rgba(255,255,255,0.35)",background:"transparent"});const S=m(0,0);if(i>o&&!r){const c=m(-i-20,0),p=m(0,0).x-c.x,g=R*2*V+30,M=me*V+10;yt(t,c.x,S.y,g,M,p)}else if(i<o){const c=-i-15,f=Y+20,p=Math.max(R,Q)+10,g=m(c,p),T=m(f,-p);let M=T.x-g.x,x=T.y-g.y;const j=120,U=80;let ne=g.x,D=g.y;if(M<j){const K=(j-M)/2;ne-=K,M=j}if(x<U){const K=(U-x)/2;D-=K,x=U}pt(t,ne,D,M,x)}t.save(),t.strokeStyle="rgba(255, 215, 0, 0.15)",t.lineWidth=1,t.setLineDash([6,6]),t.beginPath(),t.moveTo(S.x,0),t.lineTo(S.x,this.height),t.stroke(),t.restore();const tt=me*V,ot=this.height*.8,it=Math.min(tt,ot);dt(t,S.x,S.y,it,{color:y.lens,focalLength:o,fMin:Number(this.fInput.min),fMax:Number(this.fInput.max)});const q=m(-o,0),N=m(o,0),B=10,ie='italic 11px "Space Grotesk", system-ui, sans-serif';t.save(),t.strokeStyle=y.lens,t.lineWidth=2,t.beginPath(),t.moveTo(q.x,q.y-B),t.lineTo(q.x,q.y+B),t.stroke(),t.beginPath(),t.moveTo(N.x,N.y-B),t.lineTo(N.x,N.y+B),t.stroke(),t.restore();const Ee=O("f",ie),Ie=W.place(q.x,q.y+B+12,Ee.w,Ee.h);P(t,"f",Ie.x,Ie.y,{color:y.lens,font:ie,background:"rgba(0,0,0,0.5)"});const Ce=O("f′",ie),xe=W.place(N.x,N.y+B+12,Ce.w,Ce.h);P(t,"f′",xe.x,xe.y,{color:y.lens,font:ie,background:"rgba(0,0,0,0.5)"});const J=m(-i,R),st=m(-i,-R),He=6;ut(t,J.x-He/2,J.y,He,st.y-J.y);const $e=O("Display"),We=W.place(J.x,J.y-16,$e.w,$e.h);P(t,"Display",We.x,We.y,{background:"rgba(179, 157, 219, 0.25)"});const Ye=m(-i,0),ze=m(-i,w);ae(t,Ye.x,Ye.y,ze.x,ze.y,{color:y.accent,width:2.5});const Oe=a==="virtual"&&s<k,De=a==="real"&&s>E,he=Oe||De,Ae=pe,nt=a!=="infinity"&&!he&&Ae>C,at=a!=="infinity"&&!he&&Ae<I;if(a!=="infinity"){if(!he){const c=m(s,0),f=m(s,pe);a==="virtual"?(Be(t,c.x,c.y,f.x,f.y,{color:y.virtualImage,dash:[6,6],width:2}),ae(t,c.x,c.y,f.x,f.y,{color:y.virtualImage,width:2,headSize:6})):ae(t,c.x,c.y,f.x,f.y,{color:y.rayGreen,width:2.5});const p=a==="virtual"?"Virtual Image":"Real Image",g=O(p),T=W.place(f.x,f.y-16,g.w,g.h);P(t,p,T.x,T.y,{background:a==="virtual"?"rgba(168, 85, 247, 0.25)":"rgba(76, 175, 80, 0.2)"})}}else P(t,"Image at ∞",S.x+90,S.y-40,{background:"rgba(255, 255, 255, 0.08)"});const G=[];if(a==="infinity"){const c=[{x:d.x,y:d.y},{x:v.x,y:d.y},{x:H,y:d.y}];$(c,void 0,y.rayLeft),G.push({segments:_(c,m),title:"Ray 1: Parallel Ray",description:"Travels parallel to the optical axis from the object tip to the lens, then refracts through the back focal point.",color:y.rayLeft});const f=[{x:d.x,y:d.y},{x:v.x,y:0},{x:H,y:d.y/i*H*-1}];$(f,void 0,y.rayYellow),G.push({segments:_(f,m),title:"Ray 2: Central Ray",description:"Passes straight through the center of the lens without bending, since the lens is thin.",color:y.rayYellow});const p=[{x:d.x,y:d.y},{x:0,y:d.y},{x:H,y:d.y}];$(p,void 0,y.rayGreen),G.push({segments:_(p,m),title:"Ray 3: Focal Ray",description:"Aimed toward the front focal point before the lens; after refraction, exits parallel to the axis.",color:y.rayGreen})}else{const c=-40/o,f={x:H,y:d.y+c*H},p=[{x:d.x,y:d.y},{x:0,y:d.y},{x:f.x,y:f.y}];$(p,void 0,y.rayLeft),G.push({segments:_(p,m),title:"Ray 1: Parallel Ray",description:"Travels parallel to the optical axis, then refracts through the back focal point (f′). Used to locate where the image forms.",color:y.rayLeft});const g=(v.y-d.y)/(v.x-d.x),T={x:H,y:v.y+g*H},M=[{x:d.x,y:d.y},{x:v.x,y:v.y},{x:T.x,y:T.y}];$(M,void 0,y.rayYellow),G.push({segments:_(M,m),title:"Ray 2: Central Ray",description:"Passes through the lens center undeviated. In a thin lens, the two refractions cancel out so this ray continues in a straight line.",color:y.rayYellow});const x={x:H,y:z},j=[{x:d.x,y:d.y},{x:0,y:z},{x:x.x,y:x.y}];if($(j,void 0,y.rayGreen),G.push({segments:_(j,m),title:"Ray 3: Focal Ray",description:"Passes through (or aims toward) the front focal point (f), then exits the lens parallel to the optical axis.",color:y.rayGreen}),a==="virtual"){const U=-40/o,ne=(v.y-d.y)/(v.x-d.x),D=X,K=d.y+U*D;$([{x:0,y:d.y},{x:D,y:K}],[6,6],y.virtualImage);const ct=v.y+ne*D;$([{x:0,y:v.y},{x:D,y:ct}],[6,6],y.virtualImage),$([{x:0,y:z},{x:D,y:z}],[6,6],y.virtualImage)}}this.rayHitZones=G;const se=m(Y,0),rt=i<o?Math.PI:0;ft(t,se.x,se.y,14,rt);const Xe=O("Eye"),Ge=W.place(se.x,se.y-26,Xe.w,Xe.h);if(P(t,"Eye",Ge.x,Ge.y,{color:y.text,background:"rgba(255,255,255,0.08)"}),i>o&&!r){const c=m(-i-20,0),p=m(0,0).x-c.x,g=O("PROJECTOR"),T=W.place(c.x+p/2,S.y-R*V-28,g.w,g.h);P(t,"PROJECTOR",T.x,T.y,{color:"#4da6ff",background:"rgba(77,166,255,0.18)"})}else if(i<o){const c=-i-15,f=Y+20,p=Math.max(R,Q)+10,g=m(c,p),T=m(f,-p),M=O("HMD"),x=W.place((g.x+T.x)/2,g.y-12,M.w,M.h);P(t,"HMD",x.x,x.y,{color:"#e94560",background:"rgba(233,69,96,0.18)"})}const Fe=a==="infinity"?"d_o = f → image at ∞":i<o?"HMD regime: d_o < f → virtual image":"Projector regime: d_o > f → real image",qe=O(Fe),Ne=W.place(S.x,S.y+70,qe.w,qe.h);P(t,Fe,Ne.x,Ne.y,{background:i<o?"rgba(233, 69, 96, 0.2)":i>o?"rgba(77,166,255,0.15)":"rgba(255, 255, 255, 0.08)"});const de=[168,85,247],fe=[76,175,80];if(a!=="infinity"){if(Oe){re(t,"left",this.width,this.height,{color:de});const c=Math.abs(s).toFixed(0);je(t,"left",this.width,this.height,"← Virtual Image "+c+"mm",{color:y.virtualImage,yPos:S.y-20})}if(De){re(t,"right",this.width,this.height,{color:fe});const c=s.toFixed(0);je(t,"right",this.width,this.height,"Real Image "+c+"mm →",{color:y.rayGreen,yPos:S.y-20})}if(nt){const c=i<o?de:fe;re(t,"top",this.width,this.height,{color:c})}if(at){const c=i<o?de:fe;re(t,"bottom",this.width,this.height,{color:c})}}W.drawLeaderLines(t);const lt=`1/f = 1/d_o + 1/d_i  →  1/${o} = 1/${i} + 1/${u}`;P(t,lt,this.width/2,this.height-16,{color:"rgba(255,255,255,0.6)",background:"rgba(0,0,0,0.5)",font:'11px "Space Grotesk", system-ui, sans-serif'})}}function _(e,t){const o=[];for(let i=0;i<e.length-1;i++)o.push([t(e[i].x,e[i].y),t(e[i+1].x,e[i+1].y)]);return o}function Mt(e,t,o,i,s,n){const r=s-o,l=n-i,a=r*r+l*l;if(a===0)return Math.hypot(e-o,t-i);let h=((e-o)*r+(t-i)*l)/a;return h=Math.max(0,Math.min(1,h)),Math.hypot(e-(o+h*r),t-(i+h*l))}const _e=document.querySelector('[data-panel="thin-lens"]');_e&&new St(_e);
