(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function o(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=o(s);fetch(s.href,n)}})();const ft='12px "Space Grotesk", system-ui, sans-serif';function re(e,t,o,i,s,n={}){const{color:r="#eaeaea",width:l=2,headSize:a=8}=n,d=Math.atan2(s-o,i-t);e.save(),e.strokeStyle=r,e.lineWidth=l,e.beginPath(),e.moveTo(t,o),e.lineTo(i,s),e.stroke(),e.beginPath(),e.moveTo(i,s),e.lineTo(i-a*Math.cos(d-Math.PI/6),s-a*Math.sin(d-Math.PI/6)),e.lineTo(i-a*Math.cos(d+Math.PI/6),s-a*Math.sin(d+Math.PI/6)),e.closePath(),e.fillStyle=r,e.fill(),e.restore()}function ut(e,t,o,i,s={}){const{color:n="#ffd700",width:r=2,focalLength:l,fMin:a=10,fMax:d=200}=s,u=i/2;let g;if(l!==void 0&&l>0){const T=Math.max(0,Math.min(1,(l-a)/(d-a)));g=i*(.25-T*.21)}else g=i*.12;e.save(),e.fillStyle="rgba(255, 215, 0, 0.08)",e.strokeStyle=n,e.lineWidth=r,e.beginPath(),e.moveTo(t,o-u),e.quadraticCurveTo(t+g,o,t,o+u),e.quadraticCurveTo(t-g,o,t,o-u),e.closePath(),e.fill(),e.stroke(),e.restore()}function Ne(e,t,o,i,s,n={}){const{color:r="#888888",width:l=1,dash:a=[6,6]}=n;e.save(),e.strokeStyle=r,e.lineWidth=l,e.setLineDash(a),e.beginPath(),e.moveTo(t,o),e.lineTo(i,s),e.stroke(),e.restore()}function mt(e,t,o,i,s=0){const n=i;e.save(),e.translate(t,o),e.rotate(s),e.strokeStyle="#eaeaea",e.lineWidth=1.5,e.fillStyle="rgba(234,234,234,0.05)",e.beginPath(),e.arc(0,0,n,0,Math.PI*2),e.fill(),e.stroke(),e.fillStyle="rgba(234,234,234,0.12)",e.beginPath(),e.moveTo(n*.7,-n*.55),e.quadraticCurveTo(n*1.45,0,n*.7,n*.55),e.arc(0,0,n,Math.asin(.55),-Math.asin(.55),!0),e.closePath(),e.fill(),e.stroke(),e.fillStyle="#eaeaea",e.beginPath(),e.arc(n*.75,0,n*.28,0,Math.PI*2),e.fill(),e.restore()}function yt(e,t,o,i,s){e.save(),e.fillStyle="rgba(179, 157, 219, 0.15)",e.strokeStyle="rgba(179, 157, 219, 0.45)",e.lineWidth=1.5,e.fillRect(t,o,i,s),e.strokeRect(t,o,i,s),e.restore()}function pt(e,t,o={}){const{color:i="#4da6ff",width:s=2,dash:n,glow:r}=o;e.save(),e.strokeStyle=i,e.lineWidth=s,n&&e.setLineDash(n),r&&(e.shadowColor=i,e.shadowBlur=8),e.beginPath(),t.forEach((l,a)=>{a===0?e.moveTo(l.x,l.y):e.lineTo(l.x,l.y)}),e.stroke(),e.restore()}function gt(e,t,o,i,s,n){e.save(),e.fillStyle="rgba(77,166,255,0.06)",e.strokeStyle="rgba(77,166,255,0.5)",e.lineWidth=1.5,e.beginPath(),e.moveTo(t+8,o-i/2),e.lineTo(t+n,o-s/2),e.lineTo(t+n,o+s/2),e.lineTo(t+8,o+i/2),e.arcTo(t,o+i/2,t,o+i/2-8,8),e.lineTo(t,o-i/2+8),e.arcTo(t,o-i/2,t+8,o-i/2,8),e.closePath(),e.fill(),e.stroke(),e.restore()}function bt(e,t,o,i,s){const r=i*.12,l=i*.1,a=o+s/2;e.save(),e.fillStyle="rgba(233,69,96,0.05)",e.strokeStyle="rgba(233,69,96,0.4)",e.lineWidth=1.5,e.beginPath(),e.moveTo(t+10,o),e.lineTo(t+i-10,o),e.arcTo(t+i,o,t+i,o+10,10),e.quadraticCurveTo(t+i-l,a,t+i,o+s-10),e.arcTo(t+i,o+s,t+i-10,o+s,10),e.lineTo(t+10,o+s),e.arcTo(t,o+s,t,o+s-10,10),e.quadraticCurveTo(t-r,a,t,o+10),e.arcTo(t,o,t+10,o,10),e.closePath(),e.fill(),e.stroke(),e.restore()}function le(e,t,o,i,s={}){const n=s.intensity??.18,[r,l,a]=s.color??[255,60,60],d=36;e.save();let u;switch(t){case"left":u=e.createLinearGradient(0,0,d,0),u.addColorStop(0,`rgba(${r}, ${l}, ${a}, ${n})`),u.addColorStop(1,`rgba(${r}, ${l}, ${a}, 0.0)`),e.fillStyle=u,e.fillRect(0,0,d,i);break;case"right":u=e.createLinearGradient(o,0,o-d,0),u.addColorStop(0,`rgba(${r}, ${l}, ${a}, ${n})`),u.addColorStop(1,`rgba(${r}, ${l}, ${a}, 0.0)`),e.fillStyle=u,e.fillRect(o-d,0,d,i);break;case"top":u=e.createLinearGradient(0,0,0,d),u.addColorStop(0,`rgba(${r}, ${l}, ${a}, ${n})`),u.addColorStop(1,`rgba(${r}, ${l}, ${a}, 0.0)`),e.fillStyle=u,e.fillRect(0,0,o,d);break;case"bottom":u=e.createLinearGradient(0,i,0,i-d),u.addColorStop(0,`rgba(${r}, ${l}, ${a}, ${n})`),u.addColorStop(1,`rgba(${r}, ${l}, ${a}, 0.0)`),e.fillStyle=u,e.fillRect(0,i-d,o,d);break}e.restore()}function qe(e,t,o,i,s,n={}){const{color:r="#ff6b6b",yPos:l}=n,a='11px "Space Grotesk", system-ui, sans-serif',d=l??i*.35;e.save(),e.font=a;const g=e.measureText(s).width+12,T=22;if(t==="left")e.fillStyle="rgba(0, 0, 0, 0.6)",e.fillRect(8,d-T/2,g,T),e.fillStyle=r,e.textAlign="left",e.textBaseline="middle",e.fillText(s,14,d);else{const S=o-8;e.fillStyle="rgba(0, 0, 0, 0.6)",e.fillRect(S-g,d-T/2,g,T),e.fillStyle=r,e.textAlign="right",e.textBaseline="middle",e.fillText(s,S-6,d)}e.restore()}function X(e,t,o,i,s={}){const{color:n="#eaeaea",background:r="rgba(0, 0, 0, 0.45)",padding:l=4,font:a=ft}=s;e.save(),e.font=a;const u=e.measureText(t).width+l*2,g=16+l;e.fillStyle=r,e.fillRect(o-u/2,i-g/2,u,g),e.fillStyle=n,e.textAlign="center",e.textBaseline="middle",e.fillText(t,o,i+1),e.restore()}function Be(e,t,o,i,s={}){const{color:n="#eaeaea",background:r="rgba(0, 0, 0, 0.45)",padding:l=4}=s,a='12px "Space Grotesk", system-ui, sans-serif',d='italic 13px "Times New Roman", Georgia, serif',u='italic 10px "Times New Roman", Georgia, serif',g=3;let T=0;const S=[];for(const m of t){if(e.save(),m.type==="math"){e.font=d;let v=e.measureText(m.base).width;m.sub&&(e.font=u,v+=e.measureText(m.sub).width),v+=g*2,S.push({w:v,seg:m}),T+=v}else{e.font=a;const v=e.measureText(m.text).width;S.push({w:v,seg:m}),T+=v}e.restore()}const M=T+l*2+4,L=18+l;e.save(),e.fillStyle=r,e.fillRect(o-M/2,i-L/2,M,L);let c=o-T/2;for(const{w:m,seg:v}of S){if(v.type==="math"){const x=c+g;e.font=d,e.fillStyle=n,e.textAlign="left",e.textBaseline="middle";const W=e.measureText(v.base).width;e.fillText(v.base,x,i),v.sub&&(e.font=u,e.fillText(v.sub,x+W,i+4))}else e.font=a,e.fillStyle=n,e.textAlign="left",e.textBaseline="middle",e.fillText(v.text,c,i+1);c+=m}return e.restore(),{width:M,height:L}}const p={accent:"#e94560",text:"#eaeaea",rayLeft:"#4da6ff",rayGreen:"#4caf50",rayYellow:"#ffc107",virtualImage:"#a855f7",lens:"#ffd700",axis:"#555555"};function wt(e,t){return 1/(1/e-1/t)}function vt(e,t){return-e/t}function Tt(e){return!Number.isFinite(e)||Math.abs(e)>1e6?"infinity":e>0?"real":"virtual"}class St{container;canvas;ctx;controlsEl;readoutsEl;width=0;height=0;resizeObserver;rafId=null;resizeTimer=null;constructor(t){this.container=t;const o=t.querySelector("[data-canvas]"),i=t.querySelector("[data-controls]"),s=t.querySelector("[data-readouts]");if(!o||!i||!s)throw new Error("Panel container missing required elements");this.controlsEl=i,this.readoutsEl=s,this.canvas=document.createElement("canvas"),this.canvas.setAttribute("aria-label","Optics visualization"),o.appendChild(this.canvas);const n=this.canvas.getContext("2d");if(!n)throw new Error("Canvas context unavailable");this.ctx=n,this.resizeObserver=new ResizeObserver(()=>this.scheduleResize()),this.resizeObserver.observe(o),this.resize()}scheduleResize(){this.resizeTimer!==null&&window.clearTimeout(this.resizeTimer),this.resizeTimer=window.setTimeout(()=>{this.resizeTimer=null,this.resize()},120)}resize(){const t=this.canvas.parentElement;if(!t)return;const o=t.getBoundingClientRect(),i=Math.max(0,Math.floor(o.width)),s=Math.max(0,Math.floor(o.height));if(i===this.width&&s===this.height)return;const n=window.devicePixelRatio||1;this.canvas.width=Math.floor(i*n),this.canvas.height=Math.floor(s*n),this.width=i,this.height=s,this.ctx.setTransform(n,0,0,n,0,0),this.requestDraw()}requestDraw(){this.rafId!==null&&cancelAnimationFrame(this.rafId),this.rafId=requestAnimationFrame(()=>{this.rafId=null,this.render()})}addSlider(t){const o=document.createElement("div");o.className="control-row";const i=document.createElement("label");i.htmlFor=t.id,i.textContent=t.label;const s=document.createElement("div");s.className="value";const n=document.createElement("input");n.id=t.id,n.type="range",n.min=String(t.min),n.max=String(t.max),n.step=String(t.step),n.value=String(t.value);const r=l=>{const a=Number(l);s.textContent=`${a}${t.unit??""}`,t.onChange?.(a),this.requestDraw()};return n.addEventListener("input",()=>r(n.value)),r(n.value),o.appendChild(i),o.appendChild(n),o.appendChild(s),this.controlsEl.appendChild(o),n}addReadout(t){const o=document.createElement("div");o.className="readout",o.dataset.readout=t.id;const i=document.createElement("span");i.textContent=t.label;const s=document.createElement("span");return s.textContent=`--${t.unit??""}`,o.appendChild(i),o.appendChild(s),this.readoutsEl.appendChild(o),s}setReadout(t,o){const i=this.readoutsEl.querySelector(`[data-readout="${t}"] span:last-child`);i&&(i.textContent=o)}clear(){this.ctx.clearRect(0,0,this.width,this.height)}render(){this.clear();const{width:t,height:o}=this;this.ctx.fillStyle="#101424",this.ctx.fillRect(0,0,t,o),this.ctx.fillStyle="#eaeaea",this.ctx.font='14px "Space Grotesk", system-ui, sans-serif',this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("Panel rendering...",t/2,o/2)}dispose(){this.resizeObserver.disconnect(),this.resizeTimer!==null&&(window.clearTimeout(this.resizeTimer),this.resizeTimer=null)}}class Mt{placed=[];displacements=[];place(t,o,i,s){const n={x:t-i/2,y:o-s/2};let r=n.x,l=n.y,a=!1;const d=[[0,0],[0,-s-2],[0,s+2],[-i-4,0],[i+4,0],[0,-s*2-4],[0,s*2+4],[-i-4,-s-2],[i+4,-s-2],[-i*2-8,0],[i*2+8,0],[0,-s*3-6],[0,s*3+6]];for(const[T,S]of d){const M=n.x+T,L=n.y+S;let c=!1;for(const m of this.placed)if(M<m.x+m.w&&M+i>m.x&&L<m.y+m.h&&L+s>m.y){c=!0;break}if(!c){r=M,l=L,a=T!==0||S!==0;break}}this.placed.push({x:r,y:l,w:i,h:s});const u=r+i/2,g=l+s/2;return a&&this.displacements.push({origX:t,origY:o,finalX:u,finalY:g}),{x:u,y:g}}drawLeaderLines(t){t.save(),t.strokeStyle="rgba(255, 255, 255, 0.2)",t.lineWidth=1,t.setLineDash([3,3]);for(const o of this.displacements)Math.hypot(o.finalX-o.origX,o.finalY-o.origY)>8&&(t.beginPath(),t.moveTo(o.origX,o.origY),t.lineTo(o.finalX,o.finalY),t.stroke(),t.fillStyle="rgba(255, 255, 255, 0.3)",t.beginPath(),t.arc(o.origX,o.origY,2,0,Math.PI*2),t.fill());t.restore()}}class Rt extends St{fInput;doInput;rayHitZones=[];tooltipEl=null;tooltipTimeout=null;constructor(t){super(t),this.fInput=this.addSlider({id:"thin-lens-f",label:"Focal length f (mm)",min:10,max:200,step:1,value:40,unit:"mm"}),this.doInput=this.addSlider({id:"thin-lens-do",label:"Object distance dₒ (mm)",min:5,max:500,step:1,value:100,unit:"mm"}),this.addReadout({id:"thin-lens-di",label:"Image distance dᵢ",unit:"mm"}),this.addReadout({id:"thin-lens-m",label:"Magnification M",unit:"x"}),this.addReadout({id:"thin-lens-regime",label:"Regime",unit:""}),this.tooltipEl=document.getElementById("ray-tooltip"),this.initTooltipListeners()}initTooltipListeners(){const t=this.canvas;t.addEventListener("pointermove",o=>{this.handlePointerAt(o.clientX,o.clientY)}),t.addEventListener("pointerleave",()=>{this.hideTooltip()}),t.addEventListener("touchstart",o=>{if(o.touches.length>0){const i=o.touches[0];this.handlePointerAt(i.clientX,i.clientY)}},{passive:!0}),t.addEventListener("touchend",()=>{this.tooltipTimeout!==null&&window.clearTimeout(this.tooltipTimeout),this.tooltipTimeout=window.setTimeout(()=>this.hideTooltip(),1200)},{passive:!0})}handlePointerAt(t,o){const i=this.canvas.getBoundingClientRect(),s=t-i.left,n=o-i.top,r=10;let l=-1;for(let a=0;a<this.rayHitZones.length;a++){const d=this.rayHitZones[a];for(const[u,g]of d.segments)if(Lt(s,n,u.x,u.y,g.x,g.y)<r){l=a;break}if(l>=0)break}l>=0?this.showTooltip(l,t,o):this.hideTooltip()}showTooltip(t,o,i){if(!this.tooltipEl)return;const s=this.rayHitZones[t];if(!s)return;this.tooltipTimeout!==null&&(window.clearTimeout(this.tooltipTimeout),this.tooltipTimeout=null),this.tooltipEl.innerHTML=`<div class="tooltip-title"><span class="tooltip-swatch" style="background:${s.color}"></span>${s.title}</div><div>${s.description}</div>`,this.tooltipEl.setAttribute("aria-hidden","false");const n=14;let r=o+n,l=i+n;const a=this.tooltipEl.offsetWidth||200,d=this.tooltipEl.offsetHeight||60;r+a>window.innerWidth-8&&(r=o-a-n),l+d>window.innerHeight-8&&(l=i-d-n),r<4&&(r=4),l<4&&(l=4),this.tooltipEl.style.left=r+"px",this.tooltipEl.style.top=l+"px"}hideTooltip(){this.tooltipEl&&this.tooltipEl.setAttribute("aria-hidden","true")}render(){this.clear();const t=this.ctx;t.fillStyle="#111122",t.fillRect(0,0,this.width,this.height);const o=Number(this.fInput.value),i=Number(this.doInput.value),s=wt(o,i),n=Math.max(3,o*.05),r=Math.abs(i-o)<n,l=r?Number.POSITIVE_INFINITY:s,a=r?"infinity":Tt(l),d=vt(s,i),u=a==="infinity"?"∞":s.toFixed(0),g=Number.isFinite(d)?d.toFixed(2):"--";this.setReadout("thin-lens-di",u),this.setReadout("thin-lens-m",g);const T=a==="infinity"?"At focal point":i<o?"HMD (virtual image)":"Projector (real image)";this.setReadout("thin-lens-regime",T);const S=40,M=50,L=i<o?Math.max(80,o*.6):60,c={x:-i,y:S},m={x:0,y:0},v=S*5;let x=c.y;if(a!=="infinity"){const h=-o-c.x;if(Math.abs(h)>.01){const f=(0-c.y)/h;x=c.y+f*(0-c.x),x=Math.max(-v,Math.min(v,x))}}const W=[];a==="infinity"?(W.push(c.y),W.push(0),W.push(c.y)):(W.push(c.y),W.push(m.y),W.push(x));const Ze=Math.max(...W.map(Math.abs)),Q=Math.min(Math.max(Ze+12,40),80),me=Q*2,ye=6,Ve=Math.max(-ye,Math.min(ye,d)),pe=S*Ve,_e=-i-40,Je=Math.max(L+40,o+20);let Ue=Math.min(_e,-o-10),Ke=Math.max(Je,o+10);const ge=Math.max(M+20,Q+10,S+20,80);let E=Ue,C=Ke,I=-ge,H=ge;const be=C-E,we=H-I,ve=.08,Te=.12;E-=be*ve,C+=be*ve,I-=we*Te,H+=we*Te;const Se=300,Me=180,Re=C-E,Le=H-I;if(Re<Se){const h=(Se-Re)/2;E-=h,C+=h}if(Le<Me){const h=(Me-Le)/2;I-=h,H+=h}const he=this.width/this.height;if((C-E)/(H-I)>he){const f=((C-E)/he-(H-I))/2;I-=f,H+=f}else{const f=((H-I)*he-(C-E))/2;E-=f,C+=f}const D=E,q=C,ee=I,J=H,te=24,Qe=(this.width-te*2)/(q-D),U=(this.height-te*2)/(J-ee),y=(h,f)=>({x:te+(h-D)*Qe,y:this.height-te-(f-ee)*U}),Y=q,z=(h,f,b)=>{pt(t,h.map(w=>y(w.x,w.y)),{color:b??p.rayLeft,dash:f})},O=new Mt,F=(h,f)=>{t.save(),t.font=f??'12px "Space Grotesk", system-ui, sans-serif';const b=t.measureText(h);return t.restore(),{w:b.width+8,h:20}},Pe=y(D,0),ke=y(q,0);Ne(t,Pe.x,Pe.y,ke.x,ke.y,{color:p.axis,dash:[6,6]});const xe=.04,oe=y(D+(q-D)*.05,J-(J-ee)*xe),de=y(q-(q-D)*.05,J-(J-ee)*xe);re(t,oe.x,oe.y,de.x,de.y,{color:"rgba(255,255,255,0.18)",width:1.5,headSize:8}),X(t,"Light direction →",(oe.x+de.x)/2,oe.y-10,{color:"rgba(255,255,255,0.35)",background:"transparent"});const P=y(0,0);if(i>o&&!r){const h=y(-i-20,0),b=y(0,0).x-h.x,w=M*2*U+30,k=me*U+10;gt(t,h.x,P.y,w,k,b)}else if(i<o){const h=-i-15,f=L+20,b=Math.max(M,Q)+10,w=y(h,b),R=y(f,-b);let k=R.x-w.x,$=R.y-w.y;const V=120,N=80;let ne=w.x,ae=w.y;if(k<V){const A=(V-k)/2;ne-=A,k=V}if($<N){const A=(N-$)/2;ae-=A,$=N}bt(t,ne,ae,k,$)}t.save(),t.strokeStyle="rgba(255, 215, 0, 0.15)",t.lineWidth=1,t.setLineDash([6,6]),t.beginPath(),t.moveTo(P.x,0),t.lineTo(P.x,this.height),t.stroke(),t.restore();const et=me*U,tt=this.height*.8,ot=Math.min(et,tt);ut(t,P.x,P.y,ot,{color:p.lens,focalLength:o,fMin:Number(this.fInput.min),fMax:Number(this.fInput.max)});const B=y(-o,0),j=y(o,0),Z=10,ie='italic 12px "Times New Roman", Georgia, serif';t.save(),t.strokeStyle=p.lens,t.lineWidth=2,t.beginPath(),t.moveTo(B.x,B.y-Z),t.lineTo(B.x,B.y+Z),t.stroke(),t.beginPath(),t.moveTo(j.x,j.y-Z),t.lineTo(j.x,j.y+Z),t.stroke(),t.restore();const Ee=F("f",ie),Ce=O.place(B.x,B.y+Z+12,Ee.w,Ee.h);X(t,"f",Ce.x,Ce.y,{color:p.lens,font:ie,background:"rgba(0,0,0,0.5)"});const Ie=F("f′",ie),He=O.place(j.x,j.y+Z+12,Ie.w,Ie.h);X(t,"f′",He.x,He.y,{color:p.lens,font:ie,background:"rgba(0,0,0,0.5)"});const K=y(-i,M),it=y(-i,-M),$e=6;yt(t,K.x-$e/2,K.y,$e,it.y-K.y);const We=F("Display"),Ye=O.place(K.x,K.y-16,We.w,We.h);X(t,"Display",Ye.x,Ye.y,{background:"rgba(179, 157, 219, 0.25)"});const ze=y(-i,0),Oe=y(-i,S);re(t,ze.x,ze.y,Oe.x,Oe.y,{color:p.accent,width:2.5});const Ae=a==="virtual"&&s<E,Xe=a==="real"&&s>C,ce=Ae||Xe,Fe=pe,st=a!=="infinity"&&!ce&&Fe>H,nt=a!=="infinity"&&!ce&&Fe<I;if(a!=="infinity"){if(!ce){const h=y(s,0),f=y(s,pe);a==="virtual"?(Ne(t,h.x,h.y,f.x,f.y,{color:p.virtualImage,dash:[6,6],width:2}),re(t,h.x,h.y,f.x,f.y,{color:p.virtualImage,width:2,headSize:6})):re(t,h.x,h.y,f.x,f.y,{color:p.rayGreen,width:2.5});const b=a==="virtual"?"Virtual Image":"Real Image",w=F(b),R=O.place(f.x,f.y-16,w.w,w.h);X(t,b,R.x,R.y,{background:a==="virtual"?"rgba(168, 85, 247, 0.25)":"rgba(76, 175, 80, 0.2)"})}}else{const h=F("Image at ∞"),f=O.place(P.x+90,P.y-40,h.w,h.h);X(t,"Image at ∞",f.x,f.y,{background:"rgba(255, 255, 255, 0.08)"})}const G=[];if(a==="infinity"){const h=[{x:c.x,y:c.y},{x:m.x,y:c.y},{x:Y,y:c.y}];z(h,void 0,p.rayLeft),G.push({segments:_(h,y),title:"Ray 1: Parallel Ray",description:"Travels parallel to the optical axis from the object tip to the lens, then refracts through the back focal point.",color:p.rayLeft});const f=[{x:c.x,y:c.y},{x:m.x,y:0},{x:Y,y:c.y/i*Y*-1}];z(f,void 0,p.rayYellow),G.push({segments:_(f,y),title:"Ray 2: Central Ray",description:"Passes straight through the center of the lens without bending, since the lens is thin.",color:p.rayYellow});const b=[{x:c.x,y:c.y},{x:0,y:c.y},{x:Y,y:c.y}];z(b,void 0,p.rayGreen),G.push({segments:_(b,y),title:"Ray 3: Focal Ray",description:"Aimed toward the front focal point before the lens; after refraction, exits parallel to the axis.",color:p.rayGreen})}else{const h=-40/o,f={x:Y,y:c.y+h*Y},b=[{x:c.x,y:c.y},{x:0,y:c.y},{x:f.x,y:f.y}];z(b,void 0,p.rayLeft),G.push({segments:_(b,y),title:"Ray 1: Parallel Ray",description:"Travels parallel to the optical axis, then refracts through the back focal point (f′). Used to locate where the image forms.",color:p.rayLeft});const w=(m.y-c.y)/(m.x-c.x),R={x:Y,y:m.y+w*Y},k=[{x:c.x,y:c.y},{x:m.x,y:m.y},{x:R.x,y:R.y}];z(k,void 0,p.rayYellow),G.push({segments:_(k,y),title:"Ray 2: Central Ray",description:"Passes through the lens center undeviated. In a thin lens, the two refractions cancel out so this ray continues in a straight line.",color:p.rayYellow});const $={x:Y,y:x},V=[{x:c.x,y:c.y},{x:0,y:x},{x:$.x,y:$.y}];if(z(V,void 0,p.rayGreen),G.push({segments:_(V,y),title:"Ray 3: Focal Ray",description:"Passes through (or aims toward) the front focal point (f), then exits the lens parallel to the optical axis.",color:p.rayGreen}),a==="virtual"){const N="rgba(168, 85, 247, 0.35)",ne=-40/o,ae=(m.y-c.y)/(m.x-c.x),A=D,dt=c.y+ne*A;z([{x:0,y:c.y},{x:A,y:dt}],[6,6],N);const ct=m.y+ae*A;z([{x:0,y:m.y},{x:A,y:ct}],[6,6],N),z([{x:0,y:x},{x:A,y:x}],[6,6],N)}}this.rayHitZones=G;const se=y(L,0),at=i<o?Math.PI:0;mt(t,se.x,se.y,22,at);const De=F("Eye"),Ge=O.place(se.x,se.y-26,De.w,De.h);if(X(t,"Eye",Ge.x,Ge.y,{color:p.text,background:"rgba(255,255,255,0.08)"}),i>o&&!r){const h=y(-i-20,0),b=y(0,0).x-h.x,w=F("PROJECTOR"),R=O.place(h.x+b/2,P.y-M*U-28,w.w,w.h);X(t,"PROJECTOR",R.x,R.y,{color:"#4da6ff",background:"rgba(77,166,255,0.18)"})}else if(i<o){const h=-i-15,f=L+20,b=Math.max(M,Q)+10,w=y(h,b),R=y(f,-b),k=F("HMD"),$=O.place((w.x+R.x)/2,w.y-12,k.w,k.h);X(t,"HMD",$.x,$.y,{color:"#e94560",background:"rgba(233,69,96,0.18)"})}const rt=a==="infinity"?[{type:"math",base:"d",sub:"o"},{type:"text",text:" = ",base:""},{type:"math",base:"f"},{type:"text",text:"  →  image at ∞",base:""}]:i<o?[{type:"text",text:"HMD:  ",base:""},{type:"math",base:"d",sub:"o"},{type:"text",text:" < ",base:""},{type:"math",base:"f"},{type:"text",text:"  →  virtual image",base:""}]:[{type:"text",text:"Projector:  ",base:""},{type:"math",base:"d",sub:"o"},{type:"text",text:" > ",base:""},{type:"math",base:"f"},{type:"text",text:"  →  real image",base:""}],lt=i<o?"rgba(233, 69, 96, 0.2)":i>o?"rgba(77,166,255,0.15)":"rgba(255, 255, 255, 0.08)";Be(t,rt,P.x,P.y+70,{background:lt});const fe=[168,85,247],ue=[76,175,80];if(a!=="infinity"){if(Ae){le(t,"left",this.width,this.height,{color:fe});const h=Math.abs(s).toFixed(0);qe(t,"left",this.width,this.height,"← Virtual Image "+h+"mm",{color:p.virtualImage,yPos:P.y-20})}if(Xe){le(t,"right",this.width,this.height,{color:ue});const h=s.toFixed(0);qe(t,"right",this.width,this.height,"Real Image "+h+"mm →",{color:p.rayGreen,yPos:P.y-20})}if(st){const h=i<o?fe:ue;le(t,"top",this.width,this.height,{color:h})}if(nt){const h=i<o?fe:ue;le(t,"bottom",this.width,this.height,{color:h})}}O.drawLeaderLines(t);const ht=[{type:"text",text:"1/",base:""},{type:"math",base:"f"},{type:"text",text:" = 1/",base:""},{type:"math",base:"d",sub:"o"},{type:"text",text:" + 1/",base:""},{type:"math",base:"d",sub:"i"},{type:"text",text:`   →   1/${o} = 1/${i} + 1/${u}`,base:""}];Be(t,ht,this.width/2,this.height-16,{color:"rgba(255,255,255,0.6)",background:"rgba(0,0,0,0.5)"})}}function _(e,t){const o=[];for(let i=0;i<e.length-1;i++)o.push([t(e[i].x,e[i].y),t(e[i+1].x,e[i+1].y)]);return o}function Lt(e,t,o,i,s,n){const r=s-o,l=n-i,a=r*r+l*l;if(a===0)return Math.hypot(e-o,t-i);let d=((e-o)*r+(t-i)*l)/a;return d=Math.max(0,Math.min(1,d)),Math.hypot(e-(o+d*r),t-(i+d*l))}const je=document.querySelector('[data-panel="thin-lens"]');je&&new Rt(je);
